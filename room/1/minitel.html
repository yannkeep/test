
<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://ouaisfieu.github.io/w0JT6q2HzMSoRGwzNEtfMbpUQwTJPy-fA53pV4cttbnmVLmmka6MZjwdPBC7p-bMitHOflLBQEDwPvLS8DpJ_78mWL33d89C9lQ9PYQ-RANdfUGiOGkmilngiS_yJcVH3Hn7n6LKeTjEQoKINgxmkMS2M0FBX4v3M17FgepCaRo6_gluAsJN6c86lUn6DJmx8ZiTa1FhDWzHk9CgFo8owo1V3zmnEc9qcs1x9cbJEaIEUdeCkxaiv5BHlz4Jrt0TwIwQ6EJgd1tqdnNIxhqwBo4EldTkIym_rHdYnr6cEyo8pmRbYPVNe5NewZN0IUVjZxgQD4nmKmMz5EUl0bo6ufZM5RVU_dyx92abs4WUGwoNWppFeczdm6xMkpMEDpxKB87gT33GkBM00AxJvZfi6beFHqWYWHxhhenK91UfUQCea88lxX05imqFQZZbwQhP-zUMBTmMR1N4ZnIXzFIHP2hEJ_q9FrtezynNeL1wRFpUUlzRsdCECY2Sq8d5hRiwf17kzj1uelxTfQ'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSAR e-BOMBA â˜¢ï¸ Simulateur de Dissuasion Cognitive</title>
    <meta name="description" content="Poste de travail citoyen pour la souverainetÃ© narrative. La meilleure propagande n'est pas de la propagande.">
    <meta property="og:title" content="TSAR e-BOMBA - Simulateur de Dissuasion Cognitive">
    <meta property="og:description" content="Construisez votre contre-rÃ©cit. Pour ne jamais avoir Ã  l'utiliser.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-bunker: #0a0f0a;
            --bg-console: #0d140d;
            --bg-panel: #152015;
            --nuclear-green: #39ff14;
            --nuclear-glow: rgba(57, 255, 20, 0.4);
            --warning-amber: #ffb700;
            --warning-red: #ff3333;
            --cold-blue: #00d4ff;
            --text-dim: #2a6a2a;
            --border-grid: rgba(57, 255, 20, 0.15);
            --font-display: 'Orbitron', monospace;
            --font-terminal: 'VT323', monospace;
            --font-ui: 'Rajdhani', sans-serif;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-ui);
            background: var(--bg-bunker);
            color: var(--nuclear-green);
            min-height: 100vh;
            line-height: 1.5;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.1) 2px, rgba(0,0,0,0.1) 4px);
            pointer-events: none;
            z-index: 10000;
            opacity: 0.5;
        }
        .app { display: grid; grid-template-columns: 260px 1fr 280px; min-height: 100vh; }
        @media (max-width: 1024px) { .app { grid-template-columns: 1fr; } }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            background: var(--bg-console);
            border-bottom: 2px solid var(--nuclear-green);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .logo-icon { font-size: 2.5rem; animation: pulse 2s infinite; filter: drop-shadow(0 0 10px var(--nuclear-glow)); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .logo h1 { font-family: var(--font-display); font-size: 1.4rem; letter-spacing: 0.15em; text-shadow: 0 0 20px var(--nuclear-glow); }
        .logo .subtitle { font-family: var(--font-terminal); font-size: 1rem; color: var(--text-dim); }
        .defcon { display: flex; align-items: center; gap: 1rem; padding: 0.5rem 1rem; background: var(--bg-panel); border: 1px solid var(--border-grid); }
        .defcon-num { font-family: var(--font-display); font-size: 2rem; font-weight: 900; text-shadow: 0 0 15px var(--nuclear-glow); }
        .defcon-num.warning { color: var(--warning-amber); }
        .defcon-num.critical { color: var(--warning-red); animation: blink 1s step-end infinite; }
        @keyframes blink { 50% { opacity: 0.3; } }
        .time { font-family: var(--font-terminal); font-size: 1.2rem; }
        .btn {
            font-family: var(--font-ui);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border: 1px solid var(--nuclear-green);
            background: transparent;
            color: var(--nuclear-green);
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        .btn:hover { background: var(--nuclear-green); color: var(--bg-bunker); box-shadow: 0 0 20px var(--nuclear-glow); }
        .btn.warning { border-color: var(--warning-amber); color: var(--warning-amber); }
        .btn.danger { border-color: var(--warning-red); color: var(--warning-red); }
        
        /* Sidebar */
        .sidebar {
            background: var(--bg-console);
            border-right: 1px solid var(--border-grid);
            overflow-y: auto;
        }
        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-grid);
            background: linear-gradient(180deg, var(--bg-panel), var(--bg-console));
        }
        .sidebar-title { font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.15em; color: var(--text-dim); }
        .phase { margin-bottom: 0.25rem; }
        .phase-header {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            border: 1px solid transparent;
            background: var(--bg-panel);
            transition: all 0.2s;
        }
        .phase-header:hover { border-color: var(--nuclear-green); }
        .phase-header.active { border-color: var(--nuclear-green); background: rgba(57, 255, 20, 0.1); }
        .phase-icon { font-size: 1.2rem; }
        .phase-name { font-family: var(--font-display); font-size: 0.7rem; letter-spacing: 0.1em; }
        .phase-desc { font-family: var(--font-terminal); font-size: 0.85rem; color: var(--text-dim); }
        .tools { display: none; padding: 0.25rem 0.5rem 0.5rem 2rem; }
        .phase.open .tools { display: block; }
        .tool-item {
            padding: 0.5rem 0.75rem;
            margin: 0.25rem 0;
            cursor: pointer;
            border-left: 2px solid var(--border-grid);
            font-family: var(--font-terminal);
            font-size: 1rem;
            color: var(--text-dim);
            transition: all 0.2s;
        }
        .tool-item:hover, .tool-item.active { border-color: var(--nuclear-green); color: var(--nuclear-green); }
        
        /* Main */
        .main { background: var(--bg-bunker); display: flex; flex-direction: column; overflow: hidden; }
        .console-header {
            padding: 1rem 1.5rem;
            background: var(--bg-console);
            border-bottom: 1px solid var(--border-grid);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .console-title { font-family: var(--font-display); font-size: 1rem; letter-spacing: 0.1em; }
        .breadcrumb { font-family: var(--font-terminal); color: var(--text-dim); }
        .wisdom {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(90deg, var(--bg-panel), var(--bg-console));
            border-bottom: 1px solid var(--border-grid);
            font-family: var(--font-terminal);
            font-style: italic;
            color: var(--text-dim);
        }
        .wisdom cite { color: var(--cold-blue); font-style: normal; }
        .workspace { flex: 1; overflow-y: auto; padding: 1.5rem; }
        .panel { display: none; animation: fadeIn 0.3s; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        .panel-title { font-family: var(--font-display); font-size: 1.5rem; color: var(--nuclear-green); text-shadow: 0 0 20px var(--nuclear-glow); margin-bottom: 0.5rem; }
        .panel-desc { font-family: var(--font-terminal); color: var(--text-dim); margin-bottom: 1rem; }
        .card {
            background: var(--bg-panel);
            border: 1px solid var(--border-grid);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-grid);
        }
        .card-title { font-family: var(--font-display); font-size: 0.75rem; letter-spacing: 0.1em; }
        .form-label {
            display: block;
            font-family: var(--font-display);
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        .form-help { font-family: var(--font-terminal); font-size: 0.9rem; color: var(--text-dim); margin-bottom: 0.5rem; }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            font-family: var(--font-terminal);
            font-size: 1rem;
            color: var(--nuclear-green);
            background: var(--bg-bunker);
            border: 1px solid var(--border-grid);
            margin-bottom: 1rem;
        }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--nuclear-green); box-shadow: 0 0 15px var(--nuclear-glow); }
        .form-textarea { min-height: 100px; resize: vertical; }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        @media (max-width: 768px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
        
        /* Intel Panel */
        .intel { background: var(--bg-console); border-left: 1px solid var(--border-grid); overflow-y: auto; }
        .intel-section { border-bottom: 1px solid var(--border-grid); }
        .intel-header { padding: 0.75rem 1rem; background: var(--bg-panel); font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.15em; color: var(--text-dim); }
        .intel-content { padding: 1rem; }
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
        .stat-box { padding: 0.75rem; background: var(--bg-panel); border: 1px solid var(--border-grid); text-align: center; }
        .stat-value { font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 10px var(--nuclear-glow); }
        .stat-label { font-family: var(--font-terminal); font-size: 0.75rem; color: var(--text-dim); }
        .progress-item { display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-grid); }
        .progress-bar { width: 80px; height: 6px; background: var(--bg-bunker); position: relative; }
        .progress-fill { height: 100%; background: var(--nuclear-green); box-shadow: 0 0 10px var(--nuclear-glow); transition: width 0.3s; }
        .quote-box { padding: 1rem; background: var(--bg-panel); border-left: 3px solid var(--cold-blue); margin-bottom: 0.75rem; }
        .quote-text { font-family: var(--font-terminal); font-style: italic; margin-bottom: 0.5rem; }
        .quote-source { font-family: var(--font-terminal); font-size: 0.85rem; color: var(--cold-blue); }
        
        /* Footer */
        .footer {
            grid-column: 1 / -1;
            background: var(--bg-console);
            border-top: 2px solid var(--nuclear-green);
            padding: 0.5rem 1.5rem;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            font-family: var(--font-terminal);
            font-size: 0.85rem;
            color: var(--text-dim);
        }
        .status { display: flex; align-items: center; gap: 0.5rem; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--nuclear-green); box-shadow: 0 0 10px var(--nuclear-glow); animation: pulse 2s infinite; }
        .encrypt { padding: 0.25rem 0.75rem; background: rgba(57, 255, 20, 0.1); border: 1px solid var(--nuclear-green); }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--bg-console);
            border: 2px solid var(--nuclear-green);
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px var(--nuclear-glow);
        }
        .modal-header {
            padding: 1rem 1.5rem;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-grid);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title { font-family: var(--font-display); font-size: 1rem; letter-spacing: 0.1em; }
        .modal-close { background: none; border: none; color: var(--text-dim); font-size: 1.5rem; cursor: pointer; }
        .modal-close:hover { color: var(--warning-red); }
        .modal-body { padding: 1.5rem; }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border-grid); display: flex; justify-content: flex-end; gap: 0.5rem; }
        
        /* Toast */
        .toast-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 2000; }
        .toast {
            padding: 0.75rem 1.25rem;
            background: var(--bg-console);
            border: 1px solid var(--nuclear-green);
            font-family: var(--font-terminal);
            margin-top: 0.5rem;
            animation: slideIn 0.3s;
            box-shadow: 0 0 20px var(--nuclear-glow);
        }
        .toast.error { border-color: var(--warning-red); color: var(--warning-red); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } }
        
        /* Welcome */
        .welcome { text-align: center; padding: 2rem; max-width: 800px; margin: 0 auto; }
        .welcome-logo { font-size: 5rem; animation: pulse 2s infinite; filter: drop-shadow(0 0 30px var(--nuclear-glow)); }
        .welcome h1 { font-family: var(--font-display); font-size: 2.5rem; letter-spacing: 0.2em; text-shadow: 0 0 30px var(--nuclear-glow); margin: 1rem 0 0.5rem; }
        .welcome p { font-family: var(--font-terminal); font-size: 1.2rem; color: var(--text-dim); margin-bottom: 2rem; }
        .welcome-quote {
            font-family: var(--font-terminal);
            padding: 1.5rem;
            background: var(--bg-panel);
            border-left: 4px solid var(--cold-blue);
            text-align: left;
            margin-bottom: 2rem;
        }
        .welcome-quote cite { display: block; margin-top: 0.75rem; color: var(--cold-blue); }
        .warning-box { background: rgba(255, 183, 0, 0.1); border: 1px solid var(--warning-amber); padding: 1rem; text-align: left; margin-bottom: 2rem; }
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 2rem; text-align: left; }
        .feature {
            padding: 1.5rem;
            background: var(--bg-panel);
            border: 1px solid var(--border-grid);
            transition: all 0.3s;
        }
        .feature:hover { border-color: var(--nuclear-green); transform: translateY(-2px); }
        .feature-icon { font-size: 2rem; margin-bottom: 0.75rem; }
        .feature-title { font-family: var(--font-display); font-size: 0.8rem; margin-bottom: 0.5rem; }
        .feature-desc { font-family: var(--font-terminal); font-size: 0.85rem; color: var(--text-dim); }
        
        /* Data table */
        .data-table { width: 100%; border-collapse: collapse; font-family: var(--font-terminal); }
        .data-table th, .data-table td { padding: 0.75rem; text-align: left; border: 1px solid var(--border-grid); }
        .data-table th { background: var(--bg-panel); font-family: var(--font-display); font-size: 0.65rem; letter-spacing: 0.1em; color: var(--text-dim); text-transform: uppercase; }
        .data-table td { background: var(--bg-bunker); }
        .data-table tr:hover td { background: var(--bg-panel); }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">â˜¢ï¸</span>
                <div>
                    <h1>TSAR e-BOMBA</h1>
                    <span class="subtitle">SIMULATEUR DE DISSUASION COGNITIVE</span>
                </div>
            </div>
            <div class="defcon">
                <div><span style="font-size:0.65rem;color:var(--text-dim)">DEFCON</span><div class="defcon-num" id="defcon">5</div></div>
                <div class="time" id="clock">--:--:--</div>
            </div>
            <div style="display:flex;gap:0.5rem">
                <button class="btn" onclick="openModal('import-modal')">ğŸ“¥ IMPORT</button>
                <button class="btn" onclick="exportJSON()">ğŸ“¤ EXPORT</button>
                <button class="btn warning" onclick="saveState()">ğŸ’¾ SAVE</button>
            </div>
        </header>
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">ARSENAL SÃ‰MANTIQUE</div>
                <div style="font-family:var(--font-terminal)">15 Munitions PÃ©dagogiques</div>
            </div>
            <nav id="nav">
                <!-- Phases populated by JS -->
            </nav>
        </aside>
        
        <!-- Main -->
        <main class="main">
            <div class="console-header">
                <span class="console-title" id="current-tool">CENTRE DE COMMANDEMENT</span>
                <span class="breadcrumb" id="breadcrumb">ACCUEIL</span>
            </div>
            <div class="wisdom" id="wisdom">"La meilleure propagande n'est pas de la propagande." â€” <cite>Joseph S. Nye</cite></div>
            <div class="workspace" id="workspace">
                <!-- Panels populated by JS -->
            </div>
        </main>
        
        <!-- Intel -->
        <aside class="intel">
            <div class="intel-section">
                <div class="intel-header">ğŸ“Š STATUT DE MISSION</div>
                <div class="intel-content">
                    <div class="stat-grid">
                        <div class="stat-box"><div class="stat-value" id="stat-progress">0%</div><div class="stat-label">Progression</div></div>
                        <div class="stat-box"><div class="stat-value" id="stat-actors">0</div><div class="stat-label">Acteurs</div></div>
                    </div>
                </div>
            </div>
            <div class="intel-section">
                <div class="intel-header">ğŸ“ˆ PROGRESSION PAR PHASE</div>
                <div class="intel-content">
                    <div class="progress-item"><span>ğŸ‘ï¸ VOIR</span><div class="progress-bar"><div class="progress-fill" id="prog-voir" style="width:0%"></div></div></div>
                    <div class="progress-item"><span>âš–ï¸ JUGER</span><div class="progress-bar"><div class="progress-fill" id="prog-juger" style="width:0%"></div></div></div>
                    <div class="progress-item"><span>âš¡ AGIR</span><div class="progress-bar"><div class="progress-fill" id="prog-agir" style="width:0%"></div></div></div>
                </div>
            </div>
            <div class="intel-section">
                <div class="intel-header">ğŸ’¡ SAGESSE TACTIQUE</div>
                <div class="intel-content" id="quotes"></div>
            </div>
        </aside>
        
        <!-- Footer -->
        <footer class="footer">
            <div class="status"><span class="status-dot"></span><span>SYSTÃˆME OPÃ‰RATIONNEL â€” Mode pÃ©dagogique</span></div>
            <div class="encrypt">ğŸ”’ DONNÃ‰ES LOCALES</div>
            <div>TSAR e-BOMBA v2.0 â€” Pour ne jamais avoir Ã  s'en servir</div>
        </footer>
    </div>
    
    <!-- Import Modal -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ“¥ IMPORT DE DOSSIER</span>
                <button class="modal-close" onclick="closeModal('import-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <label class="form-label">FICHIER JSON</label>
                <input type="file" class="form-input" id="import-file" accept=".json">
                <label class="form-label">OU COLLER LES DONNÃ‰ES</label>
                <textarea class="form-textarea" id="import-text" placeholder='{"fields": {...}}'></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('import-modal')">Annuler</button>
                <button class="btn" onclick="importData()" style="background:var(--nuclear-green);color:var(--bg-bunker)">Importer</button>
            </div>
        </div>
    </div>
    
    <!-- Actor Modal -->
    <div class="modal-overlay" id="actor-modal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">ğŸ‘¤ AJOUTER UN ACTEUR</span>
                <button class="modal-close" onclick="closeModal('actor-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <label class="form-label">Nom / EntitÃ©</label>
                <input type="text" class="form-input" id="actor-name">
                <label class="form-label">Type</label>
                <select class="form-input" id="actor-type">
                    <option value="institution">Institution</option>
                    <option value="personne">Personne</option>
                    <option value="media">MÃ©dia</option>
                    <option value="association">Association</option>
                </select>
                <label class="form-label">Position</label>
                <select class="form-input" id="actor-position">
                    <option value="ally">ğŸŸ¢ AlliÃ©</option>
                    <option value="neutral">ğŸŸ¡ Neutre</option>
                    <option value="target">ğŸ”´ Cible</option>
                </select>
                <label class="form-label">Pouvoir (1-10)</label>
                <input type="number" class="form-input" id="actor-power" min="1" max="10" value="5">
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('actor-modal')">Annuler</button>
                <button class="btn" onclick="saveActor()" style="background:var(--nuclear-green);color:var(--bg-bunker)">Ajouter</button>
            </div>
        </div>
    </div>
    
    <div class="toast-container" id="toasts"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE & CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = { fields: {}, actors: [], journal: [] };

const PHASES = [
    { id: 'voir', icon: 'ğŸ‘ï¸', name: 'PHASE 1 : VOIR', desc: 'Reconnaissance & Analyse', tools: [
        { id: 'domino', name: 'ğŸ¯ Domino du Changement' },
        { id: 'profil', name: 'ğŸ­ Profil d\'Engagement' },
        { id: 'fleur', name: 'ğŸŒ¸ Fleur de Pouvoir' },
        { id: 'acteurs', name: 'ğŸ—ºï¸ Cartographie des Acteurs' }
    ]},
    { id: 'juger', icon: 'âš–ï¸', name: 'PHASE 2 : JUGER', desc: 'StratÃ©gie & Planification', tools: [
        { id: 'toc', name: 'ğŸ”® ThÃ©orie du Changement' },
        { id: 'swot', name: 'ğŸ“Š Analyse SWOT' },
        { id: 'arbre', name: 'ğŸŒ³ Arbre Ã  ProblÃ¨mes' },
        { id: 'why5', name: 'â“ Les 5 Pourquoi' }
    ]},
    { id: 'agir', icon: 'âš¡', name: 'PHASE 3 : AGIR', desc: 'DÃ©ploiement & Impact', tools: [
        { id: 'pouvoir', name: 'âœŠ Avec/Sans/Contre le Pouvoir' },
        { id: 'smart', name: 'ğŸ¯ Objectifs SMART' },
        { id: 'message', name: 'ğŸ’¬ Construction de Message' },
        { id: 'suivi', name: 'ğŸ“ˆ Suivi-Ã‰valuation' }
    ]},
    { id: 'arsenal', icon: 'ğŸ§¬', name: 'MODULES SPÃ‰CIAUX', desc: 'Arsenal AvancÃ©', tools: [
        { id: 'semantic', name: 'ğŸ§¬ Armement SÃ©mantique' },
        { id: 'narrative', name: 'ğŸ“– Contre-Narrative Builder' },
        { id: 'viral', name: 'ğŸ¦  Kit ViralitÃ©' }
    ]}
];

const QUOTES = [
    { text: "L'art suprÃªme de la guerre, c'est soumettre l'ennemi sans combat.", src: "Sun Tzu" },
    { text: "La meilleure propagande n'est pas de la propagande.", src: "Joseph S. Nye" },
    { text: "L'Ã©ducation populaire, c'est de se mettre debout!", src: "Christian Maurel" },
    { text: "Free your mind.", src: "Morpheus, The Matrix" },
    { text: "Ideas are bulletproof.", src: "V for Vendetta" },
    { text: "La libertÃ©, c'est l'action.", src: "Hannah Arendt" }
];

const TOOLS = {
    welcome: `<div class="welcome">
        <div class="welcome-logo">â˜¢ï¸</div>
        <h1>TSAR e-BOMBA</h1>
        <p>Simulateur de Dissuasion Cognitive v2.0</p>
        <div class="welcome-quote">
            "Dans une guerre sÃ©mantique, la dÃ©signation des cibles revÃªt une importance stratÃ©gique capitale. Notre doctrine proscrit l'attaque personnelle. Nos cibles sont immatÃ©rielles : ce sont les <em>entitÃ©s numÃ©riques</em> et les relations qui dÃ©finissent leur pouvoir dans le graphe de connaissances."
            <cite>â€” Manifeste TSAR e-BOMBA, Â§2.0</cite>
        </div>
        <div class="warning-box">
            <strong style="color:var(--warning-amber)">âš ï¸ AVERTISSEMENT PÃ‰DAGOGIQUE</strong>
            <p style="margin-top:0.5rem;font-family:var(--font-terminal)">Cet outil est une <strong>dÃ©monstration de force pÃ©dagogique</strong>. Il rÃ©vÃ¨le les techniques de guerre cognitive pour que vous puissiez les comprendre, les identifier et les neutraliser. Notre objectif: Vous armer pour ne jamais avoir Ã  vous battre.</p>
        </div>
        <button class="btn" onclick="showTool('domino')" style="font-size:1rem;padding:1rem 2rem">ğŸš€ COMMENCER LA MISSION</button>
        <div class="features">
            <div class="feature"><div class="feature-icon">ğŸ‘ï¸</div><div class="feature-title">VOIR</div><div class="feature-desc">4 outils d'analyse de la situation et des pouvoirs</div></div>
            <div class="feature"><div class="feature-icon">âš–ï¸</div><div class="feature-title">JUGER</div><div class="feature-desc">4 outils de stratÃ©gie et planification</div></div>
            <div class="feature"><div class="feature-icon">âš¡</div><div class="feature-title">AGIR</div><div class="feature-desc">4 outils d'action et dÃ©ploiement</div></div>
            <div class="feature"><div class="feature-icon">ğŸ§¬</div><div class="feature-title">ARSENAL</div><div class="feature-desc">Modules avancÃ©s: sÃ©mantique, viralitÃ©</div></div>
        </div>
    </div>`,
    
    domino: `<h2 class="panel-title">ğŸ¯ DOMINO DU CHANGEMENT</h2>
        <p class="panel-desc">Votre GPS stratÃ©gique: du POURQUOI profond jusqu'Ã  votre VISION.</p>
        <div class="card"><div class="card-header"><span class="card-title">SÃ‰QUENCE D'IMPACT</span></div>
            <label class="form-label">1. POURQUOI â€” Votre motivation profonde</label>
            <p class="form-help">Qu'est-ce qui vous rÃ©volte?</p>
            <textarea class="form-textarea" data-field="domino_pourquoi"></textarea>
            <label class="form-label">2. VALEURS â€” Vos principes non-nÃ©gociables</label>
            <textarea class="form-textarea" data-field="domino_valeurs"></textarea>
            <label class="form-label">3. CHANGEMENTS â€” Ce que vous voulez transformer</label>
            <textarea class="form-textarea" data-field="domino_changements"></textarea>
            <label class="form-label">4. VISION â€” Le monde tel que vous le rÃªvez</label>
            <textarea class="form-textarea" data-field="domino_vision"></textarea>
        </div>`,
    
    profil: `<h2 class="panel-title">ğŸ­ PROFIL D'ENGAGEMENT</h2>
        <p class="panel-desc">Auto-Ã©valuez votre positionnement et vos ressources.</p>
        <div class="grid-2">
            <div class="card"><div class="card-header"><span class="card-title">VOS RESSOURCES</span></div>
                <label class="form-label">Temps disponible</label>
                <input type="text" class="form-input" data-field="profil_temps" placeholder="Ex: 5h/semaine">
                <label class="form-label">CompÃ©tences clÃ©s</label>
                <textarea class="form-textarea" data-field="profil_competences"></textarea>
                <label class="form-label">RÃ©seau mobilisable</label>
                <textarea class="form-textarea" data-field="profil_reseau"></textarea>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">VOS LIMITES</span></div>
                <label class="form-label">Ce que vous ne ferez PAS</label>
                <textarea class="form-textarea" data-field="profil_limites"></textarea>
                <label class="form-label">Risques acceptÃ©s</label>
                <textarea class="form-textarea" data-field="profil_risques"></textarea>
            </div>
        </div>`,
    
    fleur: `<h2 class="panel-title">ğŸŒ¸ FLEUR DE POUVOIR</h2>
        <p class="panel-desc">Analysez vos dimensions de privilÃ¨ge ou vulnÃ©rabilitÃ©.</p>
        <div class="card"><div class="card-header"><span class="card-title">VOS PÃ‰TALES</span></div>
            <div class="grid-2">
                <div><label class="form-label">Genre</label><input class="form-input" data-field="fleur_genre"></div>
                <div><label class="form-label">Origine</label><input class="form-input" data-field="fleur_origine"></div>
                <div><label class="form-label">Classe sociale</label><input class="form-input" data-field="fleur_classe"></div>
                <div><label class="form-label">Ã‰ducation</label><input class="form-input" data-field="fleur_education"></div>
                <div><label class="form-label">SantÃ©</label><input class="form-input" data-field="fleur_sante"></div>
                <div><label class="form-label">Ã‚ge</label><input class="form-input" data-field="fleur_age"></div>
            </div>
        </div>
        <div class="card" style="border-color:var(--cold-blue)">
            <p style="font-family:var(--font-terminal)">ğŸ­ <strong>DOCTRINE:</strong> Vos vulnÃ©rabilitÃ©s sont vos super-pouvoirs sÃ©mantiques. L'expÃ©rience vÃ©cue gÃ©nÃ¨re une lÃ©gitimitÃ© narrative que nul budget ne peut acheter.</p>
        </div>`,
    
    acteurs: `<h2 class="panel-title">ğŸ—ºï¸ CARTOGRAPHIE DES ACTEURS</h2>
        <p class="panel-desc">Identifiez alliÃ©s, cibles et adversaires.</p>
        <div class="card">
            <div class="card-header"><span class="card-title">REGISTRE DES ENTITÃ‰S</span><button class="btn" onclick="openModal('actor-modal')">+ AJOUTER</button></div>
            <table class="data-table"><thead><tr><th>NOM</th><th>TYPE</th><th>POUVOIR</th><th>POSITION</th><th>Ã—</th></tr></thead><tbody id="actors-tbody"></tbody></table>
        </div>`,
    
    toc: `<h2 class="panel-title">ğŸ”® THÃ‰ORIE DU CHANGEMENT</h2>
        <p class="panel-desc">COMMENT le changement va se produire: 4 quadrants.</p>
        <div class="grid-2">
            <div class="card"><div class="card-header"><span class="card-title">INDIVIDUEL Ã— INTERNE</span></div>
                <p class="form-help">Changements dans les consciences</p>
                <textarea class="form-textarea" data-field="toc_ind_int"></textarea>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">INDIVIDUEL Ã— EXTERNE</span></div>
                <p class="form-help">Changements dans les comportements</p>
                <textarea class="form-textarea" data-field="toc_ind_ext"></textarea>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">COLLECTIF Ã— INTERNE</span></div>
                <p class="form-help">Changements dans la culture</p>
                <textarea class="form-textarea" data-field="toc_coll_int"></textarea>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">COLLECTIF Ã— EXTERNE</span></div>
                <p class="form-help">Changements dans les structures</p>
                <textarea class="form-textarea" data-field="toc_coll_ext"></textarea>
            </div>
        </div>
        <div class="card"><div class="card-header"><span class="card-title">VISION FINALE</span></div>
            <textarea class="form-textarea" data-field="toc_vision"></textarea>
        </div>`,
    
    swot: `<h2 class="panel-title">ğŸ“Š ANALYSE SWOT</h2>
        <div class="grid-2">
            <div class="card" style="border-color:var(--nuclear-green)"><div class="card-header"><span class="card-title" style="color:var(--nuclear-green)">ğŸ’ª FORCES</span></div><textarea class="form-textarea" data-field="swot_forces"></textarea></div>
            <div class="card" style="border-color:var(--warning-amber)"><div class="card-header"><span class="card-title" style="color:var(--warning-amber)">âš ï¸ FAIBLESSES</span></div><textarea class="form-textarea" data-field="swot_faiblesses"></textarea></div>
            <div class="card" style="border-color:var(--cold-blue)"><div class="card-header"><span class="card-title" style="color:var(--cold-blue)">ğŸš€ OPPORTUNITÃ‰S</span></div><textarea class="form-textarea" data-field="swot_opportunites"></textarea></div>
            <div class="card" style="border-color:var(--warning-red)"><div class="card-header"><span class="card-title" style="color:var(--warning-red)">ğŸ¯ MENACES</span></div><textarea class="form-textarea" data-field="swot_menaces"></textarea></div>
        </div>`,
    
    arbre: `<h2 class="panel-title">ğŸŒ³ ARBRE Ã€ PROBLÃˆMES</h2>
        <p class="panel-desc">Racines (causes), Tronc (problÃ¨me), Branches (consÃ©quences).</p>
        <div class="card"><div class="card-header"><span class="card-title">ğŸŒ¿ CONSÃ‰QUENCES</span></div><textarea class="form-textarea" data-field="arbre_consequences"></textarea></div>
        <div class="card" style="border-color:var(--nuclear-green);border-width:3px"><div class="card-header"><span class="card-title" style="color:var(--nuclear-green)">ğŸªµ PROBLÃˆME CENTRAL</span></div><textarea class="form-textarea" data-field="arbre_probleme"></textarea></div>
        <div class="card"><div class="card-header"><span class="card-title">ğŸŒ± CAUSES PROFONDES</span></div><textarea class="form-textarea" data-field="arbre_causes"></textarea></div>`,
    
    why5: `<h2 class="panel-title">â“ LES 5 POURQUOI</h2>
        <p class="panel-desc">Root cause analysis: posez "Pourquoi?" cinq fois.</p>
        <div class="card">
            <label class="form-label">PROBLÃˆME DE DÃ‰PART</label><input class="form-input" data-field="why_start">
            <label class="form-label">1ï¸âƒ£ POURQUOI ?</label><input class="form-input" data-field="why_1">
            <label class="form-label">2ï¸âƒ£ POURQUOI ?</label><input class="form-input" data-field="why_2">
            <label class="form-label">3ï¸âƒ£ POURQUOI ?</label><input class="form-input" data-field="why_3">
            <label class="form-label">4ï¸âƒ£ POURQUOI ?</label><input class="form-input" data-field="why_4">
            <label class="form-label" style="color:var(--nuclear-green)">5ï¸âƒ£ CAUSE RACINE</label><input class="form-input" data-field="why_5" style="border-color:var(--nuclear-green)">
        </div>`,
    
    pouvoir: `<h2 class="panel-title">âœŠ AVEC / SANS / CONTRE LE POUVOIR</h2>
        <div class="grid-3">
            <div class="card" style="border-color:var(--nuclear-green)"><div class="card-header"><span class="card-title" style="color:var(--nuclear-green)">ğŸ¤ AVEC</span></div><p class="form-help">Collaboration, dialogue</p><textarea class="form-textarea" data-field="pouvoir_avec"></textarea></div>
            <div class="card" style="border-color:var(--warning-amber)"><div class="card-header"><span class="card-title" style="color:var(--warning-amber)">ğŸ”„ SANS</span></div><p class="form-help">Alternatives, expÃ©rimentations</p><textarea class="form-textarea" data-field="pouvoir_sans"></textarea></div>
            <div class="card" style="border-color:var(--warning-red)"><div class="card-header"><span class="card-title" style="color:var(--warning-red)">âš”ï¸ CONTRE</span></div><p class="form-help">Confrontation, rapport de force</p><textarea class="form-textarea" data-field="pouvoir_contre"></textarea></div>
        </div>`,
    
    smart: `<h2 class="panel-title">ğŸ¯ OBJECTIFS SMART</h2>
        <div class="card">
            <label class="form-label">S â€” SPÃ‰CIFIQUE</label><textarea class="form-textarea" data-field="smart_s"></textarea>
            <label class="form-label">M â€” MESURABLE</label><textarea class="form-textarea" data-field="smart_m"></textarea>
            <label class="form-label">A â€” ATTEIGNABLE</label><textarea class="form-textarea" data-field="smart_a"></textarea>
            <label class="form-label">R â€” RÃ‰ALISTE</label><textarea class="form-textarea" data-field="smart_r"></textarea>
            <label class="form-label">T â€” TEMPOREL</label><textarea class="form-textarea" data-field="smart_t"></textarea>
        </div>`,
    
    message: `<h2 class="panel-title">ğŸ’¬ CONSTRUCTION DE MESSAGE</h2>
        <div class="card">
            <label class="form-label">1. ğŸª ACCROCHE</label><input class="form-input" data-field="msg_accroche">
            <label class="form-label">2. ğŸ“‹ LE PROBLÃˆME</label><textarea class="form-textarea" data-field="msg_probleme"></textarea>
            <label class="form-label">3. â— POURQUOI C'EST IMPORTANT</label><textarea class="form-textarea" data-field="msg_importance"></textarea>
            <label class="form-label">4. ğŸ¯ Ã€ QUI VOUS VOUS ADRESSEZ</label><input class="form-input" data-field="msg_cible">
            <label class="form-label">5. âœŠ L'ACTION DEMANDÃ‰E</label><input class="form-input" data-field="msg_action">
        </div>`,
    
    suivi: `<h2 class="panel-title">ğŸ“ˆ SUIVI-Ã‰VALUATION</h2>
        <div class="grid-2">
            <div class="card"><div class="card-header"><span class="card-title">INDICATEURS QUANTITATIFS</span></div><textarea class="form-textarea" data-field="suivi_quanti"></textarea></div>
            <div class="card"><div class="card-header"><span class="card-title">INDICATEURS QUALITATIFS</span></div><textarea class="form-textarea" data-field="suivi_quali"></textarea></div>
        </div>
        <div class="card"><div class="card-header"><span class="card-title">ğŸ“ JOURNAL</span><button class="btn" onclick="addJournal()">+ ENTRÃ‰E</button></div><div id="journal"></div></div>`,
    
    semantic: `<h2 class="panel-title">ğŸ§¬ ARMEMENT SÃ‰MANTIQUE</h2>
        <p class="panel-desc">Triplets RDF: Sujet-PrÃ©dicat-Objet</p>
        <div class="card" style="border-color:var(--warning-amber)">
            <p style="font-family:var(--font-terminal)">âš ï¸ <strong>DOCTRINE:</strong> "Le contenu est notre munition principale. L'unitÃ© fondamentale de l'information pour une machine est le triplet RDF."</p>
        </div>
        <div class="card">
            <div class="grid-2">
                <div><label class="form-label">EntitÃ© Ã  promouvoir</label><input class="form-input" data-field="sem_entite"></div>
                <div><label class="form-label">Attributs positifs</label><input class="form-input" data-field="sem_attributs"></div>
            </div>
            <label class="form-label">Mots-clÃ©s longue traÃ®ne</label>
            <textarea class="form-textarea" data-field="sem_longtail"></textarea>
        </div>`,
    
    narrative: `<h2 class="panel-title">ğŸ“– CONTRE-NARRATIVE BUILDER</h2>
        <div class="grid-2">
            <div class="card" style="border-color:var(--warning-red)"><div class="card-header"><span class="card-title" style="color:var(--warning-red)">ğŸ“º RÃ‰CIT DOMINANT</span></div>
                <label class="form-label">Narrative Ã  dÃ©construire</label><textarea class="form-textarea" data-field="narr_dominant"></textarea>
                <label class="form-label">Biais identifiÃ©s</label><textarea class="form-textarea" data-field="narr_biais"></textarea>
            </div>
            <div class="card" style="border-color:var(--nuclear-green)"><div class="card-header"><span class="card-title" style="color:var(--nuclear-green)">âœŠ CONTRE-RÃ‰CIT</span></div>
                <label class="form-label">Votre narrative</label><textarea class="form-textarea" data-field="narr_contre"></textarea>
                <label class="form-label">Preuves et tÃ©moignages</label><textarea class="form-textarea" data-field="narr_preuves"></textarea>
            </div>
        </div>`,
    
    viral: `<h2 class="panel-title">ğŸ¦  KIT VIRALITÃ‰</h2>
        <div class="card" style="border-color:var(--cold-blue)">
            <p style="font-family:var(--font-terminal);text-align:center">"Le premier rÃ©sultat Google possÃ¨de en moyenne <strong style="color:var(--nuclear-green);font-size:1.5rem">3,8Ã—</strong> plus de backlinks que les positions 2-10."</p>
        </div>
        <div class="card">
            <label class="form-label">Message principal (280 car.)</label>
            <textarea class="form-textarea" data-field="viral_tweet" maxlength="280" style="min-height:60px"></textarea>
            <label class="form-label">Hashtags</label><input class="form-input" data-field="viral_hashtags">
            <label class="form-label">Call-to-action</label><input class="form-input" data-field="viral_cta">
        </div>`
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
    loadState();
    renderNav();
    renderQuotes();
    showTool('welcome');
    updateStats();
    setInterval(updateClock, 1000);
    updateClock();
});

function loadState() {
    try {
        const saved = localStorage.getItem('tsar_v2');
        if (saved) state = JSON.parse(saved);
    } catch(e) {}
}

function saveState() {
    localStorage.setItem('tsar_v2', JSON.stringify(state));
    toast('ğŸ’¾ SauvegardÃ©');
}

function renderNav() {
    document.getElementById('nav').innerHTML = PHASES.map(p => `
        <div class="phase" id="phase-${p.id}">
            <div class="phase-header" onclick="togglePhase('${p.id}')">
                <span class="phase-icon">${p.icon}</span>
                <div><div class="phase-name">${p.name}</div><div class="phase-desc">${p.desc}</div></div>
            </div>
            <div class="tools">${p.tools.map(t => `<div class="tool-item" data-tool="${t.id}" onclick="showTool('${t.id}')">${t.name}</div>`).join('')}</div>
        </div>
    `).join('');
}

function togglePhase(id) {
    document.querySelectorAll('.phase').forEach(p => {
        if (p.id === 'phase-' + id) p.classList.toggle('open');
        else p.classList.remove('open');
    });
}

function showTool(id) {
    document.querySelectorAll('.tool-item').forEach(t => t.classList.toggle('active', t.dataset.tool === id));
    document.getElementById('workspace').innerHTML = `<div class="panel active">${TOOLS[id] || TOOLS.welcome}</div>`;
    document.getElementById('current-tool').textContent = id === 'welcome' ? 'CENTRE DE COMMANDEMENT' : id.toUpperCase();
    
    // Bind fields
    document.querySelectorAll('[data-field]').forEach(el => {
        const f = el.dataset.field;
        if (state.fields[f]) el.value = state.fields[f];
        el.addEventListener('input', e => {
            state.fields[f] = e.target.value;
            saveState();
            updateStats();
        });
    });
    
    if (id === 'acteurs') renderActors();
    if (id === 'suivi') renderJournal();
}

function renderQuotes() {
    document.getElementById('quotes').innerHTML = QUOTES.slice(0,3).map(q => 
        `<div class="quote-box"><div class="quote-text">"${q.text}"</div><div class="quote-source">â€” ${q.src}</div></div>`
    ).join('');
}

function updateClock() {
    document.getElementById('clock').textContent = new Date().toLocaleTimeString('fr-FR');
}

function updateStats() {
    const filled = Object.values(state.fields).filter(v => v?.trim()).length;
    const pct = Math.min(100, Math.round(filled / 40 * 100));
    document.getElementById('stat-progress').textContent = pct + '%';
    document.getElementById('stat-actors').textContent = state.actors.length;
    
    const voirFields = ['domino_pourquoi','domino_valeurs','profil_temps','fleur_genre'];
    const jugerFields = ['toc_vision','swot_forces','arbre_probleme','why_1'];
    const agirFields = ['smart_s','msg_accroche','pouvoir_avec','suivi_quanti'];
    
    const calc = fields => Math.round(fields.filter(f => state.fields[f]?.trim()).length / fields.length * 100);
    document.getElementById('prog-voir').style.width = calc(voirFields) + '%';
    document.getElementById('prog-juger').style.width = calc(jugerFields) + '%';
    document.getElementById('prog-agir').style.width = calc(agirFields) + '%';
    
    const defcon = document.getElementById('defcon');
    if (pct < 25) { defcon.textContent = '5'; defcon.className = 'defcon-num'; }
    else if (pct < 50) { defcon.textContent = '4'; defcon.className = 'defcon-num'; }
    else if (pct < 75) { defcon.textContent = '3'; defcon.className = 'defcon-num warning'; }
    else if (pct < 90) { defcon.textContent = '2'; defcon.className = 'defcon-num warning'; }
    else { defcon.textContent = '1'; defcon.className = 'defcon-num critical'; }
}

// Actors
function saveActor() {
    const actor = {
        id: Date.now(),
        name: document.getElementById('actor-name').value,
        type: document.getElementById('actor-type').value,
        position: document.getElementById('actor-position').value,
        power: document.getElementById('actor-power').value
    };
    if (!actor.name) return toast('Entrez un nom', 'error');
    state.actors.push(actor);
    saveState();
    renderActors();
    closeModal('actor-modal');
    document.getElementById('actor-name').value = '';
}

function renderActors() {
    const tbody = document.getElementById('actors-tbody');
    if (!tbody) return;
    tbody.innerHTML = state.actors.map(a => `<tr>
        <td>${a.name}</td><td>${a.type}</td><td>${a.power}/10</td>
        <td>${{ally:'ğŸŸ¢ AlliÃ©',neutral:'ğŸŸ¡ Neutre',target:'ğŸ”´ Cible'}[a.position]||a.position}</td>
        <td><button class="btn" onclick="deleteActor(${a.id})" style="padding:0.25rem">ğŸ—‘ï¸</button></td>
    </tr>`).join('');
    updateStats();
}

function deleteActor(id) {
    state.actors = state.actors.filter(a => a.id !== id);
    saveState();
    renderActors();
}

// Journal
function addJournal() {
    const text = prompt('Nouvelle entrÃ©e:');
    if (text) {
        state.journal.push({ id: Date.now(), date: new Date().toISOString(), text });
        saveState();
        renderJournal();
    }
}

function renderJournal() {
    const el = document.getElementById('journal');
    if (!el) return;
    el.innerHTML = state.journal.length ? state.journal.map(j => 
        `<div class="card" style="margin:0.5rem 0"><small style="color:var(--text-dim)">${new Date(j.date).toLocaleDateString('fr-FR')}</small><p style="font-family:var(--font-terminal)">${j.text}</p></div>`
    ).join('') : '<p style="color:var(--text-dim);font-family:var(--font-terminal)">Aucune entrÃ©e</p>';
}

// Import/Export
function importData() {
    const file = document.getElementById('import-file').files[0];
    const text = document.getElementById('import-text').value;
    const process = data => {
        try {
            state = { ...state, ...JSON.parse(data) };
            saveState();
            closeModal('import-modal');
            toast('âœ… ImportÃ©');
            showTool('welcome');
            updateStats();
        } catch(e) { toast('Erreur de format', 'error'); }
    };
    if (file) { const r = new FileReader(); r.onload = e => process(e.target.result); r.readAsText(file); }
    else if (text) process(text);
}

function exportJSON() {
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `tsar-ebomba-${Date.now()}.json`;
    a.click();
    toast('ğŸ“¤ ExportÃ©');
}

// Modal & Toast
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }
document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active')); });

function toast(msg, type = '') {
    const el = document.createElement('div');
    el.className = 'toast ' + type;
    el.textContent = msg;
    document.getElementById('toasts').appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; setTimeout(() => el.remove(), 300); }, 3000);
}
</script>
</body>
</html>
