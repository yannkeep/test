<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://ouaisfieu.github.io/p8XT9WWAnv2ANRuz78azSozIhxP9wHoox19YwexUSJfKtBxEPkbpU1V79fGBShZ5vbybHNIq7Lrt0xBC4BrXrSKXXWhQAeCX2WJCHx96_C1VlSc-n22iMUXEUTm0-QQax8g6L8ADul7p8UTPxLgHnwHGKBAbR1BN7RVYiaSA9LiuCnCNmjvX59uKIRazZxH9sVFwK5MhgVTOYu70C42RDD6KahnXMV5cg3XR2KOhRqmsf9rQuvxiQow60qbRH3VaZkf8Q4iywSa3jq_WojSkXdLQinTrt3aMub_norHzjfoEWRzQvI95ERBEErwEC2Paow5Gv9x8rMrmj9gt5crpoRfnp0fxjXf2aJgtIcAH8UAOFAwiBREI5rB1TbSC-qalxrLm0IumjHwyx6lPkTtLp1RJ0JQ-esUNNSDHR5dsYubAVLx3ahkojaUcxQ-C6isVJLD8PpFmX4Him7juj_pwljsF88xNhkmmJVpdn-gs'></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L'≈íil de Sauron - Plateau d'Intelligence</title>
<style>
:root {
  --bg: #0a0a0f;
  --card-bg: #12121a;
  --border: rgba(134, 239, 172, 0.3);
  --text: #a7f3d0;
  --accent: #c4b5fd;
  --lilas: #ddd6fe;
  --green: #86efac;
  --eye: #ef4444;
  --eye-glow: rgba(239, 68, 68, 0.5);
}
[data-theme="light"] {
  --bg: #f0fdf4;
  --card-bg: #ffffff;
  --border: rgba(192, 132, 252, 0.4);
  --text: #166534;
  --accent: #7c3aed;
  --eye: #ea580c;
  --eye-glow: rgba(234, 88, 12, 0.4);
}
[data-theme="matrix"] {
  --bg: #000;
  --card-bg: #001100;
  --border: #00ff00;
  --text: #00ff00;
  --accent: #00ff00;
  --lilas: #00ff00;
  --green: #00ff00;
  --eye: #00ff00;
  --eye-glow: rgba(0, 255, 0, 0.6);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  transition: all 0.4s;
}
header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  gap: 1rem;
  border-bottom: 1px solid var(--border);
}
.logo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: bold;
  font-size: 1.2rem;
}
.eye-container {
  position: relative;
  width: 40px;
  height: 40px;
}
.eye {
  width: 40px;
  height: 20px;
  border: 3px solid var(--eye);
  border-radius: 50%;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  animation: pulse 2s infinite;
  box-shadow: 0 0 15px var(--eye-glow), inset 0 0 10px var(--eye-glow);
}
.pupil {
  width: 10px;
  height: 10px;
  background: var(--eye);
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 0 10px var(--eye-glow);
  animation: look 4s infinite;
}
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 15px var(--eye-glow), inset 0 0 10px var(--eye-glow); }
  50% { box-shadow: 0 0 30px var(--eye-glow), inset 0 0 20px var(--eye-glow); }
}
@keyframes look {
  0%, 100% { transform: translate(-50%, -50%); }
  25% { transform: translate(-80%, -50%); }
  75% { transform: translate(-20%, -50%); }
}
.controls {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}
.btn {
  padding: 0.5rem 1rem;
  border: 1px solid var(--border);
  background: var(--card-bg);
  color: var(--text);
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: all 0.2s;
}
.btn:hover { border-color: var(--accent); color: var(--accent); }
.btn.active { background: var(--accent); color: var(--bg); }
.search-bar {
  display: flex;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
}
.search-bar input {
  flex: 1;
  padding: 0.5rem;
  background: var(--card-bg);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 6px;
  min-width: 150px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 4px;
  padding: 0.5rem;
}
@media (min-width: 768px) {
  .grid { grid-template-columns: repeat(20, 1fr); gap: 6px; padding: 1rem; }
}
.cell {
  aspect-ratio: 1;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  position: relative;
  font-size: 0.6rem;
  text-align: center;
  padding: 2px;
}
.cell:hover {
  border-color: var(--accent);
  transform: scale(1.05);
  z-index: 10;
  box-shadow: 0 0 15px var(--eye-glow);
}
.cell.filled {
  border-color: var(--green);
  background: linear-gradient(135deg, var(--card-bg), rgba(134, 239, 172, 0.1));
}
.cell-logo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 2px;
}
.cell-initial {
  font-size: 1.2rem;
  font-weight: bold;
  color: var(--accent);
}
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--card-bg);
  border: 2px solid var(--accent);
  border-radius: 12px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-bottom: 1px solid var(--border);
}
.modal-close {
  background: none;
  border: none;
  color: var(--text);
  font-size: 1.5rem;
  cursor: pointer;
}
.modal-body { padding: 1rem; }
.form-group {
  margin-bottom: 1rem;
}
.form-group label {
  display: block;
  margin-bottom: 0.3rem;
  color: var(--accent);
  font-size: 0.85rem;
}
.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 0.6rem;
  background: var(--bg);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 6px;
  font-size: 0.9rem;
}
.form-group textarea { min-height: 80px; resize: vertical; }
.color-row {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}
.color-row input[type="color"] {
  width: 50px;
  height: 36px;
  padding: 0;
  border: none;
  cursor: pointer;
}
.media-preview {
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: var(--bg);
  border-radius: 6px;
  max-height: 150px;
  overflow: hidden;
}
.media-preview img,
.media-preview video,
.media-preview iframe {
  max-width: 100%;
  max-height: 130px;
  border-radius: 4px;
}
.modal-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  padding: 1rem;
  border-top: 1px solid var(--border);
}
.btn-danger { border-color: #ef4444; color: #ef4444; }
.btn-danger:hover { background: #ef4444; color: white; }
.btn-primary { background: var(--accent); color: var(--bg); border-color: var(--accent); }
.stats {
  padding: 0.5rem 1rem;
  font-size: 0.8rem;
  color: var(--accent);
  border-bottom: 1px solid var(--border);
}
</style>
</head>
<body data-theme="dark">

<header>
  <div class="logo">
    <div class="eye-container">
      <div class="eye">
        <div class="pupil"></div>
      </div>
    </div>
    <span>SAURON INTEL</span>
  </div>
  <div class="controls">
    <button class="btn active" onclick="setTheme('dark')">üåô Sombre</button>
    <button class="btn" onclick="setTheme('light')">‚òÄÔ∏è Clair</button>
    <button class="btn" onclick="setTheme('matrix')">üü¢ Matrix</button>
    <button class="btn" onclick="exportData('json')">üì• JSON</button>
    <button class="btn" onclick="exportData('csv')">üì• CSV</button>
    <button class="btn" onclick="exportData('md')">üì• MD</button>
    <button class="btn" onclick="exportData('html')">üì• HTML</button>
    <button class="btn" onclick="importData()">üì§ Import</button>
  </div>
</header>

<div class="search-bar">
  <input type="text" id="search" placeholder="üîç Rechercher une entit√©..." oninput="filterCells()">
  <select id="categoryFilter" onchange="filterCells()">
    <option value="">Toutes cat√©gories</option>
    <option value="personne">üë§ Personne</option>
    <option value="entreprise">üè¢ Entreprise</option>
    <option value="organisation">üåê Organisation</option>
    <option value="lieu">üìç Lieu</option>
    <option value="evenement">üìÖ √âv√©nement</option>
    <option value="media">üì∫ M√©dia</option>
    <option value="autre">üìÅ Autre</option>
  </select>
</div>

<div class="stats" id="stats">0/300 fiches renseign√©es</div>

<div class="grid" id="grid"></div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h3 id="modalTitle">Fiche #1</h3>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Nom / Titre</label>
        <input type="text" id="fName" placeholder="Nom de l'entit√©">
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <select id="fCategory">
          <option value="">-- Choisir --</option>
          <option value="personne">üë§ Personne</option>
          <option value="entreprise">üè¢ Entreprise</option>
          <option value="organisation">üåê Organisation</option>
          <option value="lieu">üìç Lieu</option>
          <option value="evenement">üìÖ √âv√©nement</option>
          <option value="media">üì∫ M√©dia</option>
          <option value="autre">üìÅ Autre</option>
        </select>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="fDescription" placeholder="Description d√©taill√©e..."></textarea>
      </div>
      <div class="form-group">
        <label>Couleur</label>
        <div class="color-row">
          <input type="color" id="fColor" value="#86efac">
          <span id="colorHex">#86efac</span>
        </div>
      </div>
      <div class="form-group">
        <label>Logo / Photo (URL)</label>
        <input type="url" id="fLogo" placeholder="https://..." oninput="previewMedia('logo')">
        <div class="media-preview" id="logoPreview"></div>
      </div>
      <div class="form-group">
        <label>M√©dia embed (URL vid√©o/image/iframe)</label>
        <input type="url" id="fMedia" placeholder="https://..." oninput="previewMedia('media')">
        <div class="media-preview" id="mediaPreview"></div>
      </div>
      <div class="form-group">
        <label>Fichiers li√©s (URLs, s√©par√©es par virgule)</label>
        <input type="text" id="fFiles" placeholder="https://doc1.pdf, https://doc2.pdf">
      </div>
      <div class="form-group">
        <label>Tags (s√©par√©s par virgule)</label>
        <input type="text" id="fTags" placeholder="manipulation, politique, tech...">
      </div>
      <div class="form-group">
        <label>Liens / Relations (IDs s√©par√©s par virgule)</label>
        <input type="text" id="fLinks" placeholder="12, 45, 89">
      </div>
      <div class="form-group">
        <label>Notes priv√©es</label>
        <textarea id="fNotes" placeholder="Notes personnelles..."></textarea>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-primary" onclick="saveCard()">üíæ Sauvegarder</button>
      <button class="btn btn-danger" onclick="deleteCard()">üóëÔ∏è Supprimer</button>
      <button class="btn" onclick="exportCard('json')">üìÑ JSON</button>
      <button class="btn" onclick="exportCard('md')">üìÑ MD</button>
      <button class="btn" onclick="exportCard('html')">üìÑ HTML</button>
    </div>
  </div>
</div>

<input type="file" id="fileInput" accept=".json" style="display:none" onchange="handleImport(event)">

<script>
const TOTAL_CELLS = 300;
let cards = {};
let currentCell = null;

// Init
function init() {
  loadData();
  renderGrid();
  updateStats();
  document.getElementById('fColor').addEventListener('input', e => {
    document.getElementById('colorHex').textContent = e.target.value;
  });
}

function loadData() {
  try {
    const saved = localStorage.getItem('sauronCards');
    if (saved) cards = JSON.parse(saved);
  } catch(e) { cards = {}; }
}

function saveData() {
  localStorage.setItem('sauronCards', JSON.stringify(cards));
  updateStats();
}

function renderGrid() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  for (let i = 1; i <= TOTAL_CELLS; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell' + (cards[i] ? ' filled' : '');
    cell.dataset.id = i;
    cell.onclick = () => openModal(i);
    
    if (cards[i]) {
      if (cards[i].logo) {
        cell.innerHTML = `<img class="cell-logo" src="${cards[i].logo}" alt="">`;
      } else if (cards[i].name) {
        cell.innerHTML = `<span class="cell-initial">${cards[i].name.charAt(0).toUpperCase()}</span>`;
      }
      if (cards[i].color) {
        cell.style.borderColor = cards[i].color;
        cell.style.boxShadow = `inset 0 0 10px ${cards[i].color}33`;
      }
    } else {
      cell.textContent = i;
    }
    grid.appendChild(cell);
  }
}

function openModal(id) {
  currentCell = id;
  const card = cards[id] || {};
  document.getElementById('modalTitle').textContent = `Fiche #${id}`;
  document.getElementById('fName').value = card.name || '';
  document.getElementById('fCategory').value = card.category || '';
  document.getElementById('fDescription').value = card.description || '';
  document.getElementById('fColor').value = card.color || '#86efac';
  document.getElementById('colorHex').textContent = card.color || '#86efac';
  document.getElementById('fLogo').value = card.logo || '';
  document.getElementById('fMedia').value = card.media || '';
  document.getElementById('fFiles').value = (card.files || []).join(', ');
  document.getElementById('fTags').value = (card.tags || []).join(', ');
  document.getElementById('fLinks').value = (card.links || []).join(', ');
  document.getElementById('fNotes').value = card.notes || '';
  previewMedia('logo');
  previewMedia('media');
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal(e) {
  if (e && e.target !== e.currentTarget) return;
  document.getElementById('modalOverlay').classList.remove('open');
  currentCell = null;
}

function saveCard() {
  const name = document.getElementById('fName').value.trim();
  if (!name) { alert('Le nom est requis'); return; }
  
  cards[currentCell] = {
    name,
    category: document.getElementById('fCategory').value,
    description: document.getElementById('fDescription').value,
    color: document.getElementById('fColor').value,
    logo: document.getElementById('fLogo').value,
    media: document.getElementById('fMedia').value,
    files: document.getElementById('fFiles').value.split(',').map(s => s.trim()).filter(Boolean),
    tags: document.getElementById('fTags').value.split(',').map(s => s.trim()).filter(Boolean),
    links: document.getElementById('fLinks').value.split(',').map(s => s.trim()).filter(Boolean),
    notes: document.getElementById('fNotes').value,
    updated: new Date().toISOString()
  };
  saveData();
  renderGrid();
  closeModal();
}

function deleteCard() {
  if (!confirm('Supprimer cette fiche ?')) return;
  delete cards[currentCell];
  saveData();
  renderGrid();
  closeModal();
}

function previewMedia(type) {
  const input = type === 'logo' ? document.getElementById('fLogo') : document.getElementById('fMedia');
  const preview = type === 'logo' ? document.getElementById('logoPreview') : document.getElementById('mediaPreview');
  const url = input.value.trim();
  
  if (!url) { preview.innerHTML = ''; return; }
  
  if (url.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i) || url.includes('picsum') || url.includes('unsplash')) {
    preview.innerHTML = `<img src="${url}" alt="preview">`;
  } else if (url.match(/\.(mp4|webm|ogg)$/i)) {
    preview.innerHTML = `<video src="${url}" controls muted></video>`;
  } else if (url.includes('youtube') || url.includes('vimeo')) {
    preview.innerHTML = `<iframe src="${url}" frameborder="0"></iframe>`;
  } else {
    preview.innerHTML = `<a href="${url}" target="_blank" style="color:var(--accent)">${url}</a>`;
  }
}

function filterCells() {
  const search = document.getElementById('search').value.toLowerCase();
  const category = document.getElementById('categoryFilter').value;
  const cells = document.querySelectorAll('.cell');
  
  cells.forEach(cell => {
    const id = parseInt(cell.dataset.id);
    const card = cards[id];
    let show = true;
    
    if (card) {
      if (search && !card.name.toLowerCase().includes(search) && 
          !(card.tags || []).some(t => t.toLowerCase().includes(search))) {
        show = false;
      }
      if (category && card.category !== category) show = false;
    } else {
      if (search || category) show = false;
    }
    
    cell.style.display = show ? '' : 'none';
  });
}

function updateStats() {
  const filled = Object.keys(cards).length;
  document.getElementById('stats').textContent = `${filled}/${TOTAL_CELLS} fiches renseign√©es`;
}

function setTheme(theme) {
  document.body.dataset.theme = theme;
  document.querySelectorAll('.controls .btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

function exportData(format) {
  let content, filename, type;
  
  if (format === 'json') {
    content = JSON.stringify(cards, null, 2);
    filename = 'sauron-intel.json';
    type = 'application/json';
  } else if (format === 'csv') {
    const headers = ['ID', 'Nom', 'Cat√©gorie', 'Description', 'Couleur', 'Logo', 'M√©dia', 'Tags', 'Liens', 'M√†J'];
    const rows = Object.entries(cards).map(([id, c]) => [
      id, c.name, c.category, c.description, c.color, c.logo, c.media, 
      (c.tags||[]).join(';'), (c.links||[]).join(';'), c.updated
    ].map(v => `"${(v||'').replace(/"/g, '""')}"`).join(','));
    content = [headers.join(','), ...rows].join('\n');
    filename = 'sauron-intel.csv';
    type = 'text/csv';
  } else if (format === 'md') {
    content = `# üî¥ SAURON INTEL - Base de donn√©es\n\n`;
    content += `> Export√© le ${new Date().toLocaleString('fr-FR')}\n\n`;
    content += `---\n\n`;
    Object.entries(cards).forEach(([id, c]) => {
      content += `## #${id} - ${c.name}\n\n`;
      if (c.category) content += `**Cat√©gorie:** ${c.category}\n\n`;
      if (c.description) content += `${c.description}\n\n`;
      if (c.color) content += `**Couleur:** \`${c.color}\`\n\n`;
      if (c.logo) content += `**Logo:** ![logo](${c.logo})\n\n`;
      if (c.media) content += `**M√©dia:** [Lien](${c.media})\n\n`;
      if (c.files?.length) content += `**Fichiers:**\n${c.files.map(f => `- [${f}](${f})`).join('\n')}\n\n`;
      if (c.tags?.length) content += `**Tags:** ${c.tags.map(t => `\`${t}\``).join(' ')}\n\n`;
      if (c.links?.length) content += `**Relations:** ${c.links.join(', ')}\n\n`;
      if (c.notes) content += `**Notes:** ${c.notes}\n\n`;
      content += `---\n\n`;
    });
    filename = 'sauron-intel.md';
    type = 'text/markdown';
  } else if (format === 'html') {
    content = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>SAURON INTEL Export</title>
<style>body{font-family:system-ui;background:#0a0a0f;color:#a7f3d0;padding:2rem;max-width:900px;margin:auto}
h1{color:#ef4444;text-align:center}h2{color:#c4b5fd;border-bottom:1px solid #333;padding-bottom:0.5rem}
.card{background:#12121a;border:1px solid #86efac33;border-radius:8px;padding:1rem;margin:1rem 0}
.tag{background:#7c3aed33;padding:2px 8px;border-radius:4px;margin:2px;display:inline-block;font-size:0.8rem}
img{max-width:200px;border-radius:4px}a{color:#86efac}</style></head><body>
<h1>üî¥ SAURON INTEL</h1><p style="text-align:center;opacity:0.7">Export√© le ${new Date().toLocaleString('fr-FR')}</p>`;
    Object.entries(cards).forEach(([id, c]) => {
      content += `<div class="card" style="border-color:${c.color || '#86efac33'}">`;
      content += `<h2>#${id} - ${c.name}</h2>`;
      if (c.category) content += `<p><strong>Cat√©gorie:</strong> ${c.category}</p>`;
      if (c.description) content += `<p>${c.description}</p>`;
      if (c.logo) content += `<p><img src="${c.logo}" alt="logo"></p>`;
      if (c.media) content += `<p><strong>M√©dia:</strong> <a href="${c.media}" target="_blank">${c.media}</a></p>`;
      if (c.files?.length) content += `<p><strong>Fichiers:</strong> ${c.files.map(f => `<a href="${f}" target="_blank">${f}</a>`).join(', ')}</p>`;
      if (c.tags?.length) content += `<p><strong>Tags:</strong> ${c.tags.map(t => `<span class="tag">${t}</span>`).join(' ')}</p>`;
      if (c.links?.length) content += `<p><strong>Relations:</strong> ${c.links.join(', ')}</p>`;
      if (c.notes) content += `<p><strong>Notes:</strong> ${c.notes}</p>`;
      content += `</div>`;
    });
    content += `</body></html>`;
    filename = 'sauron-intel.html';
    type = 'text/html';
  }
  
  const blob = new Blob([content], {type});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

function exportCard(format) {
  const card = cards[currentCell];
  if (!card) { alert('Aucune fiche √† exporter'); return; }
  
  let content, filename, type;
  const safeName = card.name.replace(/[^a-zA-Z0-9]/g, '_');
  
  if (format === 'json') {
    content = JSON.stringify({[currentCell]: card}, null, 2);
    filename = `fiche-${currentCell}-${safeName}.json`;
    type = 'application/json';
  } else if (format === 'md') {
    content = `# #${currentCell} - ${card.name}\n\n`;
    if (card.category) content += `**Cat√©gorie:** ${card.category}\n\n`;
    if (card.description) content += `${card.description}\n\n`;
    if (card.color) content += `**Couleur:** \`${card.color}\`\n\n`;
    if (card.logo) content += `**Logo:** ![logo](${card.logo})\n\n`;
    if (card.media) content += `**M√©dia:** [Lien](${card.media})\n\n`;
    if (card.files?.length) content += `**Fichiers:**\n${card.files.map(f => `- [${f}](${f})`).join('\n')}\n\n`;
    if (card.tags?.length) content += `**Tags:** ${card.tags.map(t => `\`${t}\``).join(' ')}\n\n`;
    if (card.links?.length) content += `**Relations:** ${card.links.join(', ')}\n\n`;
    if (card.notes) content += `**Notes:** ${card.notes}\n\n`;
    filename = `fiche-${currentCell}-${safeName}.md`;
    type = 'text/markdown';
  } else if (format === 'html') {
    content = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>${card.name}</title>
<style>body{font-family:system-ui;background:#0a0a0f;color:#a7f3d0;padding:2rem;max-width:600px;margin:auto}
h1{color:#c4b5fd}img{max-width:100%;border-radius:8px}a{color:#86efac}
.tag{background:#7c3aed33;padding:2px 8px;border-radius:4px;margin:2px;display:inline-block}</style></head><body>
<h1 style="border-left:4px solid ${card.color || '#86efac'};padding-left:1rem">#${currentCell} - ${card.name}</h1>`;
    if (card.category) content += `<p><strong>Cat√©gorie:</strong> ${card.category}</p>`;
    if (card.description) content += `<p>${card.description}</p>`;
    if (card.logo) content += `<p><img src="${card.logo}" alt="logo"></p>`;
    if (card.media) content += `<p><strong>M√©dia:</strong> <a href="${card.media}" target="_blank">${card.media}</a></p>`;
    if (card.files?.length) content += `<p><strong>Fichiers:</strong><br>${card.files.map(f => `<a href="${f}" target="_blank">${f}</a>`).join('<br>')}</p>`;
    if (card.tags?.length) content += `<p><strong>Tags:</strong> ${card.tags.map(t => `<span class="tag">${t}</span>`).join(' ')}</p>`;
    if (card.links?.length) content += `<p><strong>Relations:</strong> ${card.links.join(', ')}</p>`;
    if (card.notes) content += `<p><strong>Notes:</strong> ${card.notes}</p>`;
    content += `</body></html>`;
    filename = `fiche-${currentCell}-${safeName}.html`;
    type = 'text/html';
  }
  
  const blob = new Blob([content], {type});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(a.href);
}

function importData() {
  document.getElementById('fileInput').click();
}

function handleImport(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (event) => {
    try {
      const imported = JSON.parse(event.target.result);
      Object.assign(cards, imported);
      saveData();
      renderGrid();
      alert('Import r√©ussi !');
    } catch(err) {
      alert('Erreur de parsing JSON');
    }
  };
  reader.readAsText(file);
  e.target.value = '';
}

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModal();
});

init();
</script>
</body>
</html>
