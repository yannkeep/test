<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ePOP!up ‚Äî FlashForge // Syst√®me de M√©morisation</title>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}

/* ============================================
   CHARTE GRAPHIQUE ePOP!up ‚Äî SUBLIM√âE
   ============================================ */

:root{
  /* Fonds ‚Äî D√©grad√© de profondeur */
  --bg-abyss:#010104;
  --bg-deep:#030308;
  --bg-dark:#080810;
  --bg-base:#0c0e1c;
  --bg-elevated:#12142a;
  --bg-surface:#181a32;
  --bg-float:#1e2040;
  
  /* Panels Glass */
  --panel:rgba(12,14,28,0.75);
  --panel-solid:#0c0e1c;
  --panel-hover:rgba(20,22,40,0.85);
  --panel-active:rgba(28,30,52,0.9);
  
  /* Bordures */
  --border:#1e2040;
  --border-dim:#151730;
  --border-bright:#2a2d50;
  --border-glow:rgba(177,156,217,0.4);
  --border-glow-green:rgba(0,255,136,0.4);
  
  /* Textes */
  --text:#e8eaf0;
  --text-bright:#ffffff;
  --text-dim:#8892b0;
  --text-muted:#5a6080;
  --text-ghost:#3a4060;
  
  /* Couleur signature ‚Äî Lilac */
  --lilac:#b19cd9;
  --lilac-bright:#d4c4ff;
  --lilac-dim:#8b7aaf;
  --lilac-dark:#6b5a8f;
  --lilac-glow:rgba(177,156,217,0.6);
  
  /* Accent primaire ‚Äî Green */
  --green:#00ff88;
  --green-bright:#50ffaa;
  --green-dim:#00cc6a;
  --green-dark:#009950;
  --green-glow:rgba(0,255,136,0.6);
  
  /* Accent secondaire ‚Äî Cyan */
  --cyan:#00f0ff;
  --cyan-bright:#60f8ff;
  --cyan-dim:#00c0cc;
  --cyan-glow:rgba(0,240,255,0.5);
  
  /* Accent tertiaire ‚Äî Magenta */
  --magenta:#ff00aa;
  --magenta-bright:#ff50cc;
  --magenta-dim:#cc0088;
  --magenta-glow:rgba(255,0,170,0.5);
  
  /* Accent quaternaire ‚Äî Purple */
  --purple:#8b5cf6;
  --purple-bright:#a78bfa;
  --purple-dim:#7c3aed;
  
  /* √âtats s√©mantiques */
  --success:#00ff88;
  --warning:#ffa502;
  --danger:#ff4757;
  --info:#00f0ff;
  
  /* Spaced Repetition Colors */
  --sr-again:#ff4757;
  --sr-hard:#ffa502;
  --sr-good:#00ff88;
  --sr-easy:#00f0ff;
  
  /* Rayons */
  --radius-sm:6px;
  --radius:10px;
  --radius-lg:14px;
  --radius-xl:20px;
  --radius-full:9999px;
  
  /* Typographie */
  --font-mono:'Fira Code',monospace;
  --font-sans:'Space Grotesk',system-ui,sans-serif;
  
  /* Ombres */
  --shadow-sm:0 2px 8px rgba(0,0,0,0.3);
  --shadow-md:0 4px 20px rgba(0,0,0,0.4);
  --shadow-lg:0 8px 40px rgba(0,0,0,0.5);
  --shadow-glow-lilac:0 0 30px var(--lilac-glow);
  --shadow-glow-green:0 0 30px var(--green-glow);
  --shadow-glow-cyan:0 0 30px var(--cyan-glow);
  
  /* Transitions */
  --transition-fast:0.15s cubic-bezier(0.4,0,0.2,1);
  --transition-base:0.25s cubic-bezier(0.4,0,0.2,1);
  --transition-slow:0.4s cubic-bezier(0.4,0,0.2,1);
  --transition-bounce:0.5s cubic-bezier(0.68,-0.55,0.265,1.55);
}

html,body{
  height:100%;
  overflow:hidden;
}

body{
  font-family:var(--font-mono);
  background:var(--bg-deep);
  color:var(--text);
  line-height:1.6;
}

/* ============================================
   EFFETS DE FOND
   ============================================ */

/* Aurora ‚Äî Gradient anim√© */
.aurora{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  overflow:hidden;
}

.aurora::before{
  content:'';
  position:absolute;
  width:250%;
  height:250%;
  top:-75%;
  left:-75%;
  background:
    radial-gradient(ellipse 60% 40% at 25% 30%, rgba(177,156,217,0.15), transparent 50%),
    radial-gradient(ellipse 50% 35% at 75% 70%, rgba(0,255,136,0.1), transparent 50%),
    radial-gradient(ellipse 45% 30% at 50% 50%, rgba(0,240,255,0.08), transparent 50%),
    radial-gradient(ellipse 70% 45% at 80% 20%, rgba(139,92,246,0.1), transparent 50%);
  animation:auroraMove 30s ease-in-out infinite;
}

@keyframes auroraMove{
  0%,100%{transform:translate(0,0) rotate(0deg) scale(1)}
  25%{transform:translate(3%,2%) rotate(1deg) scale(1.02)}
  50%{transform:translate(-2%,4%) rotate(-1deg) scale(1.01)}
  75%{transform:translate(2%,-2%) rotate(0.5deg) scale(1.03)}
}

/* Blobs flottants */
.blob{
  position:fixed;
  border-radius:50%;
  filter:blur(80px);
  pointer-events:none;
  z-index:0;
  mix-blend-mode:screen;
  opacity:0.5;
}

.blob-1{
  width:600px;
  height:600px;
  background:radial-gradient(circle, rgba(177,156,217,0.3), transparent 70%);
  top:-200px;
  left:-200px;
  animation:blobFloat1 25s ease-in-out infinite;
}

.blob-2{
  width:500px;
  height:500px;
  background:radial-gradient(circle, rgba(0,255,136,0.25), transparent 70%);
  bottom:-150px;
  right:-150px;
  animation:blobFloat2 30s ease-in-out infinite;
}

.blob-3{
  width:400px;
  height:400px;
  background:radial-gradient(circle, rgba(0,240,255,0.2), transparent 70%);
  top:40%;
  left:60%;
  animation:blobFloat3 20s ease-in-out infinite;
}

.blob-4{
  width:350px;
  height:350px;
  background:radial-gradient(circle, rgba(255,0,170,0.15), transparent 70%);
  bottom:20%;
  left:10%;
  animation:blobFloat4 35s ease-in-out infinite;
}

@keyframes blobFloat1{
  0%,100%{transform:translate(0,0) scale(1)}
  50%{transform:translate(100px,80px) scale(1.2)}
}
@keyframes blobFloat2{
  0%,100%{transform:translate(0,0) scale(1)}
  50%{transform:translate(-80px,-60px) scale(1.15)}
}
@keyframes blobFloat3{
  0%,100%{transform:translate(-50%,-50%) scale(1)}
  50%{transform:translate(-50%,-50%) scale(1.3)}
}
@keyframes blobFloat4{
  0%,100%{transform:translate(0,0) scale(1)}
  50%{transform:translate(60px,-40px) scale(1.1)}
}

/* Grid background */
.grid-bg{
  position:fixed;
  inset:0;
  z-index:1;
  pointer-events:none;
  background-image:
    linear-gradient(rgba(177,156,217,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(177,156,217,0.03) 1px, transparent 1px);
  background-size:60px 60px;
  mask-image:radial-gradient(ellipse 80% 80% at 50% 50%, black, transparent);
}

/* Scanline */
.scanline{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:3px;
  background:linear-gradient(90deg, transparent, var(--lilac), var(--cyan), var(--green), var(--lilac), transparent);
  animation:scanMove 6s linear infinite;
  opacity:0.7;
  pointer-events:none;
  z-index:9998;
  box-shadow:0 0 20px var(--lilac-glow), 0 0 40px var(--cyan-glow);
}

@keyframes scanMove{
  0%{transform:translateY(-100%)}
  100%{transform:translateY(100vh)}
}

/* CRT effect */
.crt-lines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.03) 2px,
    rgba(0,0,0,0.03) 4px
  );
  pointer-events:none;
  z-index:9997;
}

/* Noise texture */
.noise{
  position:fixed;
  inset:0;
  z-index:9996;
  pointer-events:none;
  opacity:0.015;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
}

/* ============================================
   LAYOUT PRINCIPAL
   ============================================ */

.app{
  position:relative;
  z-index:10;
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* Header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:1rem 1.5rem;
  background:var(--panel);
  backdrop-filter:blur(20px) saturate(180%);
  border-bottom:1px solid var(--border);
  position:relative;
}

.header::before{
  content:'';
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  height:1px;
  background:linear-gradient(90deg, transparent, var(--lilac-dim), var(--green-dim), var(--lilac-dim), transparent);
}

.logo{
  display:flex;
  align-items:center;
  gap:0.75rem;
}

.logo-icon{
  width:44px;
  height:44px;
  background:linear-gradient(135deg, var(--lilac), var(--purple));
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.5rem;
  box-shadow:var(--shadow-glow-lilac);
}

.logo-text{
  font-family:var(--font-sans);
  font-size:1.4rem;
  font-weight:700;
  letter-spacing:0.1em;
  text-transform:uppercase;
  background:linear-gradient(135deg, var(--lilac-bright), var(--cyan), var(--green));
  background-size:200% 200%;
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  animation:gradientFlow 8s ease infinite;
}

@keyframes gradientFlow{
  0%,100%{background-position:0% 50%}
  50%{background-position:100% 50%}
}

.logo-sub{
  font-size:0.7rem;
  color:var(--text-dim);
  letter-spacing:0.2em;
}

/* Nav Tabs */
.nav-tabs{
  display:flex;
  gap:0.5rem;
}

.nav-tab{
  padding:0.6rem 1.2rem;
  background:transparent;
  border:1px solid transparent;
  border-radius:var(--radius);
  color:var(--text-dim);
  font-family:var(--font-mono);
  font-size:0.85rem;
  cursor:pointer;
  transition:var(--transition-base);
  display:flex;
  align-items:center;
  gap:0.5rem;
}

.nav-tab:hover{
  color:var(--text);
  background:var(--panel-hover);
  border-color:var(--border);
}

.nav-tab.active{
  color:var(--green);
  background:rgba(0,255,136,0.1);
  border-color:var(--green-dim);
  box-shadow:var(--shadow-glow-green);
}

.nav-tab-icon{font-size:1.1rem}

/* Header Actions */
.header-actions{
  display:flex;
  gap:0.75rem;
}

.btn{
  padding:0.6rem 1rem;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-family:var(--font-mono);
  font-size:0.8rem;
  cursor:pointer;
  transition:var(--transition-base);
  display:flex;
  align-items:center;
  gap:0.4rem;
}

.btn:hover{
  background:var(--panel-hover);
  border-color:var(--lilac-dim);
  transform:translateY(-2px);
  box-shadow:var(--shadow-glow-lilac);
}

.btn-primary{
  background:linear-gradient(135deg, var(--lilac-dim), var(--purple));
  border-color:var(--lilac);
  color:var(--text-bright);
}

.btn-primary:hover{
  background:linear-gradient(135deg, var(--lilac), var(--purple-bright));
  box-shadow:var(--shadow-glow-lilac);
}

.btn-success{
  background:rgba(0,255,136,0.15);
  border-color:var(--green-dim);
  color:var(--green);
}

.btn-success:hover{
  background:rgba(0,255,136,0.25);
  border-color:var(--green);
  box-shadow:var(--shadow-glow-green);
}

.btn-danger{
  background:rgba(255,71,87,0.15);
  border-color:rgba(255,71,87,0.3);
  color:var(--danger);
}

.btn-danger:hover{
  background:rgba(255,71,87,0.25);
  border-color:var(--danger);
}

/* ============================================
   MAIN CONTENT
   ============================================ */

.main{
  flex:1;
  display:flex;
  overflow:hidden;
}

/* Sidebar */
.sidebar{
  width:280px;
  background:var(--panel);
  backdrop-filter:blur(20px);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.sidebar-header{
  padding:1rem;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.sidebar-title{
  font-size:0.75rem;
  font-weight:600;
  color:var(--text-dim);
  text-transform:uppercase;
  letter-spacing:0.15em;
}

.sidebar-action{
  width:28px;
  height:28px;
  background:var(--bg-elevated);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  color:var(--lilac);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:var(--transition-fast);
}

.sidebar-action:hover{
  background:var(--panel-hover);
  border-color:var(--lilac);
  box-shadow:var(--shadow-glow-lilac);
}

/* Deck List */
.deck-list{
  flex:1;
  overflow-y:auto;
  padding:0.5rem;
}

.deck-item{
  padding:0.85rem 1rem;
  background:transparent;
  border:1px solid transparent;
  border-radius:var(--radius);
  margin-bottom:0.4rem;
  cursor:pointer;
  transition:var(--transition-base);
  position:relative;
  overflow:hidden;
}

.deck-item::before{
  content:'';
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:3px;
  background:var(--lilac);
  opacity:0;
  transition:var(--transition-fast);
}

.deck-item:hover{
  background:var(--panel-hover);
  border-color:var(--border);
}

.deck-item:hover::before{
  opacity:0.5;
}

.deck-item.active{
  background:rgba(0,255,136,0.1);
  border-color:var(--green-dim);
}

.deck-item.active::before{
  background:var(--green);
  opacity:1;
}

.deck-name{
  font-weight:500;
  font-size:0.9rem;
  margin-bottom:0.25rem;
  display:flex;
  align-items:center;
  gap:0.5rem;
}

.deck-item.active .deck-name{
  color:var(--green);
}

.deck-meta{
  display:flex;
  gap:0.75rem;
  font-size:0.7rem;
  color:var(--text-muted);
}

.deck-stat{
  display:flex;
  align-items:center;
  gap:0.25rem;
}

/* Stats Panel */
.stats-panel{
  padding:1rem;
  border-top:1px solid var(--border);
  background:var(--bg-elevated);
}

.stats-title{
  font-size:0.65rem;
  color:var(--text-muted);
  text-transform:uppercase;
  letter-spacing:0.1em;
  margin-bottom:0.75rem;
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:0.5rem;
}

.stat-box{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:0.6rem;
  text-align:center;
}

.stat-value{
  font-family:var(--font-sans);
  font-size:1.25rem;
  font-weight:700;
  color:var(--lilac);
}

.stat-value.green{color:var(--green)}
.stat-value.cyan{color:var(--cyan)}
.stat-value.orange{color:var(--warning)}

.stat-label{
  font-size:0.6rem;
  color:var(--text-muted);
  text-transform:uppercase;
  letter-spacing:0.05em;
}

/* ============================================
   CONTENT AREA
   ============================================ */

.content{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
}

/* Content views */
.view{
  display:none;
  flex:1;
  flex-direction:column;
  overflow:hidden;
}

.view.active{
  display:flex;
}

/* ============================================
   CARDS VIEW
   ============================================ */

.cards-header{
  padding:1rem 1.5rem;
  background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.cards-title{
  font-family:var(--font-sans);
  font-size:1.1rem;
  font-weight:600;
}

.cards-count{
  font-size:0.8rem;
  color:var(--text-dim);
}

.cards-actions{
  display:flex;
  gap:0.5rem;
}

.search-box{
  display:flex;
  align-items:center;
  background:var(--bg-elevated);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:0 0.75rem;
  transition:var(--transition-fast);
}

.search-box:focus-within{
  border-color:var(--lilac);
  box-shadow:var(--shadow-glow-lilac);
}

.search-icon{
  color:var(--text-muted);
  margin-right:0.5rem;
}

.search-input{
  background:none;
  border:none;
  color:var(--text);
  font-family:var(--font-mono);
  font-size:0.85rem;
  padding:0.5rem 0;
  width:180px;
}

.search-input:focus{outline:none}
.search-input::placeholder{color:var(--text-muted)}

/* Cards Grid */
.cards-scroll{
  flex:1;
  overflow-y:auto;
  padding:1.5rem;
}

.cards-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));
  gap:1rem;
}

.card-item{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:1.25rem;
  cursor:pointer;
  transition:var(--transition-base);
  position:relative;
  overflow:hidden;
}

.card-item::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:3px;
  background:linear-gradient(90deg, var(--lilac), var(--cyan));
  opacity:0;
  transition:var(--transition-fast);
}

.card-item:hover{
  border-color:var(--lilac-dim);
  transform:translateY(-4px);
  box-shadow:var(--shadow-md), var(--shadow-glow-lilac);
}

.card-item:hover::before{
  opacity:1;
}

.card-question{
  font-size:0.9rem;
  color:var(--text);
  margin-bottom:0.75rem;
  line-height:1.5;
  display:-webkit-box;
  -webkit-line-clamp:3;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

.card-answer{
  font-size:0.8rem;
  color:var(--text-dim);
  line-height:1.5;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  padding-top:0.75rem;
  border-top:1px solid var(--border-dim);
}

.card-footer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:0.75rem;
  padding-top:0.75rem;
  border-top:1px solid var(--border-dim);
}

.card-level{
  display:flex;
  gap:3px;
}

.level-dot{
  width:8px;
  height:8px;
  border-radius:50%;
  background:var(--border);
}

.level-dot.filled{background:var(--green)}
.level-dot.half{background:var(--warning)}

.card-actions{
  display:flex;
  gap:0.35rem;
  opacity:0;
  transition:var(--transition-fast);
}

.card-item:hover .card-actions{
  opacity:1;
}

.card-action{
  width:28px;
  height:28px;
  background:var(--bg-elevated);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  color:var(--text-dim);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:0.8rem;
  transition:var(--transition-fast);
}

.card-action:hover{
  color:var(--lilac);
  border-color:var(--lilac);
}

.card-action.delete:hover{
  color:var(--danger);
  border-color:var(--danger);
}

/* Empty state */
.empty-state{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:4rem 2rem;
  text-align:center;
}

.empty-icon{
  font-size:4rem;
  margin-bottom:1rem;
  opacity:0.3;
}

.empty-title{
  font-family:var(--font-sans);
  font-size:1.25rem;
  font-weight:600;
  margin-bottom:0.5rem;
  color:var(--text-dim);
}

.empty-text{
  font-size:0.85rem;
  color:var(--text-muted);
  margin-bottom:1.5rem;
}

/* ============================================
   STUDY VIEW
   ============================================ */

.study-container{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:2rem;
}

.study-progress{
  width:100%;
  max-width:600px;
  margin-bottom:2rem;
}

.progress-bar{
  height:6px;
  background:var(--bg-elevated);
  border-radius:var(--radius-full);
  overflow:hidden;
  margin-bottom:0.5rem;
}

.progress-fill{
  height:100%;
  background:linear-gradient(90deg, var(--lilac), var(--green));
  border-radius:var(--radius-full);
  transition:width var(--transition-base);
}

.progress-text{
  display:flex;
  justify-content:space-between;
  font-size:0.75rem;
  color:var(--text-muted);
}

/* Flashcard */
.flashcard-container{
  perspective:1500px;
  width:100%;
  max-width:600px;
}

.flashcard{
  width:100%;
  min-height:350px;
  position:relative;
  transform-style:preserve-3d;
  transition:transform 0.6s cubic-bezier(0.4,0,0.2,1);
  cursor:pointer;
}

.flashcard.flipped{
  transform:rotateY(180deg);
}

.flashcard-face{
  position:absolute;
  inset:0;
  backface-visibility:hidden;
  background:var(--panel);
  border:2px solid var(--border);
  border-radius:var(--radius-xl);
  padding:2rem;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  box-shadow:var(--shadow-lg);
}

.flashcard-face::before{
  content:'';
  position:absolute;
  inset:-2px;
  background:linear-gradient(135deg, var(--lilac-dim), var(--cyan-dim), var(--green-dim));
  border-radius:var(--radius-xl);
  z-index:-1;
  opacity:0;
  transition:var(--transition-base);
}

.flashcard:hover .flashcard-face::before{
  opacity:1;
}

.flashcard-front{
  background:linear-gradient(135deg, var(--panel), var(--bg-elevated));
}

.flashcard-back{
  transform:rotateY(180deg);
  background:linear-gradient(135deg, rgba(0,255,136,0.05), var(--panel));
  border-color:var(--green-dim);
}

.flashcard-label{
  font-size:0.7rem;
  font-weight:600;
  color:var(--text-muted);
  text-transform:uppercase;
  letter-spacing:0.15em;
  margin-bottom:1.5rem;
}

.flashcard-back .flashcard-label{
  color:var(--green-dim);
}

.flashcard-text{
  font-family:var(--font-sans);
  font-size:1.25rem;
  line-height:1.6;
  color:var(--text);
}

.flashcard-back .flashcard-text{
  color:var(--green-bright);
}

.flashcard-hint{
  position:absolute;
  bottom:1rem;
  font-size:0.7rem;
  color:var(--text-muted);
}

/* Study Actions */
.study-actions{
  display:flex;
  gap:0.75rem;
  margin-top:2rem;
  flex-wrap:wrap;
  justify-content:center;
}

.study-btn{
  padding:0.85rem 1.5rem;
  background:var(--panel);
  border:2px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-family:var(--font-mono);
  font-size:0.9rem;
  font-weight:500;
  cursor:pointer;
  transition:var(--transition-base);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-width:100px;
}

.study-btn:hover{
  transform:translateY(-3px);
}

.study-btn.again{
  border-color:var(--sr-again);
  color:var(--sr-again);
}
.study-btn.again:hover{
  background:rgba(255,71,87,0.15);
  box-shadow:0 0 20px rgba(255,71,87,0.3);
}

.study-btn.hard{
  border-color:var(--sr-hard);
  color:var(--sr-hard);
}
.study-btn.hard:hover{
  background:rgba(255,165,2,0.15);
  box-shadow:0 0 20px rgba(255,165,2,0.3);
}

.study-btn.good{
  border-color:var(--sr-good);
  color:var(--sr-good);
}
.study-btn.good:hover{
  background:rgba(0,255,136,0.15);
  box-shadow:0 0 20px rgba(0,255,136,0.3);
}

.study-btn.easy{
  border-color:var(--sr-easy);
  color:var(--sr-easy);
}
.study-btn.easy:hover{
  background:rgba(0,240,255,0.15);
  box-shadow:0 0 20px rgba(0,240,255,0.3);
}

.study-btn-label{
  font-size:0.65rem;
  color:var(--text-muted);
  margin-top:0.25rem;
}

/* Study Complete */
.study-complete{
  text-align:center;
  padding:3rem;
}

.complete-icon{
  font-size:5rem;
  margin-bottom:1.5rem;
  animation:celebrateBounce 0.6s ease;
}

@keyframes celebrateBounce{
  0%{transform:scale(0)}
  50%{transform:scale(1.2)}
  100%{transform:scale(1)}
}

.complete-title{
  font-family:var(--font-sans);
  font-size:2rem;
  font-weight:700;
  background:linear-gradient(135deg, var(--green), var(--cyan));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  margin-bottom:0.5rem;
}

.complete-subtitle{
  color:var(--text-dim);
  margin-bottom:2rem;
}

.complete-stats{
  display:flex;
  gap:2rem;
  justify-content:center;
  margin-bottom:2rem;
}

.complete-stat{
  text-align:center;
}

.complete-stat-value{
  font-family:var(--font-sans);
  font-size:2.5rem;
  font-weight:700;
}

.complete-stat-value.green{color:var(--green)}
.complete-stat-value.orange{color:var(--warning)}
.complete-stat-value.red{color:var(--danger)}

.complete-stat-label{
  font-size:0.75rem;
  color:var(--text-muted);
}

/* ============================================
   MODALS
   ============================================ */

.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(3,3,8,0.9);
  backdrop-filter:blur(8px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  padding:2rem;
}

.modal-overlay.active{
  display:flex;
}

.modal{
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius-xl);
  width:100%;
  max-width:500px;
  max-height:90vh;
  overflow:hidden;
  animation:modalIn 0.3s ease;
  box-shadow:var(--shadow-lg), var(--shadow-glow-lilac);
}

@keyframes modalIn{
  from{opacity:0;transform:scale(0.95) translateY(20px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}

.modal-header{
  padding:1.25rem 1.5rem;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.modal-title{
  font-family:var(--font-sans);
  font-size:1.1rem;
  font-weight:600;
}

.modal-close{
  width:32px;
  height:32px;
  background:var(--bg-elevated);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  color:var(--text-dim);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.2rem;
  transition:var(--transition-fast);
}

.modal-close:hover{
  color:var(--danger);
  border-color:var(--danger);
}

.modal-body{
  padding:1.5rem;
  overflow-y:auto;
  max-height:60vh;
}

.modal-footer{
  padding:1rem 1.5rem;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:flex-end;
  gap:0.75rem;
}

/* Form Elements */
.form-group{
  margin-bottom:1.25rem;
}

.form-label{
  display:block;
  font-size:0.8rem;
  font-weight:500;
  color:var(--text-dim);
  margin-bottom:0.5rem;
}

.form-input,
.form-textarea{
  width:100%;
  padding:0.75rem 1rem;
  background:var(--bg-elevated);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-family:var(--font-mono);
  font-size:0.9rem;
  transition:var(--transition-fast);
}

.form-input:focus,
.form-textarea:focus{
  outline:none;
  border-color:var(--lilac);
  box-shadow:var(--shadow-glow-lilac);
}

.form-input::placeholder,
.form-textarea::placeholder{
  color:var(--text-muted);
}

.form-textarea{
  min-height:100px;
  resize:vertical;
  line-height:1.6;
}

/* ============================================
   IMPORT/EXPORT
   ============================================ */

.import-area{
  border:2px dashed var(--border);
  border-radius:var(--radius-lg);
  padding:2rem;
  text-align:center;
  cursor:pointer;
  transition:var(--transition-base);
  background:var(--bg-dark);
}

.import-area:hover{
  border-color:var(--lilac);
  background:rgba(177,156,217,0.05);
}

.import-area.dragover{
  border-color:var(--green);
  background:rgba(0,255,136,0.05);
}

.import-icon{
  font-size:3rem;
  margin-bottom:1rem;
  color:var(--lilac-dim);
}

.import-text{
  color:var(--text-dim);
  margin-bottom:0.5rem;
}

.import-hint{
  font-size:0.75rem;
  color:var(--text-muted);
}

/* ============================================
   TOAST NOTIFICATIONS
   ============================================ */

.toast-container{
  position:fixed;
  bottom:1.5rem;
  right:1.5rem;
  z-index:2000;
  display:flex;
  flex-direction:column;
  gap:0.75rem;
}

.toast{
  padding:1rem 1.25rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  gap:0.75rem;
  animation:toastIn 0.3s ease;
  box-shadow:var(--shadow-lg);
  min-width:280px;
}

@keyframes toastIn{
  from{opacity:0;transform:translateX(100px)}
  to{opacity:1;transform:translateX(0)}
}

.toast.success{border-color:var(--green-dim)}
.toast.error{border-color:var(--danger)}
.toast.info{border-color:var(--cyan-dim)}

.toast-icon{
  font-size:1.25rem;
}

.toast.success .toast-icon{color:var(--green)}
.toast.error .toast-icon{color:var(--danger)}
.toast.info .toast-icon{color:var(--cyan)}

.toast-message{
  flex:1;
  font-size:0.85rem;
}

/* ============================================
   SCROLLBAR
   ============================================ */

::-webkit-scrollbar{
  width:8px;
  height:8px;
}

::-webkit-scrollbar-track{
  background:var(--bg-base);
}

::-webkit-scrollbar-thumb{
  background:var(--border);
  border-radius:4px;
}

::-webkit-scrollbar-thumb:hover{
  background:var(--lilac-dim);
}

/* ============================================
   RESPONSIVE
   ============================================ */

@media(max-width:900px){
  .sidebar{width:220px}
  .cards-grid{grid-template-columns:1fr}
}

@media(max-width:700px){
  .sidebar{display:none}
  .header{flex-wrap:wrap;gap:1rem}
  .nav-tabs{order:3;width:100%;justify-content:center}
}
</style>
</head>
<body>

<!-- Background Effects -->
<div class="aurora"></div>
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>
<div class="blob blob-4"></div>
<div class="grid-bg"></div>
<div class="scanline"></div>
<div class="crt-lines"></div>
<div class="noise"></div>

<!-- App -->
<div class="app">
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <div class="logo-icon">‚ö°</div>
      <div>
        <div class="logo-text">FlashForge</div>
        <div class="logo-sub">M√©morisation Augment√©e</div>
      </div>
    </div>
    
    <div class="nav-tabs">
      <button class="nav-tab active" data-view="cards">
        <span class="nav-tab-icon">üìö</span>
        <span>Cartes</span>
      </button>
      <button class="nav-tab" data-view="study">
        <span class="nav-tab-icon">üéØ</span>
        <span>√âtudier</span>
      </button>
    </div>
    
    <div class="header-actions">
      <button class="btn" onclick="openImportModal()">
        <span>üì•</span> Import
      </button>
      <button class="btn" onclick="exportDeck()">
        <span>üì§</span> Export
      </button>
      <button class="btn btn-primary" onclick="openCardModal()">
        <span>‚ûï</span> Nouvelle carte
      </button>
    </div>
  </header>

  <!-- Main -->
  <main class="main">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <span class="sidebar-title">Mes Decks</span>
        <button class="sidebar-action" onclick="openDeckModal()" title="Nouveau deck">‚ûï</button>
      </div>
      
      <div class="deck-list" id="deckList">
        <!-- Populated by JS -->
      </div>
      
      <div class="stats-panel">
        <div class="stats-title">Statistiques globales</div>
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">Cartes</div>
          </div>
          <div class="stat-box">
            <div class="stat-value green" id="statMastered">0</div>
            <div class="stat-label">Ma√Ætris√©es</div>
          </div>
          <div class="stat-box">
            <div class="stat-value cyan" id="statToReview">0</div>
            <div class="stat-label">√Ä revoir</div>
          </div>
          <div class="stat-box">
            <div class="stat-value orange" id="statNew">0</div>
            <div class="stat-label">Nouvelles</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Content -->
    <div class="content">
      <!-- Cards View -->
      <div class="view active" id="viewCards">
        <div class="cards-header">
          <div>
            <h2 class="cards-title" id="currentDeckName">Toutes les cartes</h2>
            <span class="cards-count" id="cardsCount">0 cartes</span>
          </div>
          <div class="cards-actions">
            <div class="search-box">
              <span class="search-icon">üîç</span>
              <input type="text" class="search-input" id="searchInput" placeholder="Rechercher...">
            </div>
          </div>
        </div>
        
        <div class="cards-scroll">
          <div class="cards-grid" id="cardsGrid">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>

      <!-- Study View -->
      <div class="view" id="viewStudy">
        <div class="study-container" id="studyContainer">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal: New/Edit Card -->
<div class="modal-overlay" id="cardModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title" id="cardModalTitle">Nouvelle carte</h3>
      <button class="modal-close" onclick="closeCardModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Question (recto)</label>
        <textarea class="form-textarea" id="cardQuestion" placeholder="Entrez la question..."></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">R√©ponse (verso)</label>
        <textarea class="form-textarea" id="cardAnswer" placeholder="Entrez la r√©ponse..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeCardModal()">Annuler</button>
      <button class="btn btn-success" onclick="saveCard()">üíæ Enregistrer</button>
    </div>
  </div>
</div>

<!-- Modal: New Deck -->
<div class="modal-overlay" id="deckModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Nouveau deck</h3>
      <button class="modal-close" onclick="closeDeckModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Nom du deck</label>
        <input type="text" class="form-input" id="deckName" placeholder="Ex: Particratie Belge">
      </div>
      <div class="form-group">
        <label class="form-label">Description (optionnel)</label>
        <input type="text" class="form-input" id="deckDescription" placeholder="Ex: Concepts cl√©s du syst√®me politique belge">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeDeckModal()">Annuler</button>
      <button class="btn btn-success" onclick="saveDeck()">üíæ Cr√©er</button>
    </div>
  </div>
</div>

<!-- Modal: Import -->
<div class="modal-overlay" id="importModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Importer des cartes</h3>
      <button class="modal-close" onclick="closeImportModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="import-area" id="importArea" onclick="document.getElementById('importFile').click()">
        <div class="import-icon">üìÅ</div>
        <div class="import-text">Glissez un fichier CSV ici</div>
        <div class="import-hint">ou cliquez pour s√©lectionner</div>
        <input type="file" id="importFile" accept=".csv" style="display:none">
      </div>
      <p style="font-size:0.75rem;color:var(--text-muted);margin-top:1rem;text-align:center">
        Format attendu : Question,R√©ponse (une carte par ligne)
      </p>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
// ============================================
// DATA STRUCTURE
// ============================================

const DEFAULT_DECK_ID = 'citoyennete-belge';

const DEMO_DECK = {
  id: DEFAULT_DECK_ID,
  name: 'üáßüá™ Citoyennet√© Belge',
  description: 'Comprendre le syst√®me politique belge',
  cards: [
    // Particratie
    { id: 'p1', question: "Qu'est-ce que la particratie ?", answer: "Syst√®me o√π le pouvoir r√©el appartient aux √©tats-majors des partis politiques plut√¥t qu'aux √©lus ou aux citoyens. En Belgique, les d√©cisions sont souvent prises dans les bureaux de parti avant d'√™tre valid√©es au Parlement.", level: 0, lastReview: null, nextReview: null },
    { id: 'p2', question: "Qu'est-ce que la 'lasagne institutionnelle' belge ?", answer: "Expression d√©signant la superposition des niveaux de pouvoir en Belgique : √âtat f√©d√©ral, 3 R√©gions, 3 Communaut√©s, 10 Provinces, 581 Communes. Cette complexit√© g√©n√®re des co√ªts et de l'opacit√©.", level: 0, lastReview: null, nextReview: null },
    { id: 'p3', question: "Que signifie l'effet d√©volutif de la case de t√™te ?", answer: "M√©canisme √©lectoral belge o√π cocher la case en t√™te de liste transf√®re une partie de votre vote aux candidats choisis par le parti, dans l'ordre de la liste. Renforce le pouvoir des partis sur la s√©lection des √©lus.", level: 0, lastReview: null, nextReview: null },
    { id: 'p4', question: "Qu'est-ce que le KERN ?", answer: "Comit√© minist√©riel restreint r√©unissant le Premier Ministre et les Vice-Premiers Ministres de la coalition. C'est l√† que se prennent les vraies d√©cisions gouvernementales, loin du Parlement.", level: 0, lastReview: null, nextReview: null },
    { id: 'p5', question: "Qu'est-ce que le 'cordon sanitaire' en politique belge ?", answer: "Accord tacite entre partis traditionnels de ne pas gouverner avec l'extr√™me-droite (principalement le Vlaams Belang). Critiqu√© par certains comme anti-d√©mocratique, d√©fendu par d'autres comme protection contre l'extr√©misme.", level: 0, lastReview: null, nextReview: null },
    
    // Financement & Co√ªts
    { id: 'f1', question: "Combien co√ªte le S√©nat belge par an ?", answer: "Plus de 44 millions d'euros (budget 2025), pour une chambre aux comp√©tences tr√®s r√©duites depuis la 6√®me r√©forme de l'√âtat.", level: 0, lastReview: null, nextReview: null },
    { id: 'f2', question: "Comment sont financ√©s les partis politiques belges ?", answer: "Principalement par dotations publiques (argent des contribuables), calcul√©es selon le nombre de voix et de si√®ges obtenus. Ce syst√®me avantage les partis √©tablis et cr√©e une barri√®re √† l'entr√©e pour les nouveaux mouvements.", level: 0, lastReview: null, nextReview: null },
    { id: 'f3', question: "Qu'est-ce que le seuil √©lectoral de 5% ?", answer: "Barri√®re l√©gale emp√™chant les partis recueillant moins de 5% des voix dans une circonscription d'obtenir des si√®ges. Critiqu√© car il √©limine des courants d'opinion minoritaires mais significatifs.", level: 0, lastReview: null, nextReview: null },
    
    // Pilarisation
    { id: 'pi1', question: "Qu'est-ce que la 'pilarisation' (verzuiling) en Belgique ?", answer: "Organisation historique de la soci√©t√© belge en 'piliers' (catholique, socialiste, lib√©ral) qui encadraient la vie des citoyens de la naissance √† la mort : √©coles, mutuelles, syndicats, partis. Structure affaiblie sociologiquement mais politiquement persistante.", level: 0, lastReview: null, nextReview: null },
    { id: 'pi2', question: "Quels sont les trois clivages historiques de la Belgique ?", answer: "1) Philosophique (√âglise vs √âtat), 2) Socio-√©conomique (Capital vs Travail), 3) Linguistique (Centre vs P√©riph√©rie / Flamands vs Francophones).", level: 0, lastReview: null, nextReview: null },
    
    // Intelligence citoyenne
    { id: 'ic1', question: "Qu'est-ce que l'intelligence citoyenne ?", answer: "Transposition des m√©thodes de l'intelligence √©conomique au service de la soci√©t√© civile : veille, analyse, influence, mais au profit des citoyens plut√¥t que des entreprises.", level: 0, lastReview: null, nextReview: null },
    { id: 'ic2', question: "Que signifie OSINT ?", answer: "Open Source Intelligence ‚Äî Renseignement obtenu √† partir de sources ouvertes et publiques (m√©dias, r√©seaux sociaux, documents officiels, etc.). Outil cl√© de la veille citoyenne.", level: 0, lastReview: null, nextReview: null },
    { id: 'ic3', question: "Qu'est-ce que le pre-bunking ?", answer: "Technique de 'vaccination cognitive' consistant √† exposer par avance les m√©thodes de manipulation pour immuniser contre la d√©sinformation. Plus efficace que le debunking (d√©mystification apr√®s coup).", level: 0, lastReview: null, nextReview: null },
    { id: 'ic4', question: "Qu'est-ce que la loi de Brandolini ?", answer: "Principe selon lequel l'√©nergie n√©cessaire pour r√©futer une connerie est sup√©rieure d'un ordre de grandeur √† celle n√©cessaire pour la produire. Justifie l'approche pre-bunking.", level: 0, lastReview: null, nextReview: null },
    
    // Outils & Concepts
    { id: 'o1', question: "Que signifie le mod√®le DIKW ?", answer: "Data ‚Üí Information ‚Üí Knowledge ‚Üí Wisdom. Mod√®le de transformation de la donn√©e brute en sagesse actionnable. Objectif : passer de la r√©action √©motionnelle √† la d√©cision strat√©gique.", level: 0, lastReview: null, nextReview: null },
    { id: 'o2', question: "Qu'est-ce que l'√âducation Permanente en Belgique ?", answer: "Cadre l√©gal (D√©cret de 2003) permettant √† des associations de recevoir des subsides pour des activit√©s d'analyse critique et de transformation sociale. Paradoxe : l'√âtat finance l'analyse qui le critique.", level: 0, lastReview: null, nextReview: null },
    { id: 'o3', question: "Qu'est-ce que l'Auftragstaktik ?", answer: "Doctrine militaire prussienne de 'commandement par mission' : l'intention est d√©finie au sommet, mais l'ex√©cution est laiss√©e aux unit√©s tactiques. Appliqu√© aux mouvements citoyens : autonomie d'action dans un cadre strat√©gique partag√©.", level: 0, lastReview: null, nextReview: null },
    
    // Concepts avanc√©s
    { id: 'a1', question: "Qu'est-ce que 'The Stack' selon Benjamin Bratton ?", answer: "Mod√®le conceptuel d√©crivant l'infrastructure mondiale du num√©rique en couches (terre, cloud, ville, adresse, interface, utilisateur). La souverainet√© num√©rique exige de contr√¥ler ses propres couches.", level: 0, lastReview: null, nextReview: null },
    { id: 'a2', question: "Que sont Solid et IPFS ?", answer: "Protocoles d√©centralis√©s pour l'ind√©pendance vis-√†-vis des GAFAM. Solid (Tim Berners-Lee) : donn√©es personnelles contr√¥l√©es par l'utilisateur. IPFS : stockage distribu√© sans serveur central.", level: 0, lastReview: null, nextReview: null },
    { id: 'a3', question: "Qu'est-ce qu'une 'association de fait' en droit belge ?", answer: "Groupement sans personnalit√© juridique, tr√®s souple (pas de statuts obligatoires, pas de comptabilit√© formelle) mais avec responsabilit√© illimit√©e des membres. Structure 'pirate' pour l'action citoyenne agile.", level: 0, lastReview: null, nextReview: null },
    
    // R√©forme & Action
    { id: 'r1', question: "Pourquoi le r√©f√©rendum est-il quasi impossible en Belgique ?", answer: "La Constitution belge ne pr√©voit pas de r√©f√©rendum d√©cisionnel au niveau f√©d√©ral, seulement des 'consultations populaires' non contraignantes au niveau local/r√©gional. Les partis traditionnels s'y opposent pour maintenir leur contr√¥le.", level: 0, lastReview: null, nextReview: null },
    { id: 'r2', question: "Qu'est-ce que le 'citoyen pigeon' ?", answer: "Expression populaire d√©signant le contribuable belge qui finance un syst√®me complexe et co√ªteux sans pouvoir r√©ellement l'influencer : pression fiscale √©lev√©e, privil√®ges politiques, opacit√© d√©cisionnelle.", level: 0, lastReview: null, nextReview: null },
    { id: 'r3', question: "Quel est le ratio parlementaires/habitants en Belgique vs pays comparables ?", answer: "La Belgique a un des ratios les plus √©lev√©s d'Europe : ~1 parlementaire pour 18 000 habitants (tous niveaux confondus), contre ~1/40 000 aux Pays-Bas ou ~1/60 000 en France.", level: 0, lastReview: null, nextReview: null }
  ]
};

// ============================================
// STATE
// ============================================

let state = {
  decks: [],
  currentDeckId: null,
  editingCardId: null,
  studyQueue: [],
  studyIndex: 0,
  studyFlipped: false,
  studyStats: { again: 0, hard: 0, good: 0, easy: 0 }
};

// ============================================
// STORAGE
// ============================================

function loadState() {
  try {
    const saved = localStorage.getItem('flashforge_data');
    if (saved) {
      const data = JSON.parse(saved);
      state.decks = data.decks || [];
      state.currentDeckId = data.currentDeckId || null;
    }
    
    // Add demo deck if no decks exist
    if (state.decks.length === 0) {
      state.decks.push(DEMO_DECK);
      state.currentDeckId = DEMO_DECK.id;
      saveState();
    }
    
    if (!state.currentDeckId && state.decks.length > 0) {
      state.currentDeckId = state.decks[0].id;
    }
  } catch (e) {
    console.error('Error loading state:', e);
    state.decks = [DEMO_DECK];
    state.currentDeckId = DEMO_DECK.id;
  }
}

function saveState() {
  try {
    localStorage.setItem('flashforge_data', JSON.stringify({
      decks: state.decks,
      currentDeckId: state.currentDeckId
    }));
  } catch (e) {
    console.error('Error saving state:', e);
    showToast('Erreur de sauvegarde', 'error');
  }
}

// ============================================
// DECK MANAGEMENT
// ============================================

function getCurrentDeck() {
  return state.decks.find(d => d.id === state.currentDeckId);
}

function selectDeck(deckId) {
  state.currentDeckId = deckId;
  saveState();
  renderAll();
}

function openDeckModal() {
  document.getElementById('deckName').value = '';
  document.getElementById('deckDescription').value = '';
  document.getElementById('deckModal').classList.add('active');
}

function closeDeckModal() {
  document.getElementById('deckModal').classList.remove('active');
}

function saveDeck() {
  const name = document.getElementById('deckName').value.trim();
  const description = document.getElementById('deckDescription').value.trim();
  
  if (!name) {
    showToast('Le nom est requis', 'error');
    return;
  }
  
  const newDeck = {
    id: 'deck-' + Date.now(),
    name: name,
    description: description,
    cards: []
  };
  
  state.decks.push(newDeck);
  state.currentDeckId = newDeck.id;
  saveState();
  closeDeckModal();
  renderAll();
  showToast('Deck cr√©√© !', 'success');
}

function deleteDeck(deckId) {
  if (state.decks.length <= 1) {
    showToast('Impossible de supprimer le dernier deck', 'error');
    return;
  }
  
  if (!confirm('Supprimer ce deck et toutes ses cartes ?')) return;
  
  state.decks = state.decks.filter(d => d.id !== deckId);
  if (state.currentDeckId === deckId) {
    state.currentDeckId = state.decks[0]?.id;
  }
  saveState();
  renderAll();
  showToast('Deck supprim√©', 'info');
}

// ============================================
// CARD MANAGEMENT
// ============================================

function openCardModal(cardId = null) {
  state.editingCardId = cardId;
  
  const modal = document.getElementById('cardModal');
  const title = document.getElementById('cardModalTitle');
  const questionInput = document.getElementById('cardQuestion');
  const answerInput = document.getElementById('cardAnswer');
  
  if (cardId) {
    title.textContent = 'Modifier la carte';
    const deck = getCurrentDeck();
    const card = deck?.cards.find(c => c.id === cardId);
    if (card) {
      questionInput.value = card.question;
      answerInput.value = card.answer;
    }
  } else {
    title.textContent = 'Nouvelle carte';
    questionInput.value = '';
    answerInput.value = '';
  }
  
  modal.classList.add('active');
  questionInput.focus();
}

function closeCardModal() {
  document.getElementById('cardModal').classList.remove('active');
  state.editingCardId = null;
}

function saveCard() {
  const question = document.getElementById('cardQuestion').value.trim();
  const answer = document.getElementById('cardAnswer').value.trim();
  
  if (!question || !answer) {
    showToast('Question et r√©ponse requises', 'error');
    return;
  }
  
  const deck = getCurrentDeck();
  if (!deck) {
    showToast('S√©lectionnez un deck', 'error');
    return;
  }
  
  if (state.editingCardId) {
    // Edit existing
    const card = deck.cards.find(c => c.id === state.editingCardId);
    if (card) {
      card.question = question;
      card.answer = answer;
    }
    showToast('Carte modifi√©e !', 'success');
  } else {
    // Create new
    deck.cards.push({
      id: 'card-' + Date.now(),
      question: question,
      answer: answer,
      level: 0,
      lastReview: null,
      nextReview: null
    });
    showToast('Carte cr√©√©e !', 'success');
  }
  
  saveState();
  closeCardModal();
  renderAll();
}

function deleteCard(cardId) {
  if (!confirm('Supprimer cette carte ?')) return;
  
  const deck = getCurrentDeck();
  if (deck) {
    deck.cards = deck.cards.filter(c => c.id !== cardId);
    saveState();
    renderAll();
    showToast('Carte supprim√©e', 'info');
  }
}

// ============================================
// IMPORT / EXPORT
// ============================================

function openImportModal() {
  document.getElementById('importModal').classList.add('active');
}

function closeImportModal() {
  document.getElementById('importModal').classList.remove('active');
}

function handleImport(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const text = e.target.result;
      const lines = text.split('\n').filter(l => l.trim());
      
      const deck = getCurrentDeck();
      if (!deck) {
        showToast('S√©lectionnez un deck', 'error');
        return;
      }
      
      let imported = 0;
      lines.forEach(line => {
        // Parse CSV (handle quoted fields)
        const match = line.match(/^"?([^"]*)"?,\s*"?([^"]*)"?$/);
        if (match) {
          const question = match[1].trim();
          const answer = match[2].trim();
          if (question && answer) {
            deck.cards.push({
              id: 'card-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
              question: question,
              answer: answer,
              level: 0,
              lastReview: null,
              nextReview: null
            });
            imported++;
          }
        }
      });
      
      saveState();
      closeImportModal();
      renderAll();
      showToast(`${imported} cartes import√©es !`, 'success');
    } catch (err) {
      console.error(err);
      showToast('Erreur d\'import', 'error');
    }
  };
  reader.readAsText(file);
}

function exportDeck() {
  const deck = getCurrentDeck();
  if (!deck || deck.cards.length === 0) {
    showToast('Aucune carte √† exporter', 'error');
    return;
  }
  
  const csv = deck.cards.map(c => {
    const q = c.question.replace(/"/g, '""');
    const a = c.answer.replace(/"/g, '""');
    return `"${q}","${a}"`;
  }).join('\n');
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${deck.name.replace(/[^a-z0-9]/gi, '_')}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  
  showToast('Deck export√© !', 'success');
}

// ============================================
// STUDY MODE
// ============================================

function startStudy() {
  const deck = getCurrentDeck();
  if (!deck || deck.cards.length === 0) {
    showToast('Aucune carte √† √©tudier', 'error');
    return;
  }
  
  // Build study queue (prioritize low level cards)
  state.studyQueue = [...deck.cards].sort((a, b) => a.level - b.level);
  state.studyIndex = 0;
  state.studyFlipped = false;
  state.studyStats = { again: 0, hard: 0, good: 0, easy: 0 };
  
  renderStudy();
}

function flipCard() {
  state.studyFlipped = !state.studyFlipped;
  const card = document.querySelector('.flashcard');
  if (card) {
    card.classList.toggle('flipped', state.studyFlipped);
  }
}

function rateCard(rating) {
  const deck = getCurrentDeck();
  const studyCard = state.studyQueue[state.studyIndex];
  const card = deck?.cards.find(c => c.id === studyCard.id);
  
  if (card) {
    // Update level based on rating
    switch (rating) {
      case 'again':
        card.level = Math.max(0, card.level - 1);
        state.studyStats.again++;
        break;
      case 'hard':
        // Keep same level
        state.studyStats.hard++;
        break;
      case 'good':
        card.level = Math.min(5, card.level + 1);
        state.studyStats.good++;
        break;
      case 'easy':
        card.level = Math.min(5, card.level + 2);
        state.studyStats.easy++;
        break;
    }
    
    card.lastReview = Date.now();
    saveState();
  }
  
  // Next card
  state.studyIndex++;
  state.studyFlipped = false;
  
  renderStudy();
}

function renderStudy() {
  const container = document.getElementById('studyContainer');
  const deck = getCurrentDeck();
  
  if (!deck || state.studyQueue.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üìö</div>
        <div class="empty-title">Pr√™t √† √©tudier ?</div>
        <div class="empty-text">S√©lectionnez un deck et commencez votre session</div>
        <button class="btn btn-success" onclick="startStudy()">üéØ Commencer</button>
      </div>
    `;
    return;
  }
  
  if (state.studyIndex >= state.studyQueue.length) {
    // Study complete
    const total = state.studyStats.again + state.studyStats.hard + state.studyStats.good + state.studyStats.easy;
    container.innerHTML = `
      <div class="study-complete">
        <div class="complete-icon">üéâ</div>
        <div class="complete-title">Session termin√©e !</div>
        <div class="complete-subtitle">${total} cartes r√©vis√©es</div>
        <div class="complete-stats">
          <div class="complete-stat">
            <div class="complete-stat-value green">${state.studyStats.good + state.studyStats.easy}</div>
            <div class="complete-stat-label">R√©ussies</div>
          </div>
          <div class="complete-stat">
            <div class="complete-stat-value orange">${state.studyStats.hard}</div>
            <div class="complete-stat-label">Difficiles</div>
          </div>
          <div class="complete-stat">
            <div class="complete-stat-value red">${state.studyStats.again}</div>
            <div class="complete-stat-label">√Ä revoir</div>
          </div>
        </div>
        <button class="btn btn-primary" onclick="startStudy()">üîÑ Recommencer</button>
      </div>
    `;
    return;
  }
  
  const card = state.studyQueue[state.studyIndex];
  const progress = ((state.studyIndex) / state.studyQueue.length) * 100;
  
  container.innerHTML = `
    <div class="study-progress">
      <div class="progress-bar">
        <div class="progress-fill" style="width:${progress}%"></div>
      </div>
      <div class="progress-text">
        <span>${state.studyIndex + 1} / ${state.studyQueue.length}</span>
        <span>Niveau actuel : ${card.level}/5</span>
      </div>
    </div>
    
    <div class="flashcard-container">
      <div class="flashcard ${state.studyFlipped ? 'flipped' : ''}" onclick="flipCard()">
        <div class="flashcard-face flashcard-front">
          <div class="flashcard-label">Question</div>
          <div class="flashcard-text">${escapeHtml(card.question)}</div>
          <div class="flashcard-hint">Cliquez pour retourner</div>
        </div>
        <div class="flashcard-face flashcard-back">
          <div class="flashcard-label">R√©ponse</div>
          <div class="flashcard-text">${escapeHtml(card.answer)}</div>
        </div>
      </div>
    </div>
    
    ${state.studyFlipped ? `
      <div class="study-actions">
        <button class="study-btn again" onclick="rateCard('again')">
          <span>üòì</span>
          <span class="study-btn-label">√Ä revoir</span>
        </button>
        <button class="study-btn hard" onclick="rateCard('hard')">
          <span>ü§î</span>
          <span class="study-btn-label">Difficile</span>
        </button>
        <button class="study-btn good" onclick="rateCard('good')">
          <span>üòä</span>
          <span class="study-btn-label">Bien</span>
        </button>
        <button class="study-btn easy" onclick="rateCard('easy')">
          <span>üöÄ</span>
          <span class="study-btn-label">Facile</span>
        </button>
      </div>
    ` : ''}
  `;
}

// ============================================
// RENDERING
// ============================================

function renderAll() {
  renderDeckList();
  renderCards();
  renderStats();
}

function renderDeckList() {
  const list = document.getElementById('deckList');
  
  list.innerHTML = state.decks.map(deck => {
    const isActive = deck.id === state.currentDeckId;
    const cardCount = deck.cards.length;
    const masteredCount = deck.cards.filter(c => c.level >= 4).length;
    
    return `
      <div class="deck-item ${isActive ? 'active' : ''}" onclick="selectDeck('${deck.id}')">
        <div class="deck-name">
          <span>${deck.name}</span>
        </div>
        <div class="deck-meta">
          <span class="deck-stat">üìö ${cardCount}</span>
          <span class="deck-stat">‚úÖ ${masteredCount}</span>
        </div>
      </div>
    `;
  }).join('');
}

function renderCards() {
  const deck = getCurrentDeck();
  const grid = document.getElementById('cardsGrid');
  const title = document.getElementById('currentDeckName');
  const count = document.getElementById('cardsCount');
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  
  if (!deck) {
    title.textContent = 'Aucun deck s√©lectionn√©';
    count.textContent = '';
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üìÅ</div>
        <div class="empty-title">Aucun deck</div>
        <div class="empty-text">Cr√©ez votre premier deck pour commencer</div>
      </div>
    `;
    return;
  }
  
  title.textContent = deck.name;
  
  let cards = deck.cards;
  if (searchTerm) {
    cards = cards.filter(c => 
      c.question.toLowerCase().includes(searchTerm) || 
      c.answer.toLowerCase().includes(searchTerm)
    );
  }
  
  count.textContent = `${cards.length} carte${cards.length !== 1 ? 's' : ''}`;
  
  if (cards.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">${searchTerm ? 'üîç' : 'üìù'}</div>
        <div class="empty-title">${searchTerm ? 'Aucun r√©sultat' : 'Deck vide'}</div>
        <div class="empty-text">${searchTerm ? 'Essayez d\'autres termes' : 'Ajoutez votre premi√®re carte'}</div>
        ${!searchTerm ? '<button class="btn btn-success" onclick="openCardModal()">‚ûï Nouvelle carte</button>' : ''}
      </div>
    `;
    return;
  }
  
  grid.innerHTML = cards.map(card => {
    const levelDots = Array(5).fill(0).map((_, i) => 
      `<div class="level-dot ${i < card.level ? 'filled' : ''}"></div>`
    ).join('');
    
    return `
      <div class="card-item" ondblclick="openCardModal('${card.id}')">
        <div class="card-question">${escapeHtml(card.question)}</div>
        <div class="card-answer">${escapeHtml(card.answer)}</div>
        <div class="card-footer">
          <div class="card-level">${levelDots}</div>
          <div class="card-actions">
            <button class="card-action" onclick="event.stopPropagation();openCardModal('${card.id}')" title="Modifier">‚úèÔ∏è</button>
            <button class="card-action delete" onclick="event.stopPropagation();deleteCard('${card.id}')" title="Supprimer">üóëÔ∏è</button>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

function renderStats() {
  let totalCards = 0;
  let masteredCards = 0;
  let toReviewCards = 0;
  let newCards = 0;
  
  state.decks.forEach(deck => {
    deck.cards.forEach(card => {
      totalCards++;
      if (card.level >= 4) masteredCards++;
      else if (card.level === 0 && !card.lastReview) newCards++;
      else toReviewCards++;
    });
  });
  
  document.getElementById('statTotal').textContent = totalCards;
  document.getElementById('statMastered').textContent = masteredCards;
  document.getElementById('statToReview').textContent = toReviewCards;
  document.getElementById('statNew').textContent = newCards;
}

// ============================================
// VIEW SWITCHING
// ============================================

function switchView(viewId) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  
  document.getElementById('view' + viewId.charAt(0).toUpperCase() + viewId.slice(1)).classList.add('active');
  document.querySelector(`[data-view="${viewId}"]`).classList.add('active');
  
  if (viewId === 'study') {
    if (state.studyQueue.length === 0) {
      startStudy();
    } else {
      renderStudy();
    }
  }
}

// ============================================
// UTILITIES
// ============================================

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function showToast(message, type = 'info') {
  const container = document.getElementById('toastContainer');
  const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
  
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <span class="toast-icon">${icons[type]}</span>
    <span class="toast-message">${message}</span>
  `;
  
  container.appendChild(toast);
  
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateX(100px)';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// ============================================
// EVENT LISTENERS
// ============================================

document.addEventListener('DOMContentLoaded', () => {
  loadState();
  renderAll();
  
  // Nav tabs
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', () => switchView(tab.dataset.view));
  });
  
  // Search
  document.getElementById('searchInput').addEventListener('input', renderCards);
  
  // Import file
  const importFile = document.getElementById('importFile');
  importFile.addEventListener('change', (e) => {
    if (e.target.files[0]) {
      handleImport(e.target.files[0]);
    }
  });
  
  // Drag & drop
  const importArea = document.getElementById('importArea');
  importArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    importArea.classList.add('dragover');
  });
  importArea.addEventListener('dragleave', () => {
    importArea.classList.remove('dragover');
  });
  importArea.addEventListener('drop', (e) => {
    e.preventDefault();
    importArea.classList.remove('dragover');
    if (e.dataTransfer.files[0]) {
      handleImport(e.dataTransfer.files[0]);
    }
  });
  
  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Space to flip in study mode
    if (e.code === 'Space' && document.getElementById('viewStudy').classList.contains('active')) {
      e.preventDefault();
      flipCard();
    }
    
    // 1-4 to rate in study mode
    if (state.studyFlipped && document.getElementById('viewStudy').classList.contains('active')) {
      if (e.key === '1') rateCard('again');
      if (e.key === '2') rateCard('hard');
      if (e.key === '3') rateCard('good');
      if (e.key === '4') rateCard('easy');
    }
    
    // Escape to close modals
    if (e.key === 'Escape') {
      closeCardModal();
      closeDeckModal();
      closeImportModal();
    }
    
    // Ctrl+N for new card
    if (e.ctrlKey && e.key === 'n') {
      e.preventDefault();
      openCardModal();
    }
  });
});
</script>

</body>
</html>
