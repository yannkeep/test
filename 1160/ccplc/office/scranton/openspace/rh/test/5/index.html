<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IN-BASKET // Jour 1 ‚Äî ePOP!up</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}

:root{
  --bg:#030308;
  --panel:rgba(12,14,28,0.85);
  --panel-solid:#0c0e1c;
  --border:#1e2040;
  --border-glow:rgba(177,156,217,0.3);
  --text:#e8eaf0;
  --text-dim:#8892b0;
  --text-muted:#5a6785;
  --lilac:#b19cd9;
  --lilac-bright:#d4c4ff;
  --lilac-dim:#8b7aaf;
  --purple:#8b5cf6;
  --green:#00ff88;
  --green-dim:#00cc6a;
  --cyan:#00f0ff;
  --magenta:#ff00aa;
  --red:#ff4757;
  --orange:#ffa502;
  --yellow:#ffd93d;
  --glow-lilac:rgba(177,156,217,0.5);
  --glow-green:rgba(0,255,136,0.5);
  --glow-cyan:rgba(0,240,255,0.4);
  --radius:10px;
  --mono:'Fira Code','JetBrains Mono','Courier New',monospace;
  --font:system-ui,-apple-system,'Segoe UI',sans-serif;
}

body{
  font-family:var(--font);
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow:hidden;
}

/* Background Effects */
.aurora{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.aurora::before{
  content:'';position:absolute;width:200%;height:200%;top:-50%;left:-50%;
  background:radial-gradient(ellipse 80% 50% at 20% 30%,rgba(177,156,217,0.1),transparent),
             radial-gradient(ellipse 60% 40% at 80% 70%,rgba(0,255,136,0.06),transparent),
             radial-gradient(ellipse 70% 50% at 50% 90%,rgba(0,240,255,0.04),transparent);
  animation:auroraMove 25s ease-in-out infinite;
}
@keyframes auroraMove{0%,100%{transform:translate(0,0) rotate(0deg)}33%{transform:translate(3%,2%) rotate(1deg)}66%{transform:translate(-2%,3%) rotate(-1deg)}}

.grid-bg{
  position:fixed;inset:0;z-index:1;pointer-events:none;
  background-image:linear-gradient(rgba(177,156,217,0.015) 1px,transparent 1px),
                   linear-gradient(90deg,rgba(177,156,217,0.015) 1px,transparent 1px);
  background-size:50px 50px;
}

.scanline{
  position:fixed;top:0;left:0;width:100%;height:3px;
  background:linear-gradient(90deg,transparent,var(--lilac),var(--cyan),var(--lilac),transparent);
  animation:scanMove 6s linear infinite;
  opacity:0.4;pointer-events:none;z-index:9999;
  box-shadow:0 0 20px var(--lilac),0 0 40px var(--cyan);
}
@keyframes scanMove{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}

/* App Container */
.app{
  position:relative;z-index:10;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* Top Bar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0.75rem 1.25rem;
  background:var(--panel);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}

.topbar-left{
  display:flex;
  align-items:center;
  gap:1.5rem;
}

.logo{
  font-family:var(--mono);
  font-size:1rem;
  font-weight:700;
  letter-spacing:0.15em;
  background:linear-gradient(135deg,var(--lilac),var(--cyan));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.scenario-badge{
  display:flex;
  align-items:center;
  gap:0.5rem;
  padding:0.4rem 0.85rem;
  background:rgba(177,156,217,0.1);
  border:1px solid var(--border-glow);
  border-radius:var(--radius);
  font-size:0.8rem;
}

.scenario-badge .role{
  color:var(--lilac-bright);
  font-weight:600;
}

.topbar-center{
  display:flex;
  align-items:center;
  gap:2rem;
}

.timer-box{
  display:flex;
  align-items:center;
  gap:0.6rem;
  padding:0.5rem 1rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  font-family:var(--mono);
}

.timer-box.warning{
  border-color:var(--orange);
  background:rgba(255,165,2,0.1);
}

.timer-box.danger{
  border-color:var(--red);
  background:rgba(255,71,87,0.1);
  animation:timerPulse 1s infinite;
}

@keyframes timerPulse{
  0%,100%{opacity:1}
  50%{opacity:0.6}
}

.timer-icon{font-size:1.1rem}

.timer-value{
  font-size:1.25rem;
  font-weight:600;
  color:var(--green);
  min-width:70px;
}

.timer-box.warning .timer-value{color:var(--orange)}
.timer-box.danger .timer-value{color:var(--red)}

.timer-label{
  font-size:0.7rem;
  color:var(--text-dim);
}

.progress-box{
  display:flex;
  align-items:center;
  gap:0.75rem;
}

.progress-ring{
  width:40px;
  height:40px;
  position:relative;
}

.progress-ring svg{
  transform:rotate(-90deg);
}

.progress-ring-bg{
  fill:none;
  stroke:var(--border);
  stroke-width:4;
}

.progress-ring-fill{
  fill:none;
  stroke:url(#progressGradient);
  stroke-width:4;
  stroke-linecap:round;
  stroke-dasharray:113;
  stroke-dashoffset:113;
  transition:stroke-dashoffset 0.5s ease;
}

.progress-text{
  font-size:0.75rem;
  color:var(--text-dim);
}

.progress-text strong{
  color:var(--lilac-bright);
  font-family:var(--mono);
}

.topbar-right{
  display:flex;
  align-items:center;
  gap:1rem;
}

.stress-meter{
  display:flex;
  align-items:center;
  gap:0.5rem;
  padding:0.4rem 0.75rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
}

.stress-bars{
  display:flex;
  gap:3px;
}

.stress-bar{
  width:4px;
  height:16px;
  background:var(--border);
  border-radius:2px;
  transition:all 0.3s;
}

.stress-bar.active{background:var(--green)}
.stress-bar.warning{background:var(--orange)}
.stress-bar.danger{background:var(--red)}

.stress-label{
  font-size:0.7rem;
  color:var(--text-dim);
}

/* Main Layout */
.main-layout{
  flex:1;
  display:grid;
  grid-template-columns:280px 1fr 320px;
  gap:1px;
  background:var(--border);
  overflow:hidden;
}

/* Sidebar */
.sidebar{
  background:var(--panel);
  backdrop-filter:blur(20px);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.sidebar-header{
  padding:1rem;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.sidebar-title{
  font-size:0.85rem;
  font-weight:600;
  color:var(--lilac-bright);
  display:flex;
  align-items:center;
  gap:0.5rem;
}

.unread-badge{
  padding:0.15rem 0.5rem;
  background:var(--red);
  border-radius:var(--radius);
  font-size:0.7rem;
  font-weight:700;
  color:white;
}

.inbox-tabs{
  display:flex;
  border-bottom:1px solid var(--border);
}

.inbox-tab{
  flex:1;
  padding:0.6rem;
  background:none;
  border:none;
  color:var(--text-dim);
  font-family:inherit;
  font-size:0.75rem;
  cursor:pointer;
  transition:all 0.2s;
  position:relative;
}

.inbox-tab:hover{color:var(--text)}

.inbox-tab.active{
  color:var(--lilac-bright);
  background:rgba(177,156,217,0.05);
}

.inbox-tab.active::after{
  content:'';
  position:absolute;
  bottom:0;left:0;right:0;
  height:2px;
  background:var(--lilac);
}

.inbox-tab .count{
  margin-left:0.35rem;
  padding:0.1rem 0.4rem;
  background:var(--border);
  border-radius:10px;
  font-size:0.65rem;
}

.inbox-tab.active .count{
  background:var(--lilac);
  color:var(--bg);
}

.inbox-list{
  flex:1;
  overflow-y:auto;
  padding:0.5rem;
}

.inbox-item{
  padding:0.85rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  margin-bottom:0.5rem;
  cursor:pointer;
  transition:all 0.2s;
  position:relative;
}

.inbox-item:hover{
  border-color:var(--lilac-dim);
  transform:translateX(3px);
}

.inbox-item.active{
  border-color:var(--lilac);
  background:rgba(177,156,217,0.08);
}

.inbox-item.unread::before{
  content:'';
  position:absolute;
  left:0;top:50%;
  transform:translateY(-50%);
  width:3px;
  height:60%;
  background:var(--cyan);
  border-radius:0 2px 2px 0;
}

.inbox-item.urgent{
  border-left:3px solid var(--red);
}

.inbox-item.processed{
  opacity:0.5;
}

.inbox-item.processed::after{
  content:'‚úì';
  position:absolute;
  right:8px;
  top:8px;
  color:var(--green);
  font-size:0.9rem;
}

.inbox-sender{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:0.35rem;
}

.sender-name{
  font-size:0.8rem;
  font-weight:600;
  color:var(--text);
}

.inbox-item.unread .sender-name{
  color:var(--lilac-bright);
}

.inbox-time{
  font-size:0.65rem;
  color:var(--text-muted);
  font-family:var(--mono);
}

.inbox-subject{
  font-size:0.8rem;
  color:var(--text-dim);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  margin-bottom:0.25rem;
}

.inbox-preview{
  font-size:0.7rem;
  color:var(--text-muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.inbox-tags{
  display:flex;
  gap:0.35rem;
  margin-top:0.5rem;
}

.tag{
  padding:0.15rem 0.4rem;
  border-radius:4px;
  font-size:0.6rem;
  font-weight:600;
  text-transform:uppercase;
}

.tag.urgent{background:rgba(255,71,87,0.2);color:var(--red)}
.tag.rh{background:rgba(139,92,246,0.2);color:var(--purple)}
.tag.client{background:rgba(0,240,255,0.2);color:var(--cyan)}
.tag.direction{background:rgba(255,165,2,0.2);color:var(--orange)}
.tag.equipe{background:rgba(0,255,136,0.2);color:var(--green)}

/* Content Area */
.content-area{
  background:var(--bg);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.email-viewer{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.email-header{
  padding:1.25rem 1.5rem;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}

.email-subject-line{
  font-size:1.15rem;
  font-weight:600;
  margin-bottom:0.75rem;
  color:var(--text);
}

.email-meta{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
}

.email-from{
  display:flex;
  align-items:center;
  gap:0.75rem;
}

.email-avatar{
  width:40px;
  height:40px;
  background:var(--gradient-lilac);
  background:linear-gradient(135deg,var(--lilac),var(--purple));
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  font-size:0.9rem;
  color:white;
}

.email-from-info{
  display:flex;
  flex-direction:column;
}

.email-from-name{
  font-weight:600;
  font-size:0.9rem;
}

.email-from-address{
  font-size:0.75rem;
  color:var(--text-dim);
}

.email-date{
  font-size:0.75rem;
  color:var(--text-dim);
  font-family:var(--mono);
}

.email-body{
  flex:1;
  padding:1.5rem;
  overflow-y:auto;
  line-height:1.7;
  font-size:0.95rem;
}

.email-body p{
  margin-bottom:1rem;
}

.email-body .signature{
  margin-top:1.5rem;
  padding-top:1rem;
  border-top:1px solid var(--border);
  color:var(--text-dim);
  font-size:0.85rem;
}

.email-attachments{
  padding:1rem 1.5rem;
  background:var(--panel);
  border-top:1px solid var(--border);
}

.attachment-label{
  font-size:0.75rem;
  color:var(--text-dim);
  margin-bottom:0.5rem;
}

.attachment-item{
  display:inline-flex;
  align-items:center;
  gap:0.5rem;
  padding:0.5rem 0.85rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  font-size:0.8rem;
  cursor:pointer;
  transition:all 0.2s;
}

.attachment-item:hover{
  border-color:var(--lilac);
}

/* Action Panel */
.action-panel{
  background:var(--panel);
  backdrop-filter:blur(20px);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.action-header{
  padding:1rem;
  border-bottom:1px solid var(--border);
}

.action-title{
  font-size:0.85rem;
  font-weight:600;
  color:var(--lilac-bright);
  margin-bottom:0.25rem;
}

.action-subtitle{
  font-size:0.7rem;
  color:var(--text-dim);
}

.action-content{
  flex:1;
  padding:1rem;
  overflow-y:auto;
}

.action-section{
  margin-bottom:1.5rem;
}

.action-section-title{
  font-size:0.7rem;
  font-weight:600;
  color:var(--text-dim);
  text-transform:uppercase;
  letter-spacing:0.1em;
  margin-bottom:0.75rem;
}

.action-buttons{
  display:flex;
  flex-direction:column;
  gap:0.5rem;
}

.action-btn{
  display:flex;
  align-items:center;
  gap:0.6rem;
  padding:0.75rem 1rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-family:inherit;
  font-size:0.85rem;
  cursor:pointer;
  transition:all 0.2s;
  text-align:left;
}

.action-btn:hover{
  border-color:var(--lilac);
  background:rgba(177,156,217,0.08);
  transform:translateX(3px);
}

.action-btn.selected{
  border-color:var(--green);
  background:rgba(0,255,136,0.1);
}

.action-btn .icon{
  font-size:1.1rem;
  width:24px;
  text-align:center;
}

.action-btn .label{flex:1}

.action-btn .shortcut{
  font-family:var(--mono);
  font-size:0.65rem;
  padding:0.15rem 0.4rem;
  background:var(--border);
  border-radius:4px;
  color:var(--text-dim);
}

/* Priority Selector */
.priority-selector{
  display:flex;
  gap:0.5rem;
}

.priority-btn{
  flex:1;
  padding:0.6rem;
  background:var(--panel-solid);
  border:2px solid var(--border);
  border-radius:var(--radius);
  color:var(--text-dim);
  font-family:inherit;
  font-size:0.75rem;
  cursor:pointer;
  transition:all 0.2s;
  text-align:center;
}

.priority-btn:hover{border-color:var(--lilac-dim)}

.priority-btn.selected.high{
  border-color:var(--red);
  background:rgba(255,71,87,0.15);
  color:var(--red);
}

.priority-btn.selected.medium{
  border-color:var(--orange);
  background:rgba(255,165,2,0.15);
  color:var(--orange);
}

.priority-btn.selected.low{
  border-color:var(--green);
  background:rgba(0,255,136,0.15);
  color:var(--green);
}

/* Delegate Selector */
.delegate-selector{
  display:flex;
  flex-direction:column;
  gap:0.4rem;
}

.delegate-option{
  display:flex;
  align-items:center;
  gap:0.6rem;
  padding:0.6rem 0.75rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  cursor:pointer;
  transition:all 0.2s;
}

.delegate-option:hover{border-color:var(--lilac-dim)}

.delegate-option.selected{
  border-color:var(--cyan);
  background:rgba(0,240,255,0.1);
}

.delegate-avatar{
  width:28px;
  height:28px;
  background:linear-gradient(135deg,var(--lilac),var(--purple));
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:0.7rem;
  font-weight:600;
  color:white;
}

.delegate-info{flex:1}

.delegate-name{
  font-size:0.8rem;
  font-weight:500;
}

.delegate-role{
  font-size:0.65rem;
  color:var(--text-dim);
}

/* Notes */
.notes-area{
  width:100%;
  min-height:80px;
  padding:0.75rem;
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-family:inherit;
  font-size:0.85rem;
  resize:vertical;
  transition:border-color 0.2s;
}

.notes-area:focus{
  outline:none;
  border-color:var(--lilac);
}

.notes-area::placeholder{
  color:var(--text-muted);
}

/* Submit Button */
.submit-section{
  padding:1rem;
  border-top:1px solid var(--border);
}

.submit-btn{
  width:100%;
  padding:0.85rem;
  background:linear-gradient(135deg,var(--lilac),var(--purple));
  border:none;
  border-radius:var(--radius);
  color:white;
  font-family:inherit;
  font-size:0.9rem;
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.5rem;
}

.submit-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 5px 20px rgba(177,156,217,0.4);
}

.submit-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}

/* Notifications */
.notification-popup{
  position:fixed;
  top:80px;
  right:20px;
  width:320px;
  background:var(--panel);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem;
  z-index:1000;
  transform:translateX(400px);
  opacity:0;
  transition:all 0.4s ease;
  box-shadow:0 10px 40px rgba(0,0,0,0.5);
}

.notification-popup.show{
  transform:translateX(0);
  opacity:1;
}

.notification-popup.urgent{
  border-color:var(--red);
  box-shadow:0 0 20px rgba(255,71,87,0.3);
}

.notification-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:0.75rem;
}

.notification-type{
  display:flex;
  align-items:center;
  gap:0.4rem;
  font-size:0.75rem;
  font-weight:600;
  color:var(--cyan);
}

.notification-popup.urgent .notification-type{color:var(--red)}

.notification-close{
  background:none;
  border:none;
  color:var(--text-dim);
  font-size:1.2rem;
  cursor:pointer;
}

.notification-content{
  font-size:0.85rem;
  line-height:1.5;
}

.notification-sender{
  font-weight:600;
  color:var(--lilac-bright);
}

/* Intro Modal */
.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(3,3,8,0.9);
  backdrop-filter:blur(10px);
  z-index:2000;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.4s;
}

.modal-overlay.show{
  opacity:1;
  pointer-events:auto;
}

.modal{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:calc(var(--radius) * 2);
  max-width:600px;
  width:90%;
  max-height:90vh;
  overflow-y:auto;
  transform:scale(0.9) translateY(20px);
  transition:transform 0.4s;
}

.modal-overlay.show .modal{
  transform:scale(1) translateY(0);
}

.modal-header{
  padding:1.5rem;
  border-bottom:1px solid var(--border);
  text-align:center;
}

.modal-icon{
  font-size:3rem;
  margin-bottom:0.75rem;
}

.modal-title{
  font-size:1.5rem;
  font-weight:700;
  background:linear-gradient(135deg,var(--lilac),var(--cyan));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:0.35rem;
}

.modal-subtitle{
  color:var(--text-dim);
  font-size:0.9rem;
}

.modal-body{
  padding:1.5rem;
}

.briefing-section{
  margin-bottom:1.25rem;
}

.briefing-label{
  font-size:0.7rem;
  font-weight:600;
  color:var(--lilac);
  text-transform:uppercase;
  letter-spacing:0.1em;
  margin-bottom:0.5rem;
}

.briefing-content{
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem;
  font-size:0.9rem;
  line-height:1.6;
}

.briefing-list{
  list-style:none;
  padding-left:0;
}

.briefing-list li{
  padding:0.35rem 0;
  padding-left:1.5rem;
  position:relative;
}

.briefing-list li::before{
  content:'‚ñ∏';
  position:absolute;
  left:0;
  color:var(--lilac);
}

.modal-footer{
  padding:1rem 1.5rem 1.5rem;
  text-align:center;
}

.start-btn{
  padding:1rem 3rem;
  background:linear-gradient(135deg,var(--green),var(--cyan));
  border:none;
  border-radius:var(--radius);
  color:var(--bg);
  font-family:inherit;
  font-size:1rem;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s;
}

.start-btn:hover{
  transform:scale(1.05);
  box-shadow:0 0 30px var(--glow-green);
}

/* Results Modal */
.results-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:1rem;
  margin-bottom:1.5rem;
}

.result-card{
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem;
  text-align:center;
}

.result-value{
  font-family:var(--mono);
  font-size:1.75rem;
  font-weight:700;
  color:var(--lilac-bright);
}

.result-value.green{color:var(--green)}
.result-value.orange{color:var(--orange)}
.result-value.red{color:var(--red)}

.result-label{
  font-size:0.75rem;
  color:var(--text-dim);
  margin-top:0.25rem;
}

.feedback-section{
  background:var(--panel-solid);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem;
  margin-bottom:1rem;
}

.feedback-title{
  font-size:0.85rem;
  font-weight:600;
  color:var(--lilac-bright);
  margin-bottom:0.75rem;
  display:flex;
  align-items:center;
  gap:0.5rem;
}

.feedback-item{
  display:flex;
  align-items:flex-start;
  gap:0.6rem;
  padding:0.5rem 0;
  font-size:0.85rem;
  border-bottom:1px solid var(--border);
}

.feedback-item:last-child{border-bottom:none}

.feedback-icon{font-size:1rem}

.civix-reward{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.75rem;
  padding:1rem;
  background:linear-gradient(135deg,rgba(177,156,217,0.1),rgba(0,255,136,0.1));
  border:1px solid var(--border-glow);
  border-radius:var(--radius);
  margin-top:1rem;
}

.civix-icon{
  width:40px;
  height:40px;
  background:linear-gradient(135deg,var(--lilac),var(--green));
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:1rem;
  color:var(--bg);
}

.civix-amount{
  font-family:var(--mono);
  font-size:1.5rem;
  font-weight:700;
  color:var(--lilac-bright);
}

/* Empty State */
.empty-state{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:2rem;
  color:var(--text-dim);
}

.empty-icon{
  font-size:3rem;
  margin-bottom:1rem;
  opacity:0.5;
}

.empty-text{
  font-size:0.9rem;
  text-align:center;
}

/* Scrollbar */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--panel-solid)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--lilac-dim)}

/* Responsive */
@media(max-width:1200px){
  .main-layout{grid-template-columns:240px 1fr 280px}
}

@media(max-width:900px){
  .main-layout{grid-template-columns:1fr}
  .sidebar,.action-panel{display:none}
}
</style>
</head>
<body>

<div class="aurora"></div>
<div class="grid-bg"></div>
<div class="scanline"></div>

<div class="app">
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-left">
      <div class="logo">IN-BASKET</div>
      <div class="scenario-badge">
        <span>üìã</span>
        <span class="role">Responsable d'√©quipe ‚Äî Jour 1</span>
      </div>
    </div>

    <div class="topbar-center">
      <div class="timer-box" id="timerBox">
        <span class="timer-icon">‚è±Ô∏è</span>
        <div>
          <div class="timer-value" id="timerValue">30:00</div>
          <div class="timer-label">temps restant</div>
        </div>
      </div>

      <div class="progress-box">
        <div class="progress-ring">
          <svg width="40" height="40" viewBox="0 0 40 40">
            <defs>
              <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#b19cd9"/>
                <stop offset="100%" style="stop-color:#00ff88"/>
              </linearGradient>
            </defs>
            <circle class="progress-ring-bg" cx="20" cy="20" r="18"/>
            <circle class="progress-ring-fill" id="progressRing" cx="20" cy="20" r="18"/>
          </svg>
        </div>
        <div class="progress-text">
          <strong id="processedCount">0</strong>/<span id="totalCount">12</span> trait√©s
        </div>
      </div>
    </div>

    <div class="topbar-right">
      <div class="stress-meter">
        <div class="stress-bars" id="stressBars">
          <div class="stress-bar"></div>
          <div class="stress-bar"></div>
          <div class="stress-bar"></div>
          <div class="stress-bar"></div>
          <div class="stress-bar"></div>
        </div>
        <span class="stress-label">Pression</span>
      </div>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="main-layout">
    <!-- Inbox Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">
          <span>üì•</span> Bo√Æte de r√©ception
        </div>
        <span class="unread-badge" id="unreadBadge">12</span>
      </div>

      <div class="inbox-tabs">
        <button class="inbox-tab active" data-filter="all">
          Tous <span class="count" id="countAll">12</span>
        </button>
        <button class="inbox-tab" data-filter="urgent">
          Urgents <span class="count" id="countUrgent">3</span>
        </button>
        <button class="inbox-tab" data-filter="unread">
          Non lus <span class="count" id="countUnread">12</span>
        </button>
      </div>

      <div class="inbox-list" id="inboxList">
        <!-- Dynamically populated -->
      </div>
    </div>

    <!-- Email Content -->
    <div class="content-area">
      <div class="email-viewer" id="emailViewer">
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">üì¨</div>
          <div class="empty-text">S√©lectionnez un message<br>pour le consulter</div>
        </div>
      </div>
    </div>

    <!-- Action Panel -->
    <div class="action-panel" id="actionPanel">
      <div class="action-header">
        <div class="action-title">‚ö° Actions</div>
        <div class="action-subtitle">Comment traiter ce message ?</div>
      </div>

      <div class="action-content">
        <div class="action-section">
          <div class="action-section-title">Action principale</div>
          <div class="action-buttons" id="actionButtons">
            <button class="action-btn" data-action="reply">
              <span class="icon">‚Ü©Ô∏è</span>
              <span class="label">R√©pondre</span>
              <span class="shortcut">R</span>
            </button>
            <button class="action-btn" data-action="delegate">
              <span class="icon">üë§</span>
              <span class="label">D√©l√©guer</span>
              <span class="shortcut">D</span>
            </button>
            <button class="action-btn" data-action="schedule">
              <span class="icon">üìÖ</span>
              <span class="label">Planifier</span>
              <span class="shortcut">P</span>
            </button>
            <button class="action-btn" data-action="info">
              <span class="icon">‚ÑπÔ∏è</span>
              <span class="label">Demander info</span>
              <span class="shortcut">I</span>
            </button>
            <button class="action-btn" data-action="archive">
              <span class="icon">üìÅ</span>
              <span class="label">Archiver (aucune action)</span>
              <span class="shortcut">A</span>
            </button>
          </div>
        </div>

        <div class="action-section" id="prioritySection" style="display:none">
          <div class="action-section-title">Priorit√©</div>
          <div class="priority-selector">
            <button class="priority-btn" data-priority="high">üî¥ Haute</button>
            <button class="priority-btn" data-priority="medium">üü† Moyenne</button>
            <button class="priority-btn" data-priority="low">üü¢ Basse</button>
          </div>
        </div>

        <div class="action-section" id="delegateSection" style="display:none">
          <div class="action-section-title">D√©l√©guer √†</div>
          <div class="delegate-selector" id="delegateSelector">
            <!-- Dynamically populated -->
          </div>
        </div>

        <div class="action-section">
          <div class="action-section-title">Notes (optionnel)</div>
          <textarea class="notes-area" id="notesArea" placeholder="Justifiez bri√®vement votre d√©cision..."></textarea>
        </div>
      </div>

      <div class="submit-section">
        <button class="submit-btn" id="submitBtn" disabled onclick="submitDecision()">
          <span>‚úì</span> Valider la d√©cision
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Notification Popup -->
<div class="notification-popup" id="notificationPopup">
  <div class="notification-header">
    <div class="notification-type">
      <span>üí¨</span>
      <span id="notifType">Message instantan√©</span>
    </div>
    <button class="notification-close" onclick="hideNotification()">√ó</button>
  </div>
  <div class="notification-content" id="notifContent"></div>
</div>

<!-- Intro Modal -->
<div class="modal-overlay show" id="introModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-icon">üìã</div>
      <div class="modal-title">IN-BASKET : JOUR 1</div>
      <div class="modal-subtitle">Test d'√©valuation manag√©riale</div>
    </div>
    <div class="modal-body">
      <div class="briefing-section">
        <div class="briefing-label">üìç Contexte</div>
        <div class="briefing-content">
          Vous √™tes <strong>Alex Martin</strong>, nouveau¬∑elle responsable d'une √©quipe de 6 personnes au sein de <strong>NexaCorp</strong>, une entreprise de services num√©riques. Votre pr√©d√©cesseur est parti pr√©cipitamment il y a 2 semaines. C'est votre premier jour.
        </div>
      </div>

      <div class="briefing-section">
        <div class="briefing-label">üì¨ Situation</div>
        <div class="briefing-content">
          Il est <strong>8h30, lundi matin</strong>. Votre bo√Æte mail contient <strong>12 messages</strong> accumul√©s pendant votre absence. Vous avez une r√©union de direction √† <strong>10h00</strong>. Vous disposez donc de <strong>30 minutes</strong> pour traiter au mieux ces messages.
        </div>
      </div>

      <div class="briefing-section">
        <div class="briefing-label">üéØ Objectif</div>
        <div class="briefing-content">
          <ul class="briefing-list">
            <li>Lire et analyser chaque message</li>
            <li>Choisir une action : r√©pondre, d√©l√©guer, planifier, demander info, archiver</li>
            <li>D√©finir la priorit√© et justifier si n√©cessaire</li>
            <li>√ätre √©valu√©¬∑e sur : priorisation, jugement, d√©l√©gation, r√©activit√©</li>
          </ul>
        </div>
      </div>

      <div class="briefing-section">
        <div class="briefing-label">üë• Votre √©quipe</div>
        <div class="briefing-content">
          <ul class="briefing-list">
            <li><strong>Sophie Durand</strong> ‚Äî D√©veloppeuse senior (10 ans d'exp.)</li>
            <li><strong>Marc Leblanc</strong> ‚Äî D√©veloppeur junior (1 an d'exp.)</li>
            <li><strong>Julie Chen</strong> ‚Äî Chef de projet</li>
            <li><strong>Thomas Petit</strong> ‚Äî Support client</li>
            <li><strong>√âmilie Roux</strong> ‚Äî Designer UX</li>
            <li><strong>Nicolas Fabre</strong> ‚Äî Stagiaire d√©veloppement</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="start-btn" onclick="startExercise()">
        üöÄ Commencer l'exercice
      </button>
    </div>
  </div>
</div>

<!-- Results Modal -->
<div class="modal-overlay" id="resultsModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-icon">üìä</div>
      <div class="modal-title">R√âSULTATS</div>
      <div class="modal-subtitle">Analyse de votre performance</div>
    </div>
    <div class="modal-body">
      <div class="results-grid">
        <div class="result-card">
          <div class="result-value" id="resultProcessed">0/12</div>
          <div class="result-label">Messages trait√©s</div>
        </div>
        <div class="result-card">
          <div class="result-value green" id="resultScore">0%</div>
          <div class="result-label">Score global</div>
        </div>
        <div class="result-card">
          <div class="result-value" id="resultTime">30:00</div>
          <div class="result-label">Temps utilis√©</div>
        </div>
      </div>

      <div class="feedback-section">
        <div class="feedback-title">üìà √âvaluation par comp√©tence</div>
        <div id="competenceFeedback">
          <!-- Dynamically populated -->
        </div>
      </div>

      <div class="feedback-section">
        <div class="feedback-title">üí° Points d'attention</div>
        <div id="improvementFeedback">
          <!-- Dynamically populated -->
        </div>
      </div>

      <div class="civix-reward">
        <div class="civix-icon">»ª</div>
        <div>
          <div style="font-size:0.75rem;color:var(--text-dim)">R√©compense</div>
          <div class="civix-amount" id="civixReward">+0 Civix</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="start-btn" onclick="location.reload()">
        üîÑ Recommencer
      </button>
    </div>
  </div>
</div>

<script>
// ============================================
// DATA
// ============================================
const teamMembers = [
  { id: 'sophie', name: 'Sophie Durand', role: 'D√©veloppeuse senior', initials: 'SD' },
  { id: 'marc', name: 'Marc Leblanc', role: 'D√©veloppeur junior', initials: 'ML' },
  { id: 'julie', name: 'Julie Chen', role: 'Chef de projet', initials: 'JC' },
  { id: 'thomas', name: 'Thomas Petit', role: 'Support client', initials: 'TP' },
  { id: 'emilie', name: '√âmilie Roux', role: 'Designer UX', initials: 'ER' },
  { id: 'nicolas', name: 'Nicolas Fabre', role: 'Stagiaire', initials: 'NF' }
];

const emails = [
  {
    id: 1,
    from: { name: 'Claire Dubois', email: 'c.dubois@nexacorp.com', initials: 'CD' },
    subject: 'URGENT : Client TechnoPlus menace de rompre le contrat',
    preview: 'Le client a appel√© furieux ce matin...',
    time: '08:15',
    tags: ['urgent', 'client'],
    body: `<p>Bonjour,</p>
<p>Le client <strong>TechnoPlus</strong> (notre 3√®me plus gros compte, 180K‚Ç¨/an) a appel√© ce matin absolument furieux. Leur plateforme e-commerce est en panne depuis vendredi soir et personne n'a r√©pondu √† leurs appels ce weekend.</p>
<p>M. Renard, leur directeur technique, menace de <strong>rompre le contrat</strong> si nous ne r√©solvons pas le probl√®me dans les 2 heures. Il veut parler √† un responsable.</p>
<p>Je n'ai pas les comp√©tences techniques pour diagnostiquer le probl√®me. L'ancien responsable g√©rait ce client personnellement.</p>
<p>Que dois-je faire ?</p>
<div class="signature">Claire Dubois<br>Assistante commerciale</div>`,
    attachments: [],
    optimalAction: 'reply',
    optimalPriority: 'high',
    optimalDelegate: null,
    reasoning: 'Client majeur en crise - n√©cessite une intervention imm√©diate du responsable pour rassurer et coordonner la r√©solution technique.',
    points: { reply: 10, delegate: 4, schedule: 0, info: 2, archive: 0 }
  },
  {
    id: 2,
    from: { name: 'RH - Syst√®me', email: 'rh@nexacorp.com', initials: 'RH' },
    subject: 'Rappel : Entretiens annuels √† planifier avant le 15',
    preview: 'Les entretiens de votre √©quipe doivent √™tre...',
    time: '07:45',
    tags: ['rh'],
    body: `<p>Bonjour,</p>
<p>Ce message automatique vous rappelle que les <strong>entretiens annuels d'√©valuation</strong> de votre √©quipe doivent √™tre planifi√©s avant le <strong>15 du mois</strong>.</p>
<p>Collaborateurs concern√©s : Sophie Durand, Marc Leblanc, Julie Chen, Thomas Petit, √âmilie Roux, Nicolas Fabre.</p>
<p>Merci de bloquer des cr√©neaux dans vos agendas respectifs et de transmettre le planning √† RH.</p>
<div class="signature">Service des Ressources Humaines<br>Message automatique</div>`,
    attachments: ['Formulaire_entretien.pdf'],
    optimalAction: 'schedule',
    optimalPriority: 'medium',
    optimalDelegate: 'julie',
    reasoning: 'T√¢che administrative importante mais non urgente. Peut √™tre planifi√©e pour la semaine prochaine ou d√©l√©gu√©e √† Julie pour l\'organisation.',
    points: { reply: 2, delegate: 7, schedule: 10, info: 3, archive: 0 }
  },
  {
    id: 3,
    from: { name: 'Marc Leblanc', email: 'm.leblanc@nexacorp.com', initials: 'ML' },
    subject: 'Demande de formation React avanc√©',
    preview: 'Je souhaiterais suivre une formation...',
    time: '08:02',
    tags: ['equipe'],
    body: `<p>Bonjour,</p>
<p>Je travaille chez NexaCorp depuis un an maintenant et je souhaiterais d√©velopper mes comp√©tences. J'ai identifi√© une formation <strong>"React Avanc√©"</strong> de 3 jours qui me permettrait d'√™tre plus autonome sur les projets front-end.</p>
<p>Le co√ªt est de 1 500‚Ç¨ et elle a lieu dans 3 semaines.</p>
<p>Est-ce que vous pourriez valider cette demande ? Mon ancien manager √©tait favorable mais n'a pas eu le temps de la finaliser.</p>
<p>Merci d'avance,</p>
<div class="signature">Marc Leblanc<br>D√©veloppeur junior</div>`,
    attachments: ['Programme_formation.pdf'],
    optimalAction: 'info',
    optimalPriority: 'low',
    optimalDelegate: null,
    reasoning: 'Demande l√©gitime mais n√©cessite plus d\'informations (budget formation disponible, avis de Sophie sur les besoins techniques). Pas urgent.',
    points: { reply: 5, delegate: 3, schedule: 6, info: 10, archive: 0 }
  },
  {
    id: 4,
    from: { name: 'Direction G√©n√©rale', email: 'direction@nexacorp.com', initials: 'DG' },
    subject: 'R√©union de direction - Ordre du jour',
    preview: 'Merci de pr√©parer un point sur...',
    time: '07:30',
    tags: ['direction'],
    body: `<p>Bonjour √† tous,</p>
<p>Pour rappel, la r√©union de direction de ce matin √† <strong>10h00</strong> abordera les points suivants :</p>
<ul>
<li>Bilan financier T3</li>
<li>Point sur les projets en cours (chaque responsable)</li>
<li>Annonce restructuration service support</li>
<li>Questions diverses</li>
</ul>
<p>Merci de pr√©parer un <strong>r√©sum√© de 5 minutes</strong> sur l'√©tat de vos projets et les probl√®mes rencontr√©s.</p>
<div class="signature">Nathalie Martin<br>Directrice G√©n√©rale</div>`,
    attachments: [],
    optimalAction: 'reply',
    optimalPriority: 'high',
    optimalDelegate: null,
    reasoning: 'R√©union dans 1h30 - priorit√© haute. Pr√©parer le point et confirmer sa pr√©sence. Demander √† Julie un r√©sum√© rapide des projets en cours.',
    points: { reply: 10, delegate: 2, schedule: 0, info: 5, archive: 0 }
  },
  {
    id: 5,
    from: { name: 'Sophie Durand', email: 's.durand@nexacorp.com', initials: 'SD' },
    subject: 'Alerte s√©curit√© - Faille d√©tect√©e sur projet Omega',
    preview: 'J\'ai identifi√© une vuln√©rabilit√© critique...',
    time: '08:22',
    tags: ['urgent', 'equipe'],
    body: `<p>Bonjour,</p>
<p>En faisant une revue de code ce weekend, j'ai d√©couvert une <strong>faille de s√©curit√© critique</strong> (injection SQL) sur le projet Omega, actuellement en production chez 3 clients.</p>
<p>La faille permet potentiellement d'acc√©der aux donn√©es utilisateurs. Je peux la corriger en 2-3 heures, mais il faudra ensuite d√©ployer le patch chez tous les clients.</p>
<p>Je pense qu'on devrait pr√©venir les clients concern√©s et corriger en priorit√©. Qu'en pensez-vous ?</p>
<p>Je reste disponible pour en discuter.</p>
<div class="signature">Sophie Durand<br>D√©veloppeuse senior</div>`,
    attachments: ['Rapport_vulnerabilite.pdf'],
    optimalAction: 'reply',
    optimalPriority: 'high',
    optimalDelegate: null,
    reasoning: 'Faille de s√©curit√© critique = priorit√© maximale. Valider imm√©diatement la correction par Sophie et coordonner la communication client.',
    points: { reply: 10, delegate: 3, schedule: 0, info: 2, archive: 0 }
  },
  {
    id: 6,
    from: { name: 'Thomas Petit', email: 't.petit@nexacorp.com', initials: 'TP' },
    subject: 'Absence demain - RDV m√©dical',
    preview: 'Je dois m\'absenter demain matin...',
    time: '07:55',
    tags: ['equipe'],
    body: `<p>Bonjour,</p>
<p>Je dois m'absenter demain matin (mardi) pour un rendez-vous m√©dical pr√©vu depuis longtemps. Je serai de retour vers 11h.</p>
<p>J'ai pr√©venu Julie pour la permanence support et elle peut me remplacer si urgence.</p>
<p>Est-ce que c'est OK pour vous ?</p>
<p>Merci,</p>
<div class="signature">Thomas Petit<br>Support client</div>`,
    attachments: [],
    optimalAction: 'reply',
    optimalPriority: 'low',
    optimalDelegate: null,
    reasoning: 'Demande simple et l√©gitime, remplacement d√©j√† organis√©. Validation rapide suffisante.',
    points: { reply: 10, delegate: 0, schedule: 3, info: 0, archive: 2 }
  },
  {
    id: 7,
    from: { name: 'Commercial - L√©a Bernard', email: 'l.bernard@nexacorp.com', initials: 'LB' },
    subject: 'Devis urgent - Prospect chaud MegaStore',
    preview: 'Le prospect attend un devis pour...',
    time: '08:10',
    tags: ['client'],
    body: `<p>Salut,</p>
<p>J'ai un prospect tr√®s chaud : <strong>MegaStore</strong> (cha√Æne de 50 magasins). Ils veulent une refonte compl√®te de leur syst√®me de gestion des stocks.</p>
<p>Le directeur des achats part en vacances mercredi et veut un devis avant. Potentiel : <strong>300K‚Ç¨</strong> sur 2 ans.</p>
<p>Est-ce que quelqu'un de ton √©quipe peut estimer la charge de travail aujourd'hui ? J'ai besoin de jours/homme et d'une estimation de d√©lai.</p>
<p>C'est vraiment une belle opportunit√©, on ne peut pas la laisser passer !</p>
<div class="signature">L√©a Bernard<br>Commerciale grands comptes</div>`,
    attachments: ['Cahier_des_charges_MegaStore.pdf'],
    optimalAction: 'delegate',
    optimalPriority: 'medium',
    optimalDelegate: 'julie',
    reasoning: 'Opportunit√© commerciale importante mais pas d\'urgence critique. D√©l√©guer l\'estimation √† Julie (chef de projet) avec support de Sophie pour le technique.',
    points: { reply: 5, delegate: 10, schedule: 4, info: 3, archive: 0 }
  },
  {
    id: 8,
    from: { name: 'Nicolas Fabre', email: 'n.fabre@nexacorp.com', initials: 'NF' },
    subject: 'Fin de stage dans 2 semaines',
    preview: 'Mon stage se termine bient√¥t...',
    time: '08:05',
    tags: ['equipe'],
    body: `<p>Bonjour,</p>
<p>Mon stage se termine dans 2 semaines et je voulais savoir s'il y avait une possibilit√© d'<strong>embauche en CDI</strong> ou au moins en CDD ?</p>
<p>J'ai beaucoup appris ici et j'aimerais vraiment continuer. L'ancien responsable m'avait dit qu'il en parlerait √† la direction mais je n'ai pas eu de nouvelles depuis.</p>
<p>Est-ce que vous pouvez me dire si c'est envisageable ?</p>
<p>Merci,</p>
<div class="signature">Nicolas Fabre<br>Stagiaire d√©veloppement</div>`,
    attachments: [],
    optimalAction: 'schedule',
    optimalPriority: 'medium',
    optimalDelegate: null,
    reasoning: 'Question importante pour le stagiaire mais n√©cessite r√©flexion et validation RH/direction. Planifier un entretien cette semaine.',
    points: { reply: 4, delegate: 2, schedule: 10, info: 6, archive: 0 }
  },
  {
    id: 9,
    from: { name: 'IT - Syst√®me', email: 'it@nexacorp.com', initials: 'IT' },
    subject: 'Maintenance serveurs samedi - Validation requise',
    preview: 'Une maintenance est pr√©vue ce samedi...',
    time: '07:40',
    tags: [],
    body: `<p>Bonjour,</p>
<p>Une maintenance des serveurs de production est planifi√©e pour <strong>samedi 14h-18h</strong>. Pendant cette p√©riode, les applications seront indisponibles.</p>
<p>Merci de confirmer que cette plage horaire convient √† votre √©quipe et qu'aucun d√©ploiement critique n'est pr√©vu.</p>
<p>En l'absence de r√©ponse avant jeudi, nous consid√©rerons que le cr√©neau est valid√©.</p>
<div class="signature">Service IT<br>Infrastructure</div>`,
    attachments: [],
    optimalAction: 'reply',
    optimalPriority: 'low',
    optimalDelegate: 'sophie',
    reasoning: 'Validation simple mais importante. V√©rifier avec Sophie qu\'aucun d√©ploiement n\'est pr√©vu, puis confirmer.',
    points: { reply: 7, delegate: 8, schedule: 3, info: 4, archive: 0 }
  },
  {
    id: 10,
    from: { name: 'Julie Chen', email: 'j.chen@nexacorp.com', initials: 'JC' },
    subject: 'Conflit dans l\'√©quipe - besoin d\'en parler',
    preview: 'Il y a des tensions entre Marc et...',
    time: '08:18',
    tags: ['equipe'],
    body: `<p>Bonjour,</p>
<p>Je voulais vous alerter sur une situation d√©licate. Depuis quelques semaines, il y a des <strong>tensions importantes entre Marc et Sophie</strong>.</p>
<p>Sophie reproche √† Marc de ne pas respecter les conventions de code et de lui cr√©er du travail suppl√©mentaire. Marc se sent constamment critiqu√© et surveill√©.</p>
<p>La semaine derni√®re, ils ont eu une altercation assez vive en r√©union. L'ambiance devient pesante pour toute l'√©quipe.</p>
<p>L'ancien responsable √©tait au courant mais n'a rien fait. Je pense qu'il faudrait intervenir avant que √ßa d√©g√©n√®re.</p>
<p>Est-ce qu'on peut en parler rapidement ?</p>
<div class="signature">Julie Chen<br>Chef de projet</div>`,
    attachments: [],
    optimalAction: 'schedule',
    optimalPriority: 'high',
    optimalDelegate: null,
    reasoning: 'Conflit d\'√©quipe = priorit√© manag√©riale importante. Planifier un entretien avec Julie, puis avec Marc et Sophie s√©par√©ment.',
    points: { reply: 6, delegate: 0, schedule: 10, info: 3, archive: 0 }
  },
  {
    id: 11,
    from: { name: '√âmilie Roux', email: 'e.roux@nexacorp.com', initials: 'ER' },
    subject: 'Maquettes projet Delta - Validation',
    preview: 'Les maquettes sont pr√™tes pour...',
    time: '07:50',
    tags: ['equipe'],
    body: `<p>Bonjour,</p>
<p>Les maquettes du projet Delta sont termin√©es. J'ai int√©gr√© les retours du client de la semaine derni√®re.</p>
<p>Est-ce que vous pouvez valider avant que je les envoie au client pour approbation finale ?</p>
<p>Le client attend une r√©ponse cette semaine.</p>
<p>Merci,</p>
<div class="signature">√âmilie Roux<br>Designer UX</div>`,
    attachments: ['Maquettes_Delta_v3.pdf', 'Changelog.txt'],
    optimalAction: 'delegate',
    optimalPriority: 'medium',
    optimalDelegate: 'julie',
    reasoning: 'Validation de maquettes peut √™tre d√©l√©gu√©e √† Julie (chef de projet) qui conna√Æt les attentes client. Revue rapide possible en parall√®le.',
    points: { reply: 5, delegate: 10, schedule: 4, info: 2, archive: 0 }
  },
  {
    id: 12,
    from: { name: 'Fournisseur - CloudServ', email: 'contact@cloudserv.io', initials: 'CS' },
    subject: 'Renouvellement contrat h√©bergement - R√©ponse avant 30/11',
    preview: 'Votre contrat arrive √† √©ch√©ance...',
    time: '07:35',
    tags: [],
    body: `<p>Madame, Monsieur,</p>
<p>Votre contrat d'h√©bergement cloud arrive √† √©ch√©ance le <strong>30 novembre</strong>.</p>
<p>Nous vous proposons un renouvellement aux conditions suivantes :</p>
<ul>
<li>Formule actuelle : 2 400‚Ç¨/mois</li>
<li>Nouvelle offre : 2 200‚Ç¨/mois (-8%) si engagement 2 ans</li>
<li>Option upgrade : +500‚Ç¨/mois pour capacit√© doubl√©e</li>
</ul>
<p>Merci de nous faire part de votre d√©cision avant le 30/11 pour assurer la continuit√© de service.</p>
<div class="signature">Service commercial<br>CloudServ</div>`,
    attachments: ['Proposition_commerciale.pdf'],
    optimalAction: 'info',
    optimalPriority: 'medium',
    optimalDelegate: null,
    reasoning: 'D√©cision financi√®re importante mais pas urgente (√©ch√©ance √† 1 mois). Demander des infos sur les besoins r√©els avant de d√©cider.',
    points: { reply: 3, delegate: 5, schedule: 6, info: 10, archive: 0 }
  }
];

const interruptMessages = [
  { time: 120, type: 'call', sender: 'Accueil', content: 'M. Renard de TechnoPlus est en ligne, il insiste pour vous parler imm√©diatement.', urgent: true },
  { time: 300, type: 'message', sender: 'Sophie Durand', content: 'Le patch est pr√™t. Je d√©ploie maintenant ou j\'attends votre feu vert ?', urgent: false },
  { time: 480, type: 'message', sender: 'Direction', content: 'Rappel : la r√©union commence dans 45 minutes. Merci de confirmer votre pr√©sence.', urgent: false },
  { time: 720, type: 'call', sender: 'L√©a Bernard', content: 'MegaStore vient de rappeler, ils veulent une conf call √† 14h pour discuter du devis. Tu peux ?', urgent: false },
  { time: 960, type: 'message', sender: 'Marc Leblanc', content: 'J\'ai vu que Sophie a committ√© un fix sur mon code sans me pr√©venir. On peut en parler ?', urgent: false }
];

// ============================================
// STATE
// ============================================
let state = {
  started: false,
  timeRemaining: 30 * 60,
  currentEmail: null,
  decisions: {},
  selectedAction: null,
  selectedPriority: null,
  selectedDelegate: null,
  notes: '',
  processedCount: 0,
  stressLevel: 1,
  interruptIndex: 0
};

let timerInterval = null;

// ============================================
// INIT
// ============================================
function init() {
  renderInbox();
  renderDelegateSelector();
  setupEventListeners();
}

function startExercise() {
  state.started = true;
  document.getElementById('introModal').classList.remove('show');
  startTimer();
  scheduleInterrupts();
}

// ============================================
// TIMER
// ============================================
function startTimer() {
  timerInterval = setInterval(() => {
    state.timeRemaining--;
    updateTimerDisplay();
    
    if (state.timeRemaining <= 0) {
      endExercise();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const mins = Math.floor(state.timeRemaining / 60);
  const secs = state.timeRemaining % 60;
  document.getElementById('timerValue').textContent = 
    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  
  const box = document.getElementById('timerBox');
  box.classList.remove('warning', 'danger');
  
  if (state.timeRemaining <= 300) {
    box.classList.add('danger');
    updateStress(5);
  } else if (state.timeRemaining <= 600) {
    box.classList.add('warning');
    updateStress(4);
  }
}

// ============================================
// INBOX
// ============================================
function renderInbox() {
  const list = document.getElementById('inboxList');
  list.innerHTML = emails.map(email => {
    const isProcessed = state.decisions[email.id];
    const isActive = state.currentEmail === email.id;
    const isUnread = !state.decisions[email.id] && state.currentEmail !== email.id;
    const isUrgent = email.tags.includes('urgent');
    
    return `
      <div class="inbox-item ${isActive ? 'active' : ''} ${isUnread ? 'unread' : ''} ${isProcessed ? 'processed' : ''} ${isUrgent ? 'urgent' : ''}"
           onclick="openEmail(${email.id})">
        <div class="inbox-sender">
          <span class="sender-name">${email.from.name}</span>
          <span class="inbox-time">${email.time}</span>
        </div>
        <div class="inbox-subject">${email.subject}</div>
        <div class="inbox-preview">${email.preview}</div>
        <div class="inbox-tags">
          ${email.tags.map(t => `<span class="tag ${t}">${t}</span>`).join('')}
        </div>
      </div>
    `;
  }).join('');
  
  updateCounts();
}

function updateCounts() {
  const unread = emails.filter(e => !state.decisions[e.id]).length;
  const urgent = emails.filter(e => e.tags.includes('urgent') && !state.decisions[e.id]).length;
  
  document.getElementById('unreadBadge').textContent = unread;
  document.getElementById('countAll').textContent = emails.length;
  document.getElementById('countUrgent').textContent = urgent;
  document.getElementById('countUnread').textContent = unread;
  document.getElementById('processedCount').textContent = state.processedCount;
  document.getElementById('totalCount').textContent = emails.length;
  
  // Update progress ring
  const progress = (state.processedCount / emails.length) * 100;
  const circumference = 2 * Math.PI * 18;
  const offset = circumference - (circumference * progress / 100);
  document.getElementById('progressRing').style.strokeDashoffset = offset;
}

function openEmail(id) {
  const email = emails.find(e => e.id === id);
  if (!email) return;
  
  state.currentEmail = id;
  state.selectedAction = null;
  state.selectedPriority = null;
  state.selectedDelegate = null;
  state.notes = '';
  
  renderEmailViewer(email);
  renderInbox();
  resetActionPanel();
}

function renderEmailViewer(email) {
  const viewer = document.getElementById('emailViewer');
  
  viewer.innerHTML = `
    <div class="email-header">
      <div class="email-subject-line">${email.subject}</div>
      <div class="email-meta">
        <div class="email-from">
          <div class="email-avatar">${email.from.initials}</div>
          <div class="email-from-info">
            <div class="email-from-name">${email.from.name}</div>
            <div class="email-from-address">${email.from.email}</div>
          </div>
        </div>
        <div class="email-date">Aujourd'hui, ${email.time}</div>
      </div>
    </div>
    <div class="email-body">${email.body}</div>
    ${email.attachments.length > 0 ? `
      <div class="email-attachments">
        <div class="attachment-label">üìé Pi√®ces jointes (${email.attachments.length})</div>
        ${email.attachments.map(a => `
          <span class="attachment-item">üìÑ ${a}</span>
        `).join('')}
      </div>
    ` : ''}
  `;
  
  document.getElementById('emptyState')?.remove();
}

// ============================================
// ACTIONS
// ============================================
function renderDelegateSelector() {
  const selector = document.getElementById('delegateSelector');
  selector.innerHTML = teamMembers.map(member => `
    <div class="delegate-option" data-delegate="${member.id}" onclick="selectDelegate('${member.id}')">
      <div class="delegate-avatar">${member.initials}</div>
      <div class="delegate-info">
        <div class="delegate-name">${member.name}</div>
        <div class="delegate-role">${member.role}</div>
      </div>
    </div>
  `).join('');
}

function resetActionPanel() {
  document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('selected'));
  document.querySelectorAll('.priority-btn').forEach(btn => btn.classList.remove('selected'));
  document.querySelectorAll('.delegate-option').forEach(opt => opt.classList.remove('selected'));
  document.getElementById('prioritySection').style.display = 'none';
  document.getElementById('delegateSection').style.display = 'none';
  document.getElementById('notesArea').value = '';
  document.getElementById('submitBtn').disabled = true;
}

function selectAction(action) {
  state.selectedAction = action;
  
  document.querySelectorAll('.action-btn').forEach(btn => {
    btn.classList.toggle('selected', btn.dataset.action === action);
  });
  
  document.getElementById('prioritySection').style.display = 'block';
  document.getElementById('delegateSection').style.display = action === 'delegate' ? 'block' : 'none';
  
  validateSubmit();
}

function selectPriority(priority) {
  state.selectedPriority = priority;
  
  document.querySelectorAll('.priority-btn').forEach(btn => {
    btn.classList.remove('selected', 'high', 'medium', 'low');
    if (btn.dataset.priority === priority) {
      btn.classList.add('selected', priority);
    }
  });
  
  validateSubmit();
}

function selectDelegate(delegateId) {
  state.selectedDelegate = delegateId;
  
  document.querySelectorAll('.delegate-option').forEach(opt => {
    opt.classList.toggle('selected', opt.dataset.delegate === delegateId);
  });
  
  validateSubmit();
}

function validateSubmit() {
  const btn = document.getElementById('submitBtn');
  let valid = state.selectedAction && state.selectedPriority;
  
  if (state.selectedAction === 'delegate' && !state.selectedDelegate) {
    valid = false;
  }
  
  btn.disabled = !valid;
}

function submitDecision() {
  if (!state.currentEmail) return;
  
  const email = emails.find(e => e.id === state.currentEmail);
  
  state.decisions[state.currentEmail] = {
    action: state.selectedAction,
    priority: state.selectedPriority,
    delegate: state.selectedDelegate,
    notes: document.getElementById('notesArea').value,
    points: email.points[state.selectedAction] || 0
  };
  
  state.processedCount++;
  
  // Find next unprocessed email
  const nextEmail = emails.find(e => !state.decisions[e.id]);
  if (nextEmail) {
    openEmail(nextEmail.id);
  } else {
    state.currentEmail = null;
    endExercise();
  }
  
  renderInbox();
  updateStress(Math.max(1, 5 - Math.floor(state.processedCount / 3)));
}

// ============================================
// INTERRUPTS
// ============================================
function scheduleInterrupts() {
  interruptMessages.forEach(interrupt => {
    setTimeout(() => {
      if (state.started && state.timeRemaining > 0) {
        showNotification(interrupt);
      }
    }, interrupt.time * 1000);
  });
}

function showNotification(interrupt) {
  const popup = document.getElementById('notificationPopup');
  const typeEl = document.getElementById('notifType');
  const contentEl = document.getElementById('notifContent');
  
  popup.classList.toggle('urgent', interrupt.urgent);
  typeEl.innerHTML = `<span>${interrupt.type === 'call' ? 'üìû' : 'üí¨'}</span> ${interrupt.type === 'call' ? 'Appel entrant' : 'Message instantan√©'}`;
  contentEl.innerHTML = `<span class="notification-sender">${interrupt.sender}</span> : ${interrupt.content}`;
  
  popup.classList.add('show');
  
  if (interrupt.urgent) {
    updateStress(5);
  }
  
  setTimeout(() => {
    popup.classList.remove('show');
  }, 8000);
}

function hideNotification() {
  document.getElementById('notificationPopup').classList.remove('show');
}

// ============================================
// STRESS
// ============================================
function updateStress(level) {
  state.stressLevel = Math.min(5, Math.max(1, level));
  const bars = document.querySelectorAll('.stress-bar');
  
  bars.forEach((bar, i) => {
    bar.classList.remove('active', 'warning', 'danger');
    if (i < state.stressLevel) {
      if (state.stressLevel >= 4) bar.classList.add('danger');
      else if (state.stressLevel >= 3) bar.classList.add('warning');
      else bar.classList.add('active');
    }
  });
}

// ============================================
// END & RESULTS
// ============================================
function endExercise() {
  clearInterval(timerInterval);
  state.started = false;
  
  calculateResults();
  document.getElementById('resultsModal').classList.add('show');
}

function calculateResults() {
  let totalPoints = 0;
  let maxPoints = 0;
  let priorityScore = 0;
  let delegationScore = 0;
  let urgentHandled = 0;
  let urgentTotal = 0;
  
  emails.forEach(email => {
    maxPoints += 10;
    const decision = state.decisions[email.id];
    
    if (email.tags.includes('urgent')) urgentTotal++;
    
    if (decision) {
      totalPoints += decision.points;
      
      // Check priority alignment
      if (decision.priority === email.optimalPriority) priorityScore++;
      
      // Check delegation
      if (email.optimalAction === 'delegate' && decision.action === 'delegate') {
        if (decision.delegate === email.optimalDelegate) delegationScore += 2;
        else delegationScore += 1;
      }
      
      // Urgent handling
      if (email.tags.includes('urgent')) urgentHandled++;
    }
  });
  
  const scorePercent = Math.round((totalPoints / maxPoints) * 100);
  const timeUsed = 30 * 60 - state.timeRemaining;
  const mins = Math.floor(timeUsed / 60);
  const secs = timeUsed % 60;
  
  document.getElementById('resultProcessed').textContent = `${state.processedCount}/${emails.length}`;
  document.getElementById('resultScore').textContent = `${scorePercent}%`;
  document.getElementById('resultScore').className = `result-value ${scorePercent >= 70 ? 'green' : scorePercent >= 50 ? 'orange' : 'red'}`;
  document.getElementById('resultTime').textContent = `${mins}:${String(secs).padStart(2, '0')}`;
  
  // Competence feedback
  const competences = [
    { name: 'Priorisation', score: Math.round((priorityScore / emails.length) * 100), icon: 'üéØ' },
    { name: 'Gestion des urgences', score: urgentTotal > 0 ? Math.round((urgentHandled / urgentTotal) * 100) : 100, icon: '‚ö°' },
    { name: 'D√©l√©gation', score: Math.round((delegationScore / 6) * 100), icon: 'üë•' },
    { name: 'R√©activit√©', score: Math.round((state.processedCount / emails.length) * 100), icon: '‚è±Ô∏è' }
  ];
  
  document.getElementById('competenceFeedback').innerHTML = competences.map(c => `
    <div class="feedback-item">
      <span class="feedback-icon">${c.icon}</span>
      <span style="flex:1">${c.name}</span>
      <span style="color:${c.score >= 70 ? 'var(--green)' : c.score >= 50 ? 'var(--orange)' : 'var(--red)'};font-weight:600">${c.score}%</span>
    </div>
  `).join('');
  
  // Improvement feedback
  const improvements = [];
  if (priorityScore < emails.length * 0.7) improvements.push('Affiner l\'√©valuation des priorit√©s');
  if (urgentHandled < urgentTotal) improvements.push('Traiter les urgences en premier');
  if (state.processedCount < emails.length * 0.8) improvements.push('Am√©liorer la vitesse de traitement');
  if (delegationScore < 3) improvements.push('Utiliser davantage la d√©l√©gation');
  
  document.getElementById('improvementFeedback').innerHTML = improvements.length > 0 
    ? improvements.map(i => `<div class="feedback-item"><span class="feedback-icon">üí°</span><span>${i}</span></div>`).join('')
    : '<div class="feedback-item"><span class="feedback-icon">‚ú®</span><span>Excellente performance !</span></div>';
  
  // Civix reward
  const civix = Math.round(150 * (scorePercent / 100)) + (state.processedCount * 5);
  document.getElementById('civixReward').textContent = `+${civix} Civix`;
}

// ============================================
// EVENT LISTENERS
// ============================================
function setupEventListeners() {
  // Action buttons
  document.querySelectorAll('.action-btn').forEach(btn => {
    btn.addEventListener('click', () => selectAction(btn.dataset.action));
  });
  
  // Priority buttons
  document.querySelectorAll('.priority-btn').forEach(btn => {
    btn.addEventListener('click', () => selectPriority(btn.dataset.priority));
  });
  
  // Inbox tabs
  document.querySelectorAll('.inbox-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.inbox-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      // Filter logic could be added here
    });
  });
  
  // Keyboard shortcuts
  document.addEventListener('keydown', e => {
    if (!state.started || !state.currentEmail) return;
    
    switch(e.key.toLowerCase()) {
      case 'r': selectAction('reply'); break;
      case 'd': selectAction('delegate'); break;
      case 'p': selectAction('schedule'); break;
      case 'i': selectAction('info'); break;
      case 'a': selectAction('archive'); break;
      case '1': selectPriority('high'); break;
      case '2': selectPriority('medium'); break;
      case '3': selectPriority('low'); break;
      case 'enter':
        if (!document.getElementById('submitBtn').disabled) {
          submitDecision();
        }
        break;
    }
  });
}

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
