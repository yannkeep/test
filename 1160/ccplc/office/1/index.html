<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission #0 ‚Äî ULTRA</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}

:root{
  --bg:#030308;
  --panel:rgba(12,14,28,0.7);
  --panel-solid:#0c0e1c;
  --border:#1e2040;
  --border-glow:rgba(177,156,217,0.3);
  --text:#e8eaf0;
  --text-dim:#8892b0;
  --lilac:#b19cd9;
  --lilac-bright:#d4c4ff;
  --lilac-dim:#8b7aaf;
  --purple:#8b5cf6;
  --green:#00ff88;
  --green-dim:#00cc6a;
  --cyan:#00f0ff;
  --magenta:#ff00aa;
  --glow-lilac:rgba(177,156,217,0.5);
  --glow-green:rgba(0,255,136,0.5);
  --glow-cyan:rgba(0,240,255,0.4);
  --radius:12px;
  --mono:'Fira Code','Courier New',monospace;
  --font:system-ui,-apple-system,sans-serif;
}

#particles{position:fixed;inset:0;z-index:0;pointer-events:none}

.aurora{position:fixed;inset:0;z-index:1;pointer-events:none;overflow:hidden}
.aurora::before{
  content:'';position:absolute;width:200%;height:200%;top:-50%;left:-50%;
  background:radial-gradient(ellipse 80% 50% at 20% 30%,rgba(177,156,217,0.12),transparent),radial-gradient(ellipse 60% 40% at 80% 70%,rgba(0,255,136,0.08),transparent),radial-gradient(ellipse 70% 50% at 50% 90%,rgba(0,240,255,0.06),transparent);
  animation:auroraMove 25s ease-in-out infinite;
}
@keyframes auroraMove{0%,100%{transform:translate(0,0) rotate(0deg)}33%{transform:translate(3%,2%) rotate(1deg)}66%{transform:translate(-2%,3%) rotate(-1deg)}}

.blob{position:fixed;border-radius:50%;filter:blur(100px);pointer-events:none;z-index:1;mix-blend-mode:screen;opacity:0.6}
.blob-1{width:500px;height:500px;background:radial-gradient(circle,rgba(177,156,217,0.25),transparent 70%);top:-150px;left:-150px;animation:blobFloat1 20s ease-in-out infinite}
.blob-2{width:400px;height:400px;background:radial-gradient(circle,rgba(0,255,136,0.2),transparent 70%);bottom:-100px;right:-100px;animation:blobFloat2 25s ease-in-out infinite}
.blob-3{width:300px;height:300px;background:radial-gradient(circle,rgba(0,240,255,0.15),transparent 70%);top:50%;left:50%;animation:blobFloat3 18s ease-in-out infinite}
@keyframes blobFloat1{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(80px,60px) scale(1.15)}}
@keyframes blobFloat2{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(-60px,-50px) scale(1.1)}}
@keyframes blobFloat3{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.25)}}

.grid-bg{position:fixed;inset:0;z-index:2;pointer-events:none;background-image:linear-gradient(rgba(177,156,217,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(177,156,217,0.02) 1px,transparent 1px);background-size:60px 60px}

body::before{content:'';position:fixed;top:0;left:0;width:100%;height:4px;background:linear-gradient(90deg,transparent,var(--lilac),var(--cyan),var(--lilac),transparent);animation:scanMove 5s linear infinite;opacity:0.6;pointer-events:none;z-index:9999;box-shadow:0 0 30px var(--lilac),0 0 60px var(--cyan)}
@keyframes scanMove{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px);pointer-events:none;z-index:9998}

body{font-family:var(--mono);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

.container{position:relative;z-index:10;max-width:100vw;margin:0 auto;padding:1rem;height:100vh;display:flex;flex-direction:column}

header{text-align:center;padding:1.5rem 1rem;background:var(--panel);backdrop-filter:blur(20px) saturate(180%);border:1px solid var(--border);border-radius:var(--radius) var(--radius) 0 0;margin-bottom:1rem;position:relative;overflow:hidden}
header::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--lilac),var(--green),var(--lilac),transparent)}
header::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--lilac-dim),transparent);box-shadow:0 0 20px var(--glow-lilac)}

h1{font-size:clamp(1.4rem,4vw,2.2rem);text-transform:uppercase;letter-spacing:0.4em;background:linear-gradient(135deg,var(--lilac),var(--cyan),var(--lilac-bright));background-size:200% 200%;animation:gradientShift 6s ease infinite,glowPulse 3s ease-in-out infinite;-webkit-background-clip:text;background-clip:text;color:transparent;position:relative}
h1::after{content:'‚óâ Recrue-Zone';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:inherit;-webkit-background-clip:text;background-clip:text;color:transparent;filter:blur(20px);opacity:0.5;z-index:-1}
@keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
@keyframes glowPulse{0%,100%{filter:drop-shadow(0 0 5px var(--lilac))}50%{filter:drop-shadow(0 0 15px var(--lilac-bright))}}

.subtitle{color:var(--green);font-size:0.85rem;margin-top:0.5rem;letter-spacing:0.25em;text-shadow:0 0 15px var(--glow-green);animation:subtitleBlink 4s ease-in-out infinite}
@keyframes subtitleBlink{0%,100%{opacity:1}50%{opacity:0.7}}

.toolbar{display:flex;gap:0.6rem;padding:1rem;background:var(--panel);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:1rem;flex-wrap:wrap;align-items:center;position:relative}
.toolbar::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(177,156,217,0.3),transparent)}

.toolbar-btn{background:rgba(177,156,217,0.1);border:1px solid var(--border);color:var(--lilac);padding:0.6rem 1.2rem;border-radius:8px;cursor:pointer;font-family:var(--mono);font-size:0.85rem;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:flex;align-items:center;gap:0.5rem;white-space:nowrap;position:relative;overflow:hidden}
.toolbar-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(177,156,217,0.2),transparent);opacity:0;transition:opacity 0.3s}
.toolbar-btn:hover{background:rgba(177,156,217,0.2);border-color:var(--lilac);transform:translateY(-3px);box-shadow:0 10px 30px rgba(177,156,217,0.3),0 0 20px var(--glow-lilac)}
.toolbar-btn:hover::before{opacity:1}
.toolbar-btn.active{background:rgba(0,255,136,0.15);border-color:var(--green);color:var(--green);box-shadow:0 0 25px var(--glow-green)}

.toolbar-separator{width:1px;height:35px;background:linear-gradient(180deg,transparent,var(--lilac-dim),transparent)}

.filename-input{flex:1;min-width:200px;background:rgba(0,0,0,0.4);border:1px solid var(--border);color:var(--text);padding:0.6rem 1rem;border-radius:8px;font-family:var(--mono);font-size:0.9rem;transition:all 0.3s}
.filename-input:focus{outline:none;border-color:var(--lilac);box-shadow:0 0 25px var(--glow-lilac),inset 0 0 20px rgba(177,156,217,0.05)}
.filename-input::placeholder{color:var(--text-dim)}

.workspace{flex:1;display:grid;grid-template-columns:260px 1fr;gap:1rem;overflow:hidden}

.sidebar{background:var(--panel);backdrop-filter:blur(20px);border:2px solid var(--green);border-radius:var(--radius);padding:1rem;overflow-y:auto;display:flex;flex-direction:column;position:relative;box-shadow:0 0 40px rgba(0,255,136,0.15),inset 0 0 30px rgba(0,255,136,0.02)}
.sidebar::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--green),transparent)}

.sidebar-title{font-size:1.1rem;margin-bottom:1rem;color:var(--green);text-shadow:0 0 15px var(--glow-green);border-bottom:1px solid rgba(0,255,136,0.3);padding-bottom:0.6rem;letter-spacing:0.1em}

.folder-path{background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.2);padding:0.6rem;border-radius:6px;font-size:0.8rem;margin-bottom:1rem;color:var(--green);word-break:break-all;text-shadow:0 0 8px var(--glow-green)}

.file-tree{flex:1;overflow-y:auto}

.file-item,.folder-item{padding:0.7rem;margin-bottom:0.5rem;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);background:rgba(255,255,255,0.02);display:flex;align-items:center;gap:0.6rem;font-size:0.85rem;position:relative;overflow:hidden}
.file-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--lilac);opacity:0;transition:opacity 0.3s}
.file-item:hover{border-color:var(--lilac);background:rgba(177,156,217,0.1);transform:translateX(8px);box-shadow:0 0 20px rgba(177,156,217,0.2)}
.file-item:hover::before{opacity:1}
.file-item.active{border-color:var(--green);background:rgba(0,255,136,0.1);box-shadow:0 0 30px var(--glow-green),inset 0 0 20px rgba(0,255,136,0.03)}
.file-item.active::before{background:var(--green);opacity:1}
.file-item.active .file-name{color:var(--green);text-shadow:0 0 10px var(--glow-green)}

.file-icon,.folder-icon{font-size:1.1rem;min-width:1.2rem}
.file-name,.folder-name{flex:1;word-break:break-word}

.upload-area{border:2px dashed var(--lilac-dim);border-radius:var(--radius);padding:1.5rem;text-align:center;margin-bottom:1rem;cursor:pointer;transition:all 0.3s;background:rgba(177,156,217,0.03);font-size:0.8rem}
.upload-area:hover{border-color:var(--lilac);background:rgba(177,156,217,0.1);box-shadow:0 0 30px var(--glow-lilac)}
.upload-area.drag-over{border-color:var(--green);background:rgba(0,255,136,0.1);box-shadow:0 0 30px var(--glow-green)}
.upload-icon{font-size:2rem;color:var(--lilac);margin-bottom:0.5rem}
input[type="file"]{display:none}

.editor-container{display:grid;grid-template-columns:1fr 1fr;gap:1rem;overflow:hidden}
.editor-container.preview-only{grid-template-columns:1fr}
.editor-container.editor-only{grid-template-columns:1fr}

.editor-panel,.preview-panel{background:var(--panel);backdrop-filter:blur(20px);border:2px solid var(--lilac-dim);border-radius:var(--radius);display:flex;flex-direction:column;overflow:hidden;position:relative;box-shadow:0 0 40px rgba(177,156,217,0.1)}
.editor-panel::before,.preview-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--lilac),transparent)}

.panel-header{background:linear-gradient(135deg,var(--lilac-dim),var(--purple));color:white;padding:0.7rem 1rem;font-weight:600;font-size:0.9rem;display:flex;justify-content:space-between;align-items:center;letter-spacing:0.05em}
.panel-tools{display:flex;gap:0.5rem}
.panel-tool-btn{background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.2);color:white;padding:0.25rem 0.6rem;border-radius:4px;cursor:pointer;font-size:0.75rem;transition:all 0.3s}
.panel-tool-btn:hover{background:rgba(255,255,255,0.25);transform:translateY(-2px)}

.editor-textarea{flex:1;padding:1.5rem;border:none;font-family:var(--mono);font-size:0.95rem;line-height:1.7;resize:none;color:var(--text);background:rgba(0,0,0,0.3)}
.editor-textarea:focus{outline:none}
.editor-textarea::placeholder{color:var(--text-dim)}

.preview-content{flex:1;padding:1.5rem;overflow-y:auto;line-height:1.8;background:rgba(0,0,0,0.2)}
.preview-content h1,.preview-content h2,.preview-content h3,.preview-content h4,.preview-content h5,.preview-content h6{color:var(--lilac-bright);margin:2rem 0 1rem;text-shadow:0 0 10px var(--glow-lilac);border-bottom:2px solid var(--lilac-dim);padding-bottom:0.5rem}
.preview-content h1{font-size:2rem}.preview-content h2{font-size:1.6rem}.preview-content h3{font-size:1.3rem}
.preview-content p{margin:1rem 0}
.preview-content a{color:var(--cyan);text-decoration:none;border-bottom:1px solid var(--cyan);transition:all 0.3s}
.preview-content a:hover{color:var(--lilac-bright);border-color:var(--lilac-bright);text-shadow:0 0 10px var(--glow-lilac)}
.preview-content code{background:rgba(177,156,217,0.15);padding:0.2rem 0.5rem;border-radius:4px;color:var(--lilac-bright);font-size:0.9em;border:1px solid var(--border)}
.preview-content pre{background:#0a0b15;border:2px solid var(--green);border-radius:var(--radius);padding:1.5rem;overflow-x:auto;margin:1.5rem 0;box-shadow:0 0 30px var(--glow-green),inset 0 0 30px rgba(0,255,136,0.02)}
.preview-content pre code{background:none;border:none;padding:0;color:var(--green)}
.preview-content blockquote{border-left:4px solid var(--lilac);padding:1rem 1.5rem;margin:1.5rem 0;color:var(--lilac);font-style:italic;background:rgba(177,156,217,0.05);border-radius:0 var(--radius) var(--radius) 0}
.preview-content ul,.preview-content ol{margin:1rem 0 1rem 2rem}.preview-content li{margin:0.5rem 0}
.preview-content img{max-width:100%;height:auto;border-radius:var(--radius);border:2px solid var(--lilac);margin:1.5rem 0;box-shadow:0 0 30px var(--glow-lilac)}
.preview-content table{width:100%;border-collapse:collapse;margin:1.5rem 0;border:2px solid var(--lilac);border-radius:var(--radius);overflow:hidden}
.preview-content th{background:var(--lilac);color:white;padding:0.8rem;text-align:left}
.preview-content td{padding:0.6rem 0.8rem;border-bottom:1px solid var(--border)}
.preview-content tr:hover{background:rgba(177,156,217,0.1)}
.mermaid{background:rgba(177,156,217,0.05);padding:2rem;border-radius:var(--radius);border:2px solid var(--lilac);margin:1.5rem 0}

.stats-bar{background:var(--panel);backdrop-filter:blur(10px);border-top:1px solid var(--border);padding:0.5rem 1rem;font-size:0.8rem;color:var(--text-dim);display:flex;justify-content:space-between;align-items:center}
.stat-item{display:flex;align-items:center;gap:0.4rem}.stat-item span:first-child{color:var(--lilac)}

.toast{position:fixed;bottom:2rem;right:2rem;background:var(--panel);backdrop-filter:blur(20px);border:2px solid var(--lilac);border-radius:var(--radius);padding:1rem 1.5rem;color:var(--text);box-shadow:0 0 40px var(--glow-lilac);z-index:3000;transform:translateY(100px);opacity:0;transition:all 0.4s cubic-bezier(0.4,0,0.2,1);font-size:0.9rem}
.toast.active{transform:translateY(0);opacity:1}

::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:rgba(177,156,217,0.05);border-radius:4px}
::-webkit-scrollbar-thumb{background:linear-gradient(var(--lilac),var(--purple));border-radius:4px}
::-webkit-scrollbar-thumb:hover{background:linear-gradient(var(--lilac-bright),var(--lilac))}

@media(max-width:1200px){.workspace{grid-template-columns:220px 1fr}}
@media(max-width:768px){.workspace{grid-template-columns:1fr}.sidebar{max-height:200px}.editor-container{grid-template-columns:1fr}.toolbar{flex-direction:column}.filename-input{width:100%}}
</style>
</head>
<body>

<canvas id="particles"></canvas>
<div class="aurora"></div>
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>
<div class="grid-bg"></div>

<div class="container">
  <header>
    <h1>‚óâ Recrue-Zone</h1>
    <div class="subtitle">[ edit.preview.export.markdown ]</div>
  </header>

  <div class="toolbar">
    <button class="toolbar-btn" onclick="newFile()" title="Nouveau fichier">üìÑ Nouveau</button>
    <button class="toolbar-btn" onclick="saveToFolder()" title="Sauvegarder">üíæ Sauvegarder</button>
    <button class="toolbar-btn" onclick="exportMd()" title="Exporter MD">üì• Export MD</button>
    <button class="toolbar-btn" onclick="exportHtml()" title="Exporter HTML">üåê Export HTML</button>
    <button class="toolbar-btn" onclick="refreshFolder()" title="Rafra√Æchir">üîÑ Refresh</button>
    <div class="toolbar-separator"></div>
    <button class="toolbar-btn active" id="viewSplit" onclick="setView('split')" title="Vue Split">‚öè Split</button>
    <button class="toolbar-btn" id="viewEditor" onclick="setView('editor')" title="√âditeur seul">‚úèÔ∏è Edit</button>
    <button class="toolbar-btn" id="viewPreview" onclick="setView('preview')" title="Aper√ßu seul">üëÅÔ∏è Preview</button>
    <div class="toolbar-separator"></div>
    <input type="text" class="filename-input" id="filenameInput" placeholder="nom-du-fichier.md" value="">
  </div>

  <div class="workspace">
    <div class="sidebar">
      <h3 class="sidebar-title">‚ü© Fichiers</h3>
      <div class="folder-path">üìÅ ./markdown/</div>
      <label for="fileInput" class="upload-area" id="uploadArea"><div class="upload-icon">‚¨Ü</div><div>Charger .md</div></label>
      <input type="file" id="fileInput" accept=".md,.markdown" multiple>
      <div class="file-tree" id="fileTree"></div>
    </div>

    <div class="editor-container" id="editorContainer">
      <div class="editor-panel" id="editorPanel">
        <div class="panel-header">
          <span>‚úé √âditeur Markdown</span>
          <div class="panel-tools">
            <button class="panel-tool-btn" onclick="insertText('**','**')">B</button>
            <button class="panel-tool-btn" onclick="insertText('*','*')">I</button>
            <button class="panel-tool-btn" onclick="insertText('[','](url)')">üîó</button>
            <button class="panel-tool-btn" onclick="insertText('\`','\`')">{ }</button>
          </div>
        </div>
        <textarea class="editor-textarea" id="editor" placeholder="# Commencez √† √©crire..."></textarea>
        <div class="stats-bar">
          <div class="stat-item"><span>‚å®</span> <span id="charCount">0</span> car.</div>
          <div class="stat-item"><span>üìù</span> <span id="wordCount">0</span> mots</div>
          <div class="stat-item"><span>üìÑ</span> <span id="lineCount">1</span> lignes</div>
        </div>
      </div>
      <div class="preview-panel" id="previewPanel">
        <div class="panel-header"><span>üëÅ Aper√ßu Live</span></div>
        <div class="preview-content" id="preview"></div>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const canvas=document.getElementById('particles');const ctx=canvas.getContext('2d');let particles=[];let mouse={x:null,y:null};
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight}resize();
window.addEventListener('resize',resize);window.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY});window.addEventListener('mouseout',()=>{mouse.x=null;mouse.y=null});

class Particle{constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.vx=(Math.random()-0.5)*0.5;this.vy=(Math.random()-0.5)*0.5;this.size=Math.random()*2+0.5;this.color=Math.random()>0.5?'#b19cd9':'#00ff88';this.alpha=Math.random()*0.5+0.2}
update(){if(mouse.x!==null){const dx=mouse.x-this.x,dy=mouse.y-this.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist<120){const force=(120-dist)/120;this.vx-=(dx/dist)*force*0.8;this.vy-=(dy/dist)*force*0.8}}this.x+=this.vx;this.y+=this.vy;this.vx*=0.99;this.vy*=0.99;if(this.x<-50)this.x=canvas.width+50;if(this.x>canvas.width+50)this.x=-50;if(this.y<-50)this.y=canvas.height+50;if(this.y>canvas.height+50)this.y=-50}
draw(){ctx.save();ctx.globalAlpha=this.alpha;ctx.shadowBlur=15;ctx.shadowColor=this.color;ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();ctx.restore()}}

const count=Math.min(60,Math.floor((window.innerWidth*window.innerHeight)/20000));for(let i=0;i<count;i++)particles.push(new Particle());

function drawConnections(){for(let i=0;i<particles.length;i++){for(let j=i+1;j<particles.length;j++){const dx=particles[i].x-particles[j].x,dy=particles[i].y-particles[j].y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist<100){ctx.save();ctx.globalAlpha=(1-dist/100)*0.2;ctx.strokeStyle=particles[i].color;ctx.lineWidth=0.5;ctx.beginPath();ctx.moveTo(particles[i].x,particles[i].y);ctx.lineTo(particles[j].x,particles[j].y);ctx.stroke();ctx.restore()}}}}

function animateParticles(){ctx.clearRect(0,0,canvas.width,canvas.height);particles.forEach(p=>{p.update();p.draw()});drawConnections();requestAnimationFrame(animateParticles)}animateParticles();

const MARKDOWN_FOLDER='markdown/';
let files=[];let currentFile=null;let currentView='split';

// ========== LISTE DES FICHIERS √Ä PR√âCHARGER ==========
// Ajoute tes fichiers .md ici, ils seront charg√©s depuis ./markdown/
const markdownFiles = [
  'guide.md',
  'offre.md',
  'WARNING.md',
  'avertissement.md',
  'mission.md',
  'service.md',
  'man.md',
  'sauron.md',
  'postuler.md',
  'partenariat.md',
  'omg.md',
  'dossier_blanc.md',
  '5_verites.md',
  'plan-b.md'
];

mermaid.initialize({startOnLoad:true,theme:'dark',themeVariables:{primaryColor:'#b19cd9',primaryTextColor:'#e8eaf0',primaryBorderColor:'#b19cd9',lineColor:'#8b5cf6',secondaryColor:'#d4c4ff',tertiaryColor:'#0c0e1c'}});
marked.setOptions({highlight:function(code,lang){if(lang&&hljs.getLanguage(lang)){try{return hljs.highlight(code,{language:lang}).value}catch(err){}}return hljs.highlightAuto(code).value},breaks:true,gfm:true});

const editor=document.getElementById('editor');const preview=document.getElementById('preview');const fileInput=document.getElementById('fileInput');const uploadArea=document.getElementById('uploadArea');const fileTree=document.getElementById('fileTree');const filenameInput=document.getElementById('filenameInput');const editorContainer=document.getElementById('editorContainer');

// ========== CHARGEMENT DES FICHIERS DEPUIS LE DOSSIER ==========
async function loadFolder(){
  fileTree.innerHTML='<div style="padding:1rem;text-align:center;color:var(--lilac)">üîÑ Chargement...</div>';
  const loadedFiles=[];
  
  for(const filename of markdownFiles){
    try{
      const response=await fetch(MARKDOWN_FOLDER+filename);
      if(response.ok){
        const content=await response.text();
        loadedFiles.push({name:filename,content:content,path:MARKDOWN_FOLDER+filename,fromFolder:true,modified:false});
      }
    }catch(error){console.log(`Fichier ${filename} non trouv√©`)}
  }
  
  files=loadedFiles;
  
  if(files.length===0){
    // Aucun fichier trouv√©, on met un fichier par d√©faut
    const defaultContent=`# Bienvenue dans Recrue-Zone

Ceci est un **√©diteur Markdown** avec pr√©visualisation en temps r√©el.

## Fonctionnalit√©s
- ‚ú® Pr√©visualisation live
- üìÅ Gestion de fichiers
- üé® Coloration syntaxique
- üìä Diagrammes Mermaid
- üíæ Export MD/HTML

## Configuration

Pour pr√©charger tes fichiers:
1. Cr√©e un dossier \`markdown/\` √† c√¥t√© de ce fichier HTML
2. Mets tes fichiers \`.md\` dedans
3. Liste-les dans le tableau \`markdownFiles\` dans le code

\`\`\`javascript
const markdownFiles = [
  'mon-fichier.md',
  'autre-fichier.md',
  // ...
];
\`\`\`

## Code exemple
\`\`\`javascript
const hello = "Bienvenue !";
console.log(hello);
\`\`\`

> La vraie libert√© de pens√©e ne r√©side pas dans l'absence d'influence, mais dans la capacit√© √† naviguer consciemment entre elles.

---
*Cr√©ez votre dossier markdown/ pour commencer...*`;
    
    files=[{name:'bienvenue.md',content:defaultContent,fromFolder:false,modified:false}];
    fileTree.innerHTML='<div style="padding:1rem;text-align:center;color:var(--text-dim);font-size:0.8rem">üìÇ Aucun fichier dans ./markdown/<br><br>Cr√©ez le dossier et listez vos fichiers</div>';
  }
  
  updateFileTree();
  if(files.length>0){
    openFile(0);
    showToast(`‚úÖ ${files.length} fichier(s) charg√©(s)`);
  }
}

// Lancer le chargement au d√©marrage
loadFolder();

function updateFileTree(){if(files.length===0){fileTree.innerHTML='<div style="padding:1rem;text-align:center;color:var(--text-dim);font-size:0.8rem">Aucun fichier</div>';return}fileTree.innerHTML=files.map((file,index)=>`<div class="file-item ${currentFile&&currentFile.name===file.name?'active':''}" onclick="openFile(${index})"><span class="file-icon">${file.fromFolder?'üìÑ':'üìù'}</span><div class="file-name">${file.name}</div></div>`).join('')}

function openFile(index){currentFile=files[index];editor.value=currentFile.content;filenameInput.value=currentFile.name;updatePreview();updateStats();updateFileTree()}
function refreshFolder(){showToast('üîÑ Rechargement...');loadFolder()}

editor.addEventListener('input',()=>{updatePreview();updateStats();if(currentFile){currentFile.content=editor.value;currentFile.modified=true}});

function updatePreview(){let html=marked.parse(editor.value);html=html.replace(/<pre><code class="language-mermaid">([\s\S]*?)<\/code><\/pre>/g,'<div class="mermaid">$1</div>');preview.innerHTML=html;mermaid.run({querySelector:'.mermaid'})}

function updateStats(){const text=editor.value;document.getElementById('charCount').textContent=text.length;document.getElementById('wordCount').textContent=text.trim()?text.trim().split(/\s+/).length:0;document.getElementById('lineCount').textContent=text.split('\n').length}

['dragenter','dragover','dragleave','drop'].forEach(e=>uploadArea.addEventListener(e,ev=>{ev.preventDefault();ev.stopPropagation()}));['dragenter','dragover'].forEach(e=>uploadArea.addEventListener(e,()=>uploadArea.classList.add('drag-over')));['dragleave','drop'].forEach(e=>uploadArea.addEventListener(e,()=>uploadArea.classList.remove('drag-over')));uploadArea.addEventListener('drop',e=>handleFiles(Array.from(e.dataTransfer.files)));fileInput.addEventListener('change',e=>{handleFiles(Array.from(e.target.files));fileInput.value=''});

function handleFiles(fileArray){fileArray.forEach(file=>{if(file.name.endsWith('.md')||file.name.endsWith('.markdown')){loadUploadedFile(file)}else{showToast(`‚ùå "${file.name}" n'est pas un fichier Markdown`)}})}

function loadUploadedFile(file){const reader=new FileReader();reader.onload=e=>{const fileData={name:file.name,content:e.target.result,fromFolder:false,modified:false};const existingIndex=files.findIndex(f=>f.name===file.name);if(existingIndex!==-1){files[existingIndex]=fileData;showToast(`üìù "${file.name}" mis √† jour`)}else{files.push(fileData);showToast(`‚úÖ "${file.name}" charg√©`)}updateFileTree();openFile(existingIndex!==-1?existingIndex:files.length-1)};reader.readAsText(file)}

function newFile(){const fileName=`nouveau-${Date.now()}.md`;files.push({name:fileName,content:'# Nouveau document\n\nCommencez √† √©crire ici...',fromFolder:false,modified:true});updateFileTree();openFile(files.length-1);showToast('üìÑ Nouveau fichier cr√©√©')}

function saveToFolder(){if(!currentFile){showToast('‚ùå Aucun fichier');return}const content=editor.value;const filename=filenameInput.value||currentFile.name;currentFile.content=content;currentFile.name=filename;currentFile.modified=false;const blob=new Blob([content],{type:'text/markdown'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);updateFileTree();showToast(`üíæ "${filename}" sauvegard√©`)}

function exportMd(){const content=editor.value;const filename=filenameInput.value||currentFile?.name||'document.md';if(!content.trim()){showToast('‚ùå Aucun contenu');return}const blob=new Blob([content],{type:'text/markdown'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);showToast(`üì• "${filename}" export√©`)}

function exportHtml(){const content=editor.value;const filename=(filenameInput.value||currentFile?.name||'document.md').replace('.md','.html');if(!content.trim()){showToast('‚ùå Aucun contenu');return}const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${filename}</title><style>body{font-family:system-ui;max-width:800px;margin:2rem auto;padding:0 2rem;background:#0a0b15;color:#e8eaf0}h1,h2,h3{color:#b19cd9}code{background:#1a1b26;padding:0.2rem 0.4rem;border-radius:3px;color:#00ff88}pre{background:#1a1b26;padding:1rem;border-radius:8px;border:2px solid #00ff88}a{color:#00f0ff}</style></head><body>${preview.innerHTML}</body></html>`;const blob=new Blob([html],{type:'text/html'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);showToast(`üåê "${filename}" export√©`)}

function setView(view){currentView=view;document.getElementById('viewSplit').classList.remove('active');document.getElementById('viewEditor').classList.remove('active');document.getElementById('viewPreview').classList.remove('active');editorContainer.classList.remove('editor-only','preview-only');if(view==='split'){document.getElementById('viewSplit').classList.add('active')}else if(view==='editor'){document.getElementById('viewEditor').classList.add('active');editorContainer.classList.add('editor-only');document.getElementById('previewPanel').style.display='none'}else if(view==='preview'){document.getElementById('viewPreview').classList.add('active');editorContainer.classList.add('preview-only');document.getElementById('editorPanel').style.display='none'}if(view!=='preview')document.getElementById('editorPanel').style.display='flex';if(view!=='editor')document.getElementById('previewPanel').style.display='flex'}

function insertText(before,after=''){const start=editor.selectionStart,end=editor.selectionEnd;const text=editor.value,selectedText=text.substring(start,end);editor.value=text.substring(0,start)+before+selectedText+after+text.substring(end);editor.setSelectionRange(start+before.length+selectedText.length,start+before.length+selectedText.length);editor.focus();updatePreview();updateStats();if(currentFile){currentFile.content=editor.value;currentFile.modified=true}}

function showToast(message){const toast=document.getElementById('toast');toast.textContent=message;toast.classList.add('active');setTimeout(()=>toast.classList.remove('active'),3000)}

document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='s'){e.preventDefault();saveToFolder()}if((e.ctrlKey||e.metaKey)&&e.key==='n'){e.preventDefault();newFile()}if((e.ctrlKey||e.metaKey)&&e.key==='e'){e.preventDefault();exportMd()}if((e.ctrlKey||e.metaKey)&&e.key==='b'){e.preventDefault();insertText('**','**')}if((e.ctrlKey||e.metaKey)&&e.key==='i'){e.preventDefault();insertText('*','*')}if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();insertText('[','](url)')}});
</script>
</body>
</html>
