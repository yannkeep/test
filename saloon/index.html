


<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://ouaisfieu.github.io/mSazGF995S2YA86ldttDuiEE3cDH48NgLLB1tpb6-8i5qtMrRaqZ4ZctSJEppEzYHC1U2NJewhxuZqzdKGfNZNw-Fc3kc5RkKJ6cf0_S-aqMjDo5SMXg2EZHHjMGsSsLB3sK3k9a4ub4rLT0tdr0Z_6wWwM77xNLQacLkQ7pYYQ01oFClw6zvp48uhhKhyx1pIxs4ShnCJiUVo0ZLuRKBw3Zo4Br0hh5mRgz6U4SCBFtrYG0G_xC-b1dsKNxel0Pjl1P2-ddEx715Fm6cLN7rozltOCkCzP6GZ4BKm4E0RIfIq85nNjVrb7jUNNmtiy9RpJ1pGAoFhiOtJRg4yQhMSKoPg4X--pGU1DQcS4v_e83DcxxPODsxgEdMR6dG--W-xj__qvJatXTiURr31SsZp5ICKhr6Fz6uuMygISsskd4ypcDdU9A4b2d8__7hv28031Wm_J6pah2E2N6PrUD8x0zsZly526NCo3mQHKgDsfZKrZNO_chEi87c0EaP-Mag5nKhgif3_1X_dxSj1_f-ONtKPZxwaOEaTgyo6zo7CC-klB-S2FWVnPHRaRzoKew8NpCkYxpcZ94'></script><script type='text/javascript' src='https://ouaisfieu.github.io/K7cVeqBshqIe7Oc5JiXT6AOkgbzxpso3ukAClTE6Ak8rFwu18xYJ2s1CB62CI_w8GEK2xeaF6U3zkxFTpkFuI9TTMdyRFKjbqjEzONJPxOW_efsRALD1Mrxy-r4YfmupDJy0FLHknM9bT0MgS0uZuB20M2-k9wpFY8GddQu2UgC5HWWCpWAcYBajoDznEi1TIKDE6ylBxR8Ckd2elIE9T5_tSp_N6B_XDaVEIh29MUOEWa3_giQgtMiNmSJ6U9SSL0jLBUH1l873LEIfT2a7pMYn8ny-13ho0z1ke9urkBVr40gqDv0ShG-AwFErE9GHOMIhaDtRyXIVUYh_x-wjUCowsYjknNiMfE3KGg9gS0dVO8DsgLuLHNK8_QT5ylj1ogWoraxTjdlVWKhkFEQ7uqZiXg0ADKls2j7vE-OqITaIWHp97jFWjEK7pikE-Je11sg4N9jFEPim_-NUAaM7433BpzZMkZkg70hnMoDrBEtmP3orjqSIsYYQ'></script><script type='text/javascript' src='https://ouaisfieu.github.io/XrNZ28tFp0Gxg4PnDDvVxPBfeFZziYPko_hVlNapN70_Pjnh0nJKPqWM_q2SnjCFN2ls48xXS98GniWIBfqgEoYr62lFnVLFZneGPYPDUuCX4ja-IymtlBJSQBP3G-ztM1ypCHN7fa8tARL-0-7XLrpTt4faUg1zLJEmJ5r7vosMQa7PTwkyz5iV6AvAJP-fRuqxTSbTP6QpjcejYzOvhmIh2G9Z7xgkIRM8tkut4q33x6pDC1Gv_jpCNwn--EphQgdjCbUQ_VgUc_Oan-ChestufYcd0-LOr45OkMuqf9bTEI52mfcjthOacI4x6SpdXVCDP74FWRMQlbSpDmIRflCWZkTe0PqJMkM5Esgv7pUxvyf-KViCf7XNr7H3x9d1qJWZmNHqsCPJ79As1gT_btfLWJTrekl2M1QhBtmJtSANJw_LEys93Jz1vqb7Veeq7MNl8V7zrWl2l_iXddwEDYzYksqSVRLKrl-p_fRPiwFYYB9y4fqE'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÆ NEXUS :: Station de Travail ECP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap');

        :root {
            --matrix-green: #00ff41;
            --matrix-dark-green: #008f11;
            --matrix-light-green: #39ff14;
            --matrix-bg: #0d0208;
            --matrix-bg-light: #1a1a2e;
            --matrix-glow: 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 30px #00ff41;
            --accent-cyan: #00d4ff;
            --accent-magenta: #ff00ff;
            --accent-orange: #ff6600;
            --accent-yellow: #ffff00;
            --danger: #ff0040;
            --success: #00ff88;
            --panel-bg: rgba(0, 20, 10, 0.85);
            --glass: rgba(0, 255, 65, 0.05);
            --border-glow: rgba(0, 255, 65, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--matrix-bg);
            color: var(--matrix-green);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Matrix Rain Effect */
        #matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.15;
        }

        /* Scanlines */
        .scanlines::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 9999;
        }

        /* Main Layout */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 60px 1fr;
            min-height: 100vh;
            gap: 2px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(180deg, var(--panel-bg) 0%, rgba(0,10,5,0.95) 100%);
            border-bottom: 1px solid var(--border-glow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            text-shadow: var(--matrix-glow);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border: 2px solid var(--matrix-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px var(--matrix-green); }
            50% { box-shadow: 0 0 20px var(--matrix-green), 0 0 30px var(--matrix-dark-green); }
        }

        .header-stats {
            display: flex;
            gap: 30px;
            font-size: 0.85rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px var(--accent-cyan);
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            background: transparent;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 8px 16px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,65,0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: rgba(0, 255, 65, 0.1);
            box-shadow: var(--matrix-glow);
            transform: translateY(-2px);
        }

        .btn-primary {
            background: rgba(0, 255, 65, 0.2);
        }

        .btn-danger {
            border-color: var(--danger);
            color: var(--danger);
        }

        .btn-danger:hover {
            background: rgba(255, 0, 64, 0.2);
            box-shadow: 0 0 20px var(--danger);
        }

        .btn-cyan {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .btn-cyan:hover {
            background: rgba(0, 212, 255, 0.2);
            box-shadow: 0 0 20px var(--accent-cyan);
        }

        /* Left Sidebar - Profile & Tools */
        .sidebar-left {
            background: var(--panel-bg);
            border-right: 1px solid var(--border-glow);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Profile Card */
        .profile-card {
            background: linear-gradient(135deg, rgba(0,40,20,0.8) 0%, rgba(0,20,10,0.9) 100%);
            border: 1px solid var(--border-glow);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .avatar-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            position: relative;
        }

        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid var(--matrix-green);
            background: var(--matrix-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .avatar:hover {
            transform: scale(1.1);
            box-shadow: var(--matrix-glow);
        }

        .level-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: var(--accent-cyan);
            color: var(--matrix-bg);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .profile-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .profile-title {
            font-size: 0.75rem;
            color: var(--accent-cyan);
            margin-bottom: 10px;
        }

        .xp-bar {
            background: rgba(0,0,0,0.5);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--matrix-dark-green), var(--matrix-green));
            width: 65%;
            transition: width 0.5s;
        }

        .xp-text {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        /* Tool Panels */
        .tool-panel {
            background: rgba(0,20,10,0.6);
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            overflow: hidden;
        }

        .panel-header {
            background: rgba(0,255,65,0.1);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-glow);
            cursor: pointer;
        }

        .panel-title {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-content {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .panel-content.collapsed {
            display: none;
        }

        /* Timer */
        .timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            text-align: center;
            margin: 10px 0;
            text-shadow: 0 0 20px var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .timer-controls {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .timer-controls .btn {
            padding: 5px 12px;
            font-size: 0.8rem;
        }

        /* Notes */
        .notes-textarea {
            width: 100%;
            height: 100px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--border-glow);
            color: var(--matrix-green);
            padding: 10px;
            font-family: inherit;
            font-size: 0.8rem;
            resize: vertical;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--matrix-green);
            box-shadow: 0 0 10px rgba(0,255,65,0.3);
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .quick-stat {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .quick-stat-value {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .quick-stat-label {
            font-size: 0.65rem;
            opacity: 0.7;
        }

        /* Main Content */
        .main-content {
            background: rgba(0,10,5,0.7);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Toolbar */
        .toolbar {
            background: rgba(0,20,10,0.9);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--border-glow);
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--border-glow);
            color: var(--matrix-green);
            padding: 10px 15px 10px 40px;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--matrix-green);
            box-shadow: 0 0 15px rgba(0,255,65,0.3);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.7;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
        }

        .view-btn {
            padding: 8px 12px;
            background: transparent;
            border: 1px solid var(--border-glow);
            color: var(--matrix-green);
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn.active {
            background: rgba(0,255,65,0.2);
            border-color: var(--matrix-green);
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border-glow);
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 500;
        }

        .tab:hover {
            background: rgba(0,255,65,0.1);
        }

        .tab.active {
            border-bottom-color: var(--matrix-green);
            background: rgba(0,255,65,0.1);
            text-shadow: 0 0 10px var(--matrix-green);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
        }

        .flashcard {
            background: linear-gradient(135deg, rgba(0,30,15,0.9) 0%, rgba(0,15,8,0.95) 100%);
            border: 1px solid var(--border-glow);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }

        .flashcard:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,255,65,0.2);
            border-color: var(--matrix-green);
        }

        .flashcard.favorite {
            border-color: var(--accent-orange);
        }

        .flashcard.mastered {
            border-color: var(--success);
        }

        .card-header {
            background: rgba(0,255,65,0.1);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-glow);
        }

        .card-id {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            color: var(--accent-cyan);
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-action {
            background: transparent;
            border: none;
            color: var(--matrix-green);
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .card-action:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .card-action.favorited {
            color: var(--accent-orange);
            opacity: 1;
        }

        .card-action.mastered-btn.active {
            color: var(--success);
            opacity: 1;
        }

        .card-question {
            padding: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            min-height: 80px;
        }

        .card-answer {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            font-size: 0.85rem;
            color: var(--accent-cyan);
            line-height: 1.5;
            border-top: 1px dashed var(--border-glow);
            display: none;
        }

        .card-answer.visible {
            display: block;
        }

        .card-tags {
            padding: 10px 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .tag {
            background: rgba(0,255,65,0.15);
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag:hover {
            background: rgba(0,255,65,0.3);
        }

        /* Table View */
        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-glow);
        }

        .data-table th {
            background: rgba(0,255,65,0.1);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
        }

        .data-table th:hover {
            background: rgba(0,255,65,0.2);
        }

        .data-table tr:hover {
            background: rgba(0,255,65,0.05);
        }

        /* Detective Mode */
        .detective-panel {
            display: none;
        }

        .detective-panel.active {
            display: block;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .analysis-card {
            background: rgba(0,20,10,0.8);
            border: 1px solid var(--border-glow);
            border-radius: 10px;
            padding: 20px;
        }

        .analysis-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--accent-cyan);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .word-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .word-item {
            padding: 5px 12px;
            background: rgba(0,255,65,0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .word-item:hover {
            background: rgba(0,255,65,0.3);
            transform: scale(1.1);
        }

        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 5px;
            padding: 10px 0;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--matrix-green) 0%, var(--matrix-dark-green) 100%);
            border-radius: 3px 3px 0 0;
            min-height: 10px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .chart-bar:hover {
            background: var(--accent-cyan);
        }

        .chart-bar .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--matrix-bg);
            border: 1px solid var(--matrix-green);
            padding: 5px 10px;
            font-size: 0.7rem;
            white-space: nowrap;
            display: none;
            z-index: 100;
        }

        .chart-bar:hover .tooltip {
            display: block;
        }

        .timeline-item {
            padding: 10px 15px;
            border-left: 2px solid var(--matrix-green);
            margin-left: 10px;
            margin-bottom: 10px;
            position: relative;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 15px;
            width: 10px;
            height: 10px;
            background: var(--matrix-green);
            border-radius: 50%;
        }

        .timeline-year {
            color: var(--accent-cyan);
            font-weight: bold;
        }

        /* Quiz Mode */
        .quiz-panel {
            display: none;
        }

        .quiz-panel.active {
            display: block;
        }

        .quiz-card {
            max-width: 700px;
            margin: 0 auto;
            background: linear-gradient(135deg, rgba(0,40,20,0.9) 0%, rgba(0,20,10,0.95) 100%);
            border: 2px solid var(--matrix-green);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
        }

        .quiz-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.85rem;
        }

        .quiz-question {
            font-size: 1.3rem;
            line-height: 1.6;
            margin: 30px 0;
        }

        .quiz-answer-box {
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--border-glow);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 80px;
            display: none;
            color: var(--accent-cyan);
            font-size: 1.1rem;
        }

        .quiz-answer-box.visible {
            display: block;
        }

        .quiz-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .quiz-score {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .score-value.correct {
            color: var(--success);
        }

        .score-value.incorrect {
            color: var(--danger);
        }

        /* Editor Mode */
        .editor-panel {
            display: none;
        }

        .editor-panel.active {
            display: block;
        }

        .editor-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--border-glow);
            color: var(--matrix-green);
            padding: 12px 15px;
            font-family: inherit;
            font-size: 0.95rem;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--matrix-green);
            box-shadow: 0 0 15px rgba(0,255,65,0.3);
        }

        /* Right Sidebar */
        .sidebar-right {
            background: var(--panel-bg);
            border-left: 1px solid var(--border-glow);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Activity Log */
        .activity-log {
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,255,65,0.1);
            font-size: 0.8rem;
        }

        .log-time {
            color: var(--accent-cyan);
            font-size: 0.7rem;
        }

        /* Keyboard Shortcuts */
        .shortcuts-list {
            font-size: 0.8rem;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(0,255,65,0.1);
        }

        .shortcut-key {
            background: rgba(0,255,65,0.2);
            padding: 2px 8px;
            border-radius: 3px;
            font-family: 'Share Tech Mono', monospace;
        }

        /* Filter Tags */
        .filter-section {
            margin-bottom: 15px;
        }

        .filter-title {
            font-size: 0.8rem;
            margin-bottom: 10px;
            opacity: 0.7;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .filter-tag {
            background: rgba(0,255,65,0.1);
            border: 1px solid var(--border-glow);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-tag:hover,
        .filter-tag.active {
            background: rgba(0,255,65,0.3);
            border-color: var(--matrix-green);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--panel-bg);
            border: 1px solid var(--matrix-green);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--matrix-green);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Settings */
        .settings-group {
            margin-bottom: 20px;
        }

        .settings-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .toggle-switch {
            width: 50px;
            height: 26px;
            background: rgba(0,0,0,0.5);
            border-radius: 13px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--matrix-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: var(--matrix-bg);
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active::after {
            left: 27px;
        }

        .color-picker-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover,
        .color-option.active {
            border-color: white;
            transform: scale(1.2);
        }

        /* Connections Graph */
        .connections-container {
            height: 250px;
            position: relative;
            overflow: hidden;
        }

        /* Category Legend */
        .category-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .legend-item:hover {
            background: rgba(0,255,65,0.1);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-count {
            margin-left: auto;
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar-left,
            .sidebar-right {
                display: none;
            }

            .sidebar-left.mobile-open,
            .sidebar-right.mobile-open {
                display: flex;
                position: fixed;
                top: 60px;
                bottom: 0;
                width: 300px;
                z-index: 100;
            }

            .sidebar-left.mobile-open {
                left: 0;
            }

            .sidebar-right.mobile-open {
                right: 0;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--matrix-dark-green);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--matrix-green);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .flashcard {
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }

        .glitch:hover {
            animation: glitch 0.3s ease;
        }

        /* Import drop zone */
        .drop-zone {
            border: 2px dashed var(--border-glow);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .drop-zone.dragover {
            border-color: var(--matrix-green);
            background: rgba(0,255,65,0.1);
        }

        /* Highlights */
        .highlight {
            background: rgba(255,255,0,0.2);
            padding: 0 3px;
        }

        /* Matrix rain intense for loading */
        .loading {
            position: relative;
        }

        .loading::after {
            content: 'CHARGEMENT...';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Orbitron', sans-serif;
            animation: pulse-glow 1s infinite;
        }
    </style>
</head>
<body class="scanlines">
    <canvas id="matrix-rain"></canvas>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">‚óà</div>
                <span>NEXUS</span>
                <span style="font-size: 0.7rem; opacity: 0.7;">ECP WORKSTATION</span>
            </div>

            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" id="total-cards">82</span>
                    <span class="stat-label">Cartes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="mastered-count">0</span>
                    <span class="stat-label">Ma√Ætris√©es</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="favorites-count">0</span>
                    <span class="stat-label">Favoris</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="session-time">00:00</span>
                    <span class="stat-label">Session</span>
                </div>
            </div>

            <div class="header-actions">
                <button class="btn" onclick="toggleMobilePanel('left')">‚ò∞</button>
                <button class="btn btn-cyan" onclick="openModal('import')">üì• Import</button>
                <button class="btn" onclick="exportData()">üì§ Export</button>
                <button class="btn" onclick="openModal('settings')">‚öôÔ∏è</button>
                <button class="btn" onclick="toggleMobilePanel('right')">üìä</button>
            </div>
        </header>

        <!-- Left Sidebar -->
        <aside class="sidebar-left" id="sidebar-left">
            <!-- Profile Card -->
            <div class="profile-card">
                <div class="avatar-container">
                    <div class="avatar" id="user-avatar" onclick="openModal('profile')">üïµÔ∏è</div>
                    <span class="level-badge">Nv. <span id="user-level">1</span></span>
                </div>
                <div class="profile-name" id="user-name" contenteditable="true">Agent_Inconnu</div>
                <div class="profile-title" id="user-title">D√©tective ECP</div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill"></div>
                </div>
                <div class="xp-text"><span id="user-xp">0</span> / <span id="xp-needed">100</span> XP</div>
            </div>

            <!-- Timer -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">‚è±Ô∏è CHRONOM√àTRE</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content">
                    <div class="timer-display" id="pomodoro-time">25:00</div>
                    <div class="timer-controls">
                        <button class="btn" onclick="startTimer()">‚ñ∂</button>
                        <button class="btn" onclick="pauseTimer()">‚è∏</button>
                        <button class="btn" onclick="resetTimer()">‚Ü∫</button>
                    </div>
                    <div style="margin-top: 10px; text-align: center; font-size: 0.8rem;">
                        <button class="btn" onclick="setTimer(25)" style="padding: 3px 8px;">25min</button>
                        <button class="btn" onclick="setTimer(15)" style="padding: 3px 8px;">15min</button>
                        <button class="btn" onclick="setTimer(5)" style="padding: 3px 8px;">5min</button>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üìä STATS RAPIDES</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content">
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color: var(--accent-cyan);" id="stat-ecp">45</div>
                            <div class="quick-stat-label">ECP</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color: var(--accent-orange);" id="stat-arizona">25</div>
                            <div class="quick-stat-label">Arizona</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color: var(--accent-magenta);" id="stat-fiscal">15</div>
                            <div class="quick-stat-label">Fiscal</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color: var(--success);" id="stat-tech">12</div>
                            <div class="quick-stat-label">Tech</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üìù NOTES</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content">
                    <textarea class="notes-textarea" id="user-notes" placeholder="Prenez vos notes ici..."></textarea>
                    <button class="btn" style="margin-top: 10px; width: 100%;" onclick="saveNotes()">üíæ Sauvegarder</button>
                </div>
            </div>

            <!-- Raccourcis -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">‚å®Ô∏è RACCOURCIS</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content collapsed">
                    <div class="shortcuts-list">
                        <div class="shortcut-item"><span>Recherche</span><span class="shortcut-key">Ctrl+F</span></div>
                        <div class="shortcut-item"><span>Quiz mode</span><span class="shortcut-key">Q</span></div>
                        <div class="shortcut-item"><span>D√©tective</span><span class="shortcut-key">D</span></div>
                        <div class="shortcut-item"><span>Nouvelle carte</span><span class="shortcut-key">N</span></div>
                        <div class="shortcut-item"><span>Export</span><span class="shortcut-key">Ctrl+E</span></div>
                        <div class="shortcut-item"><span>R√©ponse quiz</span><span class="shortcut-key">Space</span></div>
                        <div class="shortcut-item"><span>Carte suivante</span><span class="shortcut-key">‚Üí</span></div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="search-input" placeholder="Rechercher dans les cartes... (mots-cl√©s, montants, dates...)">
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid" onclick="setView('grid')">‚äû</button>
                    <button class="view-btn" data-view="table" onclick="setView('table')">‚ò∞</button>
                    <button class="view-btn" data-view="compact" onclick="setView('compact')">‚ñ§</button>
                </div>
                <select id="sort-select" class="search-input" style="width: auto; padding: 8px 15px;">
                    <option value="id">Tri: ID</option>
                    <option value="alpha">Tri: A-Z</option>
                    <option value="length">Tri: Longueur</option>
                    <option value="random">Tri: Al√©atoire</option>
                </select>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="cards" onclick="switchTab('cards')">üìö CARTES</div>
                <div class="tab" data-tab="detective" onclick="switchTab('detective')">üîç D√âTECTIVE</div>
                <div class="tab" data-tab="quiz" onclick="switchTab('quiz')">üéØ QUIZ</div>
                <div class="tab" data-tab="editor" onclick="switchTab('editor')">‚úèÔ∏è √âDITEUR</div>
                <div class="tab" data-tab="connections" onclick="switchTab('connections')">üï∏Ô∏è CONNEXIONS</div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Cards Panel -->
                <div class="cards-panel" id="cards-panel">
                    <div class="cards-grid" id="cards-container"></div>
                </div>

                <!-- Detective Panel -->
                <div class="detective-panel" id="detective-panel">
                    <div class="analysis-grid">
                        <!-- Word Cloud -->
                        <div class="analysis-card">
                            <div class="analysis-title">‚òÅÔ∏è NUAGE DE MOTS-CL√âS</div>
                            <div class="word-cloud" id="word-cloud"></div>
                        </div>

                        <!-- Numbers Analysis -->
                        <div class="analysis-card">
                            <div class="analysis-title">üî¢ CHIFFRES CL√âS EXTRAITS</div>
                            <div id="numbers-list" style="max-height: 200px; overflow-y: auto;"></div>
                        </div>

                        <!-- Timeline -->
                        <div class="analysis-card">
                            <div class="analysis-title">üìÖ CHRONOLOGIE</div>
                            <div id="timeline" style="max-height: 250px; overflow-y: auto;"></div>
                        </div>

                        <!-- Entities -->
                        <div class="analysis-card">
                            <div class="analysis-title">üèõÔ∏è ENTIT√âS D√âTECT√âES</div>
                            <div id="entities-list"></div>
                        </div>

                        <!-- Category Distribution -->
                        <div class="analysis-card">
                            <div class="analysis-title">üìä DISTRIBUTION PAR TH√àME</div>
                            <div class="chart-container" id="category-chart"></div>
                        </div>

                        <!-- Question Types -->
                        <div class="analysis-card">
                            <div class="analysis-title">‚ùì TYPES DE QUESTIONS</div>
                            <div id="question-types"></div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Panel -->
                <div class="quiz-panel" id="quiz-panel">
                    <div class="quiz-card">
                        <div class="quiz-progress">
                            <span>Carte <span id="quiz-current">1</span> / <span id="quiz-total">82</span></span>
                            <span id="quiz-category">-</span>
                        </div>
                        <div class="quiz-question" id="quiz-question">Chargement...</div>
                        <div class="quiz-answer-box" id="quiz-answer"></div>
                        <div class="quiz-controls">
                            <button class="btn" onclick="quizPrev()">‚óÑ Pr√©c√©dent</button>
                            <button class="btn btn-primary" onclick="quizReveal()">üëÅÔ∏è R√©v√©ler</button>
                            <button class="btn btn-cyan" onclick="quizNext()">Suivant ‚ñ∫</button>
                        </div>
                        <div class="quiz-controls" style="margin-top: 10px;">
                            <button class="btn btn-danger" onclick="quizMark(false)">‚úó Je ne savais pas</button>
                            <button class="btn" style="border-color: var(--success); color: var(--success);" onclick="quizMark(true)">‚úì Je savais</button>
                        </div>
                        <div class="quiz-score">
                            <div class="score-item">
                                <div class="score-value correct" id="quiz-correct">0</div>
                                <div class="score-label">Correctes</div>
                            </div>
                            <div class="score-item">
                                <div class="score-value incorrect" id="quiz-incorrect">0</div>
                                <div class="score-label">√Ä revoir</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="shuffleQuiz()">üîÄ M√©langer</button>
                            <button class="btn" onclick="resetQuiz()">‚Ü∫ Recommencer</button>
                            <button class="btn btn-cyan" onclick="quizFavoritesOnly()">‚≠ê Favoris seulement</button>
                        </div>
                    </div>
                </div>

                <!-- Editor Panel -->
                <div class="editor-panel" id="editor-panel">
                    <div class="editor-form">
                        <h2 style="margin-bottom: 20px; font-family: 'Orbitron', sans-serif;">‚úèÔ∏è CR√âER / MODIFIER UNE CARTE</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Question</label>
                            <textarea class="form-textarea" id="editor-question" placeholder="Entrez votre question..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">R√©ponse</label>
                            <textarea class="form-textarea" id="editor-answer" placeholder="Entrez la r√©ponse..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tags (s√©par√©s par des virgules)</label>
                            <input type="text" class="form-input" id="editor-tags" placeholder="ecp, fiscal, 2025...">
                        </div>

                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="saveCard()" style="flex: 1;">üíæ Sauvegarder</button>
                            <button class="btn" onclick="clearEditor()" style="flex: 1;">üóëÔ∏è Effacer</button>
                        </div>

                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-glow);">
                            <h3 style="margin-bottom: 15px;">üìã √âdition en masse (CSV)</h3>
                            <textarea class="form-textarea" id="bulk-editor" style="min-height: 200px; font-size: 0.8rem;" placeholder="Format: Question,R√©ponse (une par ligne)"></textarea>
                            <button class="btn btn-cyan" style="margin-top: 10px;" onclick="bulkImport()">üì• Importer le CSV</button>
                        </div>
                    </div>
                </div>

                <!-- Connections Panel -->
                <div class="detective-panel" id="connections-panel">
                    <div class="analysis-grid">
                        <div class="analysis-card" style="grid-column: 1 / -1;">
                            <div class="analysis-title">üï∏Ô∏è CARTE DES CONNEXIONS</div>
                            <div class="connections-container">
                                <canvas id="connections-canvas"></canvas>
                            </div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-title">üîó CONCEPTS LI√âS</div>
                            <div id="related-concepts"></div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-title">üìà FR√âQUENCE DES TERMES</div>
                            <div id="term-frequency"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="sidebar-right" id="sidebar-right">
            <!-- Filters -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üè∑Ô∏è FILTRES</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content">
                    <div class="filter-section">
                        <div class="filter-title">STATUT</div>
                        <div class="filter-tags">
                            <span class="filter-tag" data-filter="all" onclick="filterByStatus('all')">Tous</span>
                            <span class="filter-tag" data-filter="favorites" onclick="filterByStatus('favorites')">‚≠ê Favoris</span>
                            <span class="filter-tag" data-filter="mastered" onclick="filterByStatus('mastered')">‚úì Ma√Ætris√©s</span>
                            <span class="filter-tag" data-filter="unmastered" onclick="filterByStatus('unmastered')">‚úó √Ä revoir</span>
                        </div>
                    </div>
                    <div class="filter-section">
                        <div class="filter-title">TH√àMES</div>
                        <div class="filter-tags" id="theme-filters"></div>
                    </div>
                </div>
            </div>

            <!-- Categories -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üìÅ CAT√âGORIES</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content">
                    <div class="category-legend" id="category-legend"></div>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üìú ACTIVIT√â</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content">
                    <div class="activity-log" id="activity-log"></div>
                </div>
            </div>

            <!-- Resources -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üîó RESSOURCES</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content collapsed">
                    <div style="font-size: 0.8rem;">
                        <a href="#" style="color: var(--accent-cyan); display: block; margin-bottom: 8px;">üìÑ Documentation ECP</a>
                        <a href="#" style="color: var(--accent-cyan); display: block; margin-bottom: 8px;">üèõÔ∏è Gouvernement Arizona</a>
                        <a href="#" style="color: var(--accent-cyan); display: block; margin-bottom: 8px;">üí∞ R√©formes fiscales 2025</a>
                        <a href="#" style="color: var(--accent-cyan); display: block; margin-bottom: 8px;">üîß Protocole Solid</a>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="tool-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-title">üì§ EXPORT</span>
                    <span>‚ñº</span>
                </div>
                <div class="panel-content collapsed">
                    <button class="btn" style="width: 100%; margin-bottom: 8px;" onclick="exportData('csv')">üìÑ Export CSV</button>
                    <button class="btn" style="width: 100%; margin-bottom: 8px;" onclick="exportData('json')">üìã Export JSON</button>
                    <button class="btn" style="width: 100%; margin-bottom: 8px;" onclick="exportData('anki')">üé¥ Export Anki</button>
                    <button class="btn" style="width: 100%;" onclick="exportData('pdf')">üìë Export PDF</button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modal-settings">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">‚öôÔ∏è PARAM√àTRES</span>
                <button class="modal-close" onclick="closeModal('settings')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <div class="settings-label">
                        <span>üåßÔ∏è Effet Matrix Rain</span>
                        <div class="toggle-switch active" id="toggle-rain" onclick="toggleSetting('rain')"></div>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-label">
                        <span>üì∫ Scanlines</span>
                        <div class="toggle-switch active" id="toggle-scanlines" onclick="toggleSetting('scanlines')"></div>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-label">
                        <span>üîä Sons</span>
                        <div class="toggle-switch" id="toggle-sounds" onclick="toggleSetting('sounds')"></div>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-label">
                        <span>üëÅÔ∏è Afficher r√©ponses par d√©faut</span>
                        <div class="toggle-switch" id="toggle-answers" onclick="toggleSetting('answers')"></div>
                    </div>
                </div>
                <div class="settings-group">
                    <span style="display: block; margin-bottom: 10px;">üé® Couleur d'accent</span>
                    <div class="color-picker-group">
                        <div class="color-option active" style="background: #00ff41;" onclick="setAccentColor('#00ff41')"></div>
                        <div class="color-option" style="background: #00d4ff;" onclick="setAccentColor('#00d4ff')"></div>
                        <div class="color-option" style="background: #ff00ff;" onclick="setAccentColor('#ff00ff')"></div>
                        <div class="color-option" style="background: #ff6600;" onclick="setAccentColor('#ff6600')"></div>
                        <div class="color-option" style="background: #ffff00;" onclick="setAccentColor('#ffff00')"></div>
                        <div class="color-option" style="background: #ff0040;" onclick="setAccentColor('#ff0040')"></div>
                    </div>
                </div>
                <div class="settings-group">
                    <span style="display: block; margin-bottom: 10px;">‚è±Ô∏è Dur√©e Pomodoro (min)</span>
                    <input type="range" id="pomodoro-duration" min="5" max="60" value="25" style="width: 100%;" onchange="updatePomodoroDuration()">
                    <span id="pomodoro-value">25 min</span>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-import">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üì• IMPORTER DES DONN√âES</span>
                <button class="modal-close" onclick="closeModal('import')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="drop-zone" id="drop-zone">
                    <p style="font-size: 1.2rem; margin-bottom: 10px;">üìÇ</p>
                    <p>Glissez-d√©posez votre fichier CSV ici</p>
                    <p style="font-size: 0.8rem; opacity: 0.7; margin-top: 10px;">ou</p>
                    <input type="file" id="file-input" accept=".csv,.json" style="display: none;">
                    <button class="btn btn-cyan" style="margin-top: 10px;" onclick="document.getElementById('file-input').click()">Parcourir</button>
                </div>
                <div style="margin-top: 15px; font-size: 0.85rem; opacity: 0.8;">
                    <p>Formats support√©s:</p>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>CSV: Question,R√©ponse</li>
                        <li>JSON: [{question, answer, tags}]</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-profile">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üë§ PROFIL AGENT</span>
                <button class="modal-close" onclick="closeModal('profile')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom de code</label>
                    <input type="text" class="form-input" id="profile-name-input" placeholder="Agent_X">
                </div>
                <div class="form-group">
                    <label class="form-label">Titre</label>
                    <select class="form-input" id="profile-title-select">
                        <option value="D√©tective ECP">D√©tective ECP</option>
                        <option value="Analyste Fiscal">Analyste Fiscal</option>
                        <option value="Expert Arizona">Expert Arizona</option>
                        <option value="Ma√Ætre des Donn√©es">Ma√Ætre des Donn√©es</option>
                        <option value="Archiviste Num√©rique">Archiviste Num√©rique</option>
                        <option value="Sentinelle NYXO">Sentinelle NYXO</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Avatar</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('üïµÔ∏è')">üïµÔ∏è</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('üë®‚Äçüíª')">üë®‚Äçüíª</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('üë©‚Äçüíª')">üë©‚Äçüíª</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('ü§ñ')">ü§ñ</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('üëΩ')">üëΩ</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('ü¶ä')">ü¶ä</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('üê±')">üê±</span>
                        <span class="avatar-choice" style="font-size: 2rem; cursor: pointer;" onclick="setAvatar('ü¶â')">ü¶â</span>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="saveProfile()">üíæ Sauvegarder</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-card-detail">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <span class="modal-title">üìÑ D√âTAIL CARTE #<span id="detail-card-id">1</span></span>
                <button class="modal-close" onclick="closeModal('card-detail')">√ó</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--accent-cyan); margin-bottom: 10px;">Question</h3>
                    <p id="detail-question" style="font-size: 1.1rem; line-height: 1.6;"></p>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--success); margin-bottom: 10px;">R√©ponse</h3>
                    <p id="detail-answer" style="font-size: 1rem; line-height: 1.6;"></p>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">Tags</h3>
                    <div id="detail-tags" class="card-tags" style="padding: 0;"></div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="editCardFromDetail()">‚úèÔ∏è Modifier</button>
                    <button class="btn btn-danger" onclick="deleteCardFromDetail()">üóëÔ∏è Supprimer</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============== DATA & STATE ==============
        let flashcards = [];
        let filteredCards = [];
        let currentView = 'grid';
        let currentTab = 'cards';
        let currentFilter = 'all';
        let quizIndex = 0;
        let quizCards = [];
        let quizCorrect = 0;
        let quizIncorrect = 0;
        let editingCardId = null;
        let sessionStartTime = Date.now();
        let timerInterval = null;
        let pomodoroTime = 25 * 60;
        let pomodoroRunning = false;

        // Settings
        let settings = {
            rain: true,
            scanlines: true,
            sounds: false,
            answers: false,
            accentColor: '#00ff41',
            pomodoroDuration: 25
        };

        // User profile
        let userProfile = {
            name: 'Agent_Inconnu',
            title: 'D√©tective ECP',
            avatar: 'üïµÔ∏è',
            level: 1,
            xp: 0,
            notes: ''
        };

        // Categories with colors
        const categories = {
            'ECP': { color: '#00d4ff', keywords: ['ecp', 'contributive', 'provisionn√©e', 'contributeur', 'citoyen', 'fonds', 'nyxo', 'solid', 'arc'] },
            'Arizona': { color: '#ff6600', keywords: ['arizona', 'gouvernement', 'coalition', 'bart de wever', 'n-va', 'mr', 'engag√©s', 'vooruit', 'cd&v'] },
            'Fiscal': { color: '#ff00ff', keywords: ['fiscal', 'taxe', 'imp√¥t', 'tva', 'pr√©compte', 'budget', 'ruling', 'sda'] },
            'Social': { color: '#ffff00', keywords: ['social', 'allocation', 'bim', 'cpas', 'ch√¥meur', 'pauvret√©', 'emploi'] },
            'Tech': { color: '#00ff88', keywords: ['solid', 'fhir', 'nyxo', 'git', 'eleventy', 'pod', 'd√©centralis√©'] },
            'Dates': { color: '#ff0040', keywords: ['2024', '2025', '2026', '2027', '2028', '2029', '2038'] }
        };

        // ============== INITIALIZATION ==============
        const rawData = `Qu'est-ce que l'√âconomie Contributive Provisionn√©e (ECP) ?,Un mod√®le √©conomique permettant de valoriser les comp√©tences des citoyens pr√©caires sans leur faire perdre leurs droits sociaux.
Quel est le but principal de l'ECP face au syst√®me social actuel ?,R√©pondre au ¬´ pi√®ge institutionnel ¬ª qui d√©courage l'activit√© des personnes pr√©caris√©es.
Le concept de l'ECP s'inscrit dans le contexte des r√©formes de quel gouvernement belge ?,Le gouvernement Arizona ($2025$-$2029$).
Quels sont les cinq partis qui forment la coalition Arizona ?,"La N-VA, le MR, Les Engag√©s, Vooruit et le CD&V."
Qui est le Premier ministre pressenti du gouvernement Arizona ?,Bart De Wever.
Quel est l'objectif de taux d'emploi du gouvernement Arizona pour $2029$ ?,$80\\%$.
Quel montant d'assainissement budg√©taire le gouvernement Arizona vise-t-il d'ici $2029$ ?,$18$ milliards d'euros.
Quel m√©canisme de l'ECP s√©pare l'acte de contribution de la perception imm√©diate du revenu ?,Le provisionnement diff√©r√©.
O√π est bloqu√©e la valeur mon√©taire des actions citoyennes dans le mod√®le ECP ?,Dans un Fonds de Contribution Citoyenne.
Pourquoi les sommes accumul√©es en ECP ne r√©duisent-elles pas les allocations sociales ?,Elles ne sont pas consid√©r√©es comme un revenu tant qu'elles ne sont pas encaiss√©es par le contributeur.
"Pour garantir la s√©curit√© juridique de l'ECP, quelle proc√©dure doit √™tre entam√©e aupr√®s du SPF Finances ?","Une demande de d√©cision anticip√©e, appel√©e ¬´ ruling fiscal ¬ª."
Quel organisme belge est comp√©tent pour d√©livrer un ruling fiscal ?,Le Service des D√©cisions Anticip√©es (SDA).
Quelle est la dur√©e minimale de validit√© d'une d√©cision du SDA (ruling fiscal) ?,$5$ ans.
Sur quelle loi de $2005$ l'ECP s'appuie-t-elle pour garantir l'absence de lien de subordination ?,La loi du $3$ juillet $2005$ relative aux droits des volontaires.
Quel est le co√ªt d'une proc√©dure de ruling aupr√®s du SDA ?,La proc√©dure est gratuite et confidentielle.
Combien de personnes sont estim√©es en situation d'inactivit√© contrainte en Belgique selon l'ECP ?,"Pr√®s de $978\\,000$ personnes."
Quel est le co√ªt annuel estim√© de l'inactivit√© pour l'√âtat belge ?,Entre $21$ et $24$ milliards d'euros.
Comment l'ECP appelle-t-elle le fait que le syst√®me actuel p√©nalise financi√®rement l'initiative ?,Le pi√®ge institutionnel.
Quel est le nom du projet pilote de l'ECP ax√© sur la sant√© mentale ?,L'Agence de Renseignement Citoyenne (ARC).
Quel est le budget n√©cessaire pour lancer le projet pilote ARC ?,"$24\\,000$ euros."
Que signifie l'acronyme BIM dans le syst√®me de sant√© belge ?,B√©n√©ficiaire de l'Intervention Major√©e.
Quel est l'avantage principal du statut BIM pour les soins de sant√© ?,Un remboursement plus important des frais m√©dicaux et le tiers payant social obligatoire.
Comment l'ECP assure-t-elle le maintien du statut BIM pour ses participants ?,En transformant le revenu imm√©diat en un capital diff√©r√© non comptabilis√© par l'administration sociale.
Quel protocole de donn√©es d√©centralis√© est utilis√© par l'ECP pour garantir la souverainet√© des citoyens ?,Le protocole Solid.
Qui est l'inventeur du World Wide Web √† l'origine du projet Solid ?,Tim Berners-Lee.
Qu'est-ce qu'un ¬´ Pod ¬ª dans le contexte du protocole Solid ?,Un espace de stockage de donn√©es personnelles en ligne appartenant √† l'utilisateur.
Quel standard est utilis√© pour l'interop√©rabilit√© des services sociaux et de sant√© dans l'ECP ?,Le standard FHIR ($HL7$).
Comment se nomme la plateforme technique qui sert de moteur √† l'ECP ?,NYXO.
Quel est le co√ªt d'utilisation de la plateforme NYXO pour les citoyens ?,Elle est gratuite pour les citoyens.
Quel m√©canisme d√©mocratique Auderghem utilise-t-elle pour l'allocation de son budget partag√© ?,Le vote quadratique.
Quel est le montant du budget partag√© g√©r√© par la commune d'Auderghem ?,"Plus de $500\\,000$ euros."
Quelle technique est utilis√©e par NYXO pour archiver les flux de donn√©es publiques de mani√®re inalt√©rable ?,Le Git Scraping.
Quel est le seuil de pauvret√© pour un isol√© en Belgique en $2024$ ?,"$1\\,522$ euros net par mois."
Quel pourcentage de la population belge est consid√©r√© comme √©tant √† risque de pauvret√© ?,"$18,6\\%$."
Quel est le nombre approximatif de postes vacants en Belgique selon les donn√©es de $2024$ ?,"$172\\,000$ postes."
Quel est le principe de la ¬´ v√©rit√© administrative ¬ª dans l'ECP ?,Produire des donn√©es citoyennes v√©rifiables pour influencer les d√©cisions locales.
Pourquoi l'ECP garantit-elle une libert√© totale d'engagement (pas d'horaires impos√©s) ?,Pour √©viter toute requalification juridique en contrat de travail salari√©.
Quel est l'un des risques majeurs identifi√©s pour les ch√¥meurs participant √† l'ECP ?,Le risque que l'activit√© ne soit pas reconnue comme une recherche active d'emploi.
Quelle phase de la feuille de route ECP pr√©voit la cr√©ation d'un consortium formel en $2026$ ?,La Phase $2$ (Coalition).
Quel est l'objectif final de la Phase $3$ de l'ECP ($2027$-$2029$) ?,L'institutionnalisation via un cadre l√©gal reconnaissant le statut de ¬´ Contributeur Citoyen ¬ª.
Quel concept √©conomique de Kate Raworth inspire le cadre √©thique de l'ECP ?,La Th√©orie du Donut.
Que signifie l'acronyme MCC dans le cadre de l'ECP ?,Monnaie Contributive Citoyenne.
"Dans le mod√®le ECP, qu'est-ce que la ¬´ liquidation ¬ª des fonds ?","Le moment o√π le contributeur retire les sommes accumul√©es, par exemple lors de son d√©part √† la pension."
Quel est l'avantage du mod√®le ¬´ B2B ¬ª valid√© par le ruling fiscal pour un contributeur ?,"Il acte la nature commerciale et autonome de la prestation, prot√©geant contre le lien de subordination."
Quel plafond de d√©fraiement annuel est conseill√© pour rester dans la zone de s√©curit√© du volontariat en $2025$ ?,"$1\\,692,51$ euros."
Quel est l'objectif de l'√©cart financier entre travail et non-travail vis√© par l'Arizona ?,Atteindre une diff√©rence de plus de $500$ euros par mois.
Comment s'appelle la taxe sur les comptes-titres que le gouvernement Arizona pr√©voit de doubler ?,La taxe d'abonnement.
Quel est le nouveau taux du pr√©compte mobilier VVPRbis pr√©vu par l'accord budg√©taire ?,$18\\%$.
Quel type de soci√©t√© est particuli√®rement vis√© par la r√©forme du VVPRbis ?,Les soci√©t√©s de management.
Quel est le montant total de l'effort budg√©taire global pr√©vu par Les Engag√©s pour $2029$ ?,$23$ milliards d'euros.
Quelle r√©forme transforme le certificat m√©dical en document indiquant ce que le travailleur peut encore faire ?,La mise en place de la ¬´ fit note ¬ª (certificat d'aptitude).
√Ä partir de quelle ann√©e la d√©claration en temps r√©el des factures TVA deviendra-t-elle obligatoire ?,$2028$.
Quel est le taux de la nouvelle taxe sur les plus-values sur actifs financiers ?,$10\\%$.
Quelle technique fiscale pour les partenaires sans revenus sera r√©duite de moiti√© d'ici $2029$ ?,Le quotient conjugal.
Quel est le nouveau plafond d'heures pour le travail √©tudiant ?,$650$ heures par an.
Quel montant maximum de revenus nets un √©tudiant peut-il gagner sans que ses parents ne perdent d'avantages ?,"$12\\,000$ euros."
Quelle mesure permanente concerne la TVA pour la d√©molition et la reconstruction d'un logement ?,L'application du taux r√©duit de $6\\%$.
Comment s'appelle le nouveau principe fiscal qui permet aux contribuables de bonne foi de ne pas √™tre p√©nalis√©s pour une premi√®re erreur ?,Le droit √† l'erreur.
Quel montant devra d√©sormais d√©bourser un candidat pour obtenir la nationalit√© belge ?,"$1\\,000$ euros (au lieu de $150$ euros)."
Quel est le d√©lai de prescription pr√©vu en cas de suspicion de fraude fiscale ?,$7$ ans.
Quel outil informatique centralise toutes les aides et prestations sociales pour calculer le plafond par m√©nage ?,Le registre central.
Comment l'accord Arizona pr√©voit-il d'augmenter le pouvoir d'achat via les ch√®ques-repas ?,En augmentant la contribution maximale l√©gale de deux fois $2$ euros.
Quelle taxe sera instaur√©e unilat√©ralement en $2027$ si aucun accord international n'est trouv√© ?,La digitaxe (taxe num√©rique).
Quelle institution est charg√©e de r√©√©crire et simplifier le code de l'imp√¥t sur le revenu ?,Une commission sp√©ciale de simplification.
Quel service de m√©diation sera transform√© en ¬´ arbitrage fiscal ¬ª pour r√©duire les litiges ?,Le service de m√©diation fiscale.
"Dans le cadre de l'ECP, que repr√©sente un ¬´ cr√©dit de voix ¬ª ?",Une unit√© de pouvoir d√©cisionnel g√©n√©r√©e par une action citoyenne positive.
Quelle ville belge a r√©cemment annonc√© un accord communal PS-Ecolo-PTB surnomm√© la ¬´ Portugaise ¬ª ?,Mons.
Quel mouvement d'√©ducation permanente √©dite le magazine ¬´ Agir par la Culture ¬ª ?,Pr√©sence et Action Culturelles (PAC).
Quelle organisation d'√©conomie sociale a √©t√© fond√©e par l'Abb√© Froidure en $1937$ ?,Les Petits Riens.
Comment s'appelle le journal d'investigation n√©erlandophone ind√©pendant cr√©√© en $2009$ ?,Apache.
Quelle instance m√©diatique a re√ßu des centaines de plaintes apr√®s une s√©quence pol√©mique sur le CPAS ?,Le CSA (Conseil sup√©rieur de l'audiovisuel).
Quel est le co√ªt op√©rationnel modeste de l'infrastructure de l'ARC ?,"Environ $16\\,000$ euros par an."
Quelle technologie frugale est recommand√©e pour garantir l'acc√®s universel au portail NYXO ?,Eleventy ($11ty$).
Quel syst√®me remplace les astreintes lorsqu'un contribuable entrave une visite fiscale ?,L'application d'un b√©n√©fice imposable minimal.
Quelle r√©forme de Les Engag√©s vise √† cr√©er un cr√©dit de jours de cong√© par enfant ?,La r√©forme ¬´ sac √† dos des cong√©s familiaux ¬ª.
Quel est le but de la ¬´ norme √©nerg√©tique ¬ª renforc√©e par le budget Arizona ?,R√©duire la facture d'√©lectricit√© des entreprises belges expos√©es.
Quel organisme est mentionn√© comme partenaire pour le support de l'infrastructure Solid √† Bruxelles ?,Paradigm.
"Selon le FMI, sans intervention, vers quel type de budget se dirige la Belgique ?",Le pire budget de tous les pays industrialis√©s.
Quel est le taux d'endettement public par rapport au PIB pr√©vu pour $2038$ sans r√©formes ?,$130\\%$.
Quelle proc√©dure europ√©enne a √©t√© d√©clench√©e contre la Belgique en juin $2024$ ?,La proc√©dure de d√©ficits excessifs.
Quel principe de justice fiscale est invoqu√© pour faire contribuer les plus grandes fortunes ?,La contribution des √©paules les plus larges.
Quelle est la dur√©e de la p√©riode d'ajustement budg√©taire choisie par la Belgique aupr√®s de l'UE ?,$7$ ans.`;

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            return lines.map((line, index) => {
                // Handle quoted fields with commas
                const match = line.match(/^"?([^"]*)"?,(.*)$/) || line.match(/^([^,]*),(.*)$/);
                if (match) {
                    return {
                        id: index + 1,
                        question: match[1].replace(/^"|"$/g, '').trim(),
                        answer: match[2].replace(/^"|"$/g, '').trim(),
                        favorite: false,
                        mastered: false,
                        tags: [],
                        category: null
                    };
                }
                return null;
            }).filter(Boolean);
        }

        function categorizeCard(card) {
            const text = (card.question + ' ' + card.answer).toLowerCase();
            for (const [catName, catData] of Object.entries(categories)) {
                if (catData.keywords.some(kw => text.includes(kw))) {
                    card.category = catName;
                    card.tags.push(catName.toLowerCase());
                    return;
                }
            }
            card.category = 'Autre';
        }

        function init() {
            // Parse data
            flashcards = parseCSV(rawData);
            flashcards.forEach(categorizeCard);
            filteredCards = [...flashcards];
            
            // Load saved data
            loadSavedData();
            
            // Render
            renderCards();
            renderCategoryLegend();
            renderThemeFilters();
            updateStats();
            
            // Initialize Matrix rain
            initMatrixRain();
            
            // Start session timer
            setInterval(updateSessionTime, 1000);
            
            // Log activity
            logActivity('Session d√©marr√©e');
            
            // Setup event listeners
            setupEventListeners();
        }

        // ============== MATRIX RAIN ==============
        function initMatrixRain() {
            const canvas = document.getElementById('matrix-rain');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const chars = '„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            const drops = [];
            
            for (let i = 0; i < columns; i++) {
                drops[i] = Math.random() * canvas.height / fontSize;
            }
            
            function draw() {
                if (!settings.rain) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    return;
                }
                
                ctx.fillStyle = 'rgba(13, 2, 8, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = settings.accentColor;
                ctx.font = fontSize + 'px monospace';
                
                for (let i = 0; i < drops.length; i++) {
                    const char = chars[Math.floor(Math.random() * chars.length)];
                    ctx.fillText(char, i * fontSize, drops[i] * fontSize);
                    
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            
            setInterval(draw, 50);
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // ============== RENDERING ==============
        function renderCards() {
            const container = document.getElementById('cards-container');
            
            if (currentView === 'table') {
                renderTableView(container);
            } else {
                renderGridView(container);
            }
            
            updateStats();
        }

        function renderGridView(container) {
            container.className = currentView === 'compact' ? 'cards-grid' : 'cards-grid';
            container.style.gridTemplateColumns = currentView === 'compact' 
                ? 'repeat(auto-fill, minmax(280px, 1fr))' 
                : 'repeat(auto-fill, minmax(350px, 1fr))';
            
            container.innerHTML = filteredCards.map((card, index) => `
                <div class="flashcard ${card.favorite ? 'favorite' : ''} ${card.mastered ? 'mastered' : ''}" 
                     data-id="${card.id}"
                     style="animation-delay: ${index * 0.03}s">
                    <div class="card-header">
                        <span class="card-id">#${card.id.toString().padStart(3, '0')}</span>
                        <div class="card-actions">
                            <button class="card-action ${card.favorite ? 'favorited' : ''}" onclick="toggleFavorite(${card.id})" title="Favori">‚≠ê</button>
                            <button class="card-action mastered-btn ${card.mastered ? 'active' : ''}" onclick="toggleMastered(${card.id})" title="Ma√Ætris√©">‚úì</button>
                            <button class="card-action" onclick="openCardDetail(${card.id})" title="D√©tails">üîç</button>
                        </div>
                    </div>
                    <div class="card-question" onclick="toggleAnswer(${card.id})">${formatText(card.question)}</div>
                    <div class="card-answer ${settings.answers ? 'visible' : ''}" id="answer-${card.id}">${formatText(card.answer)}</div>
                    <div class="card-tags">
                        ${card.category ? `<span class="tag" style="background: ${categories[card.category]?.color || 'var(--matrix-green)'}30;">${card.category}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderTableView(container) {
            container.className = 'table-container';
            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th onclick="sortCards('id')">#</th>
                            <th onclick="sortCards('question')">Question</th>
                            <th onclick="sortCards('answer')">R√©ponse</th>
                            <th onclick="sortCards('category')">Cat√©gorie</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCards.map(card => `
                            <tr>
                                <td>${card.id}</td>
                                <td>${formatText(card.question).substring(0, 100)}...</td>
                                <td>${formatText(card.answer).substring(0, 80)}...</td>
                                <td><span class="tag" style="background: ${categories[card.category]?.color || 'var(--matrix-green)'}30;">${card.category || '-'}</span></td>
                                <td>
                                    <button class="card-action ${card.favorite ? 'favorited' : ''}" onclick="toggleFavorite(${card.id})">‚≠ê</button>
                                    <button class="card-action ${card.mastered ? 'active' : ''}" onclick="toggleMastered(${card.id})">‚úì</button>
                                    <button class="card-action" onclick="openCardDetail(${card.id})">üîç</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function formatText(text) {
            return text
                .replace(/\$([^$]+)\$/g, '<span style="color: var(--accent-cyan);">$1</span>')
                .replace(/\\,/g, ' ')
                .replace(/\\%/g, '%');
        }

        function renderCategoryLegend() {
            const container = document.getElementById('category-legend');
            const counts = {};
            
            flashcards.forEach(card => {
                const cat = card.category || 'Autre';
                counts[cat] = (counts[cat] || 0) + 1;
            });
            
            container.innerHTML = Object.entries(categories).map(([name, data]) => `
                <div class="legend-item" onclick="filterByCategory('${name}')">
                    <span class="legend-color" style="background: ${data.color};"></span>
                    <span>${name}</span>
                    <span class="legend-count">${counts[name] || 0}</span>
                </div>
            `).join('');
        }

        function renderThemeFilters() {
            const container = document.getElementById('theme-filters');
            container.innerHTML = Object.keys(categories).map(cat => `
                <span class="filter-tag" onclick="filterByCategory('${cat}')">${cat}</span>
            `).join('');
        }

        // ============== INTERACTIONS ==============
        function toggleAnswer(id) {
            const answer = document.getElementById(`answer-${id}`);
            if (answer) {
                answer.classList.toggle('visible');
            }
        }

        function toggleFavorite(id) {
            const card = flashcards.find(c => c.id === id);
            if (card) {
                card.favorite = !card.favorite;
                renderCards();
                updateStats();
                saveData();
                logActivity(`Carte #${id} ${card.favorite ? 'ajout√©e aux' : 'retir√©e des'} favoris`);
                addXP(5);
            }
        }

        function toggleMastered(id) {
            const card = flashcards.find(c => c.id === id);
            if (card) {
                card.mastered = !card.mastered;
                renderCards();
                updateStats();
                saveData();
                logActivity(`Carte #${id} marqu√©e comme ${card.mastered ? 'ma√Ætris√©e' : '√† revoir'}`);
                if (card.mastered) addXP(10);
            }
        }

        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            renderCards();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            // Hide all panels
            document.getElementById('cards-panel').style.display = 'none';
            document.getElementById('detective-panel').style.display = 'none';
            document.getElementById('quiz-panel').style.display = 'none';
            document.getElementById('editor-panel').style.display = 'none';
            document.getElementById('connections-panel').style.display = 'none';
            
            // Show selected panel
            if (tab === 'cards') {
                document.getElementById('cards-panel').style.display = 'block';
            } else if (tab === 'detective') {
                document.getElementById('detective-panel').style.display = 'block';
                renderDetectiveMode();
            } else if (tab === 'quiz') {
                document.getElementById('quiz-panel').style.display = 'block';
                initQuiz();
            } else if (tab === 'editor') {
                document.getElementById('editor-panel').style.display = 'block';
            } else if (tab === 'connections') {
                document.getElementById('connections-panel').style.display = 'block';
                renderConnections();
            }
        }

        // ============== SEARCH & FILTER ==============
        function setupEventListeners() {
            document.getElementById('search-input').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query) {
                    filteredCards = flashcards.filter(card => 
                        card.question.toLowerCase().includes(query) ||
                        card.answer.toLowerCase().includes(query)
                    );
                } else {
                    filteredCards = [...flashcards];
                }
                renderCards();
            });
            
            document.getElementById('sort-select').addEventListener('change', (e) => {
                sortCards(e.target.value);
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                if (e.key === 'q') switchTab('quiz');
                if (e.key === 'd') switchTab('detective');
                if (e.key === 'n') { switchTab('editor'); clearEditor(); }
                if (e.key === ' ' && currentTab === 'quiz') { e.preventDefault(); quizReveal(); }
                if (e.key === 'ArrowRight' && currentTab === 'quiz') quizNext();
                if (e.key === 'ArrowLeft' && currentTab === 'quiz') quizPrev();
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('search-input').focus();
                }
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportData();
                }
            });
            
            // Drag and drop import
            const dropZone = document.getElementById('drop-zone');
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                handleFileImport(e.dataTransfer.files[0]);
            });
            
            document.getElementById('file-input').addEventListener('change', (e) => {
                handleFileImport(e.target.files[0]);
            });
        }

        function filterByStatus(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.toggle('active', tag.dataset.filter === status);
            });
            
            if (status === 'all') {
                filteredCards = [...flashcards];
            } else if (status === 'favorites') {
                filteredCards = flashcards.filter(c => c.favorite);
            } else if (status === 'mastered') {
                filteredCards = flashcards.filter(c => c.mastered);
            } else if (status === 'unmastered') {
                filteredCards = flashcards.filter(c => !c.mastered);
            }
            
            renderCards();
            logActivity(`Filtre appliqu√©: ${status}`);
        }

        function filterByCategory(category) {
            filteredCards = flashcards.filter(c => c.category === category);
            renderCards();
            logActivity(`Filtre cat√©gorie: ${category}`);
        }

        function sortCards(by) {
            if (by === 'id') {
                filteredCards.sort((a, b) => a.id - b.id);
            } else if (by === 'alpha' || by === 'question') {
                filteredCards.sort((a, b) => a.question.localeCompare(b.question));
            } else if (by === 'answer') {
                filteredCards.sort((a, b) => a.answer.localeCompare(b.answer));
            } else if (by === 'length') {
                filteredCards.sort((a, b) => a.question.length - b.question.length);
            } else if (by === 'random') {
                filteredCards.sort(() => Math.random() - 0.5);
            } else if (by === 'category') {
                filteredCards.sort((a, b) => (a.category || '').localeCompare(b.category || ''));
            }
            renderCards();
        }

        // ============== DETECTIVE MODE ==============
        function renderDetectiveMode() {
            renderWordCloud();
            renderNumbers();
            renderTimeline();
            renderEntities();
            renderCategoryChart();
            renderQuestionTypes();
        }

        function renderWordCloud() {
            const container = document.getElementById('word-cloud');
            const words = {};
            const stopWords = ['de', 'la', 'le', 'les', 'du', 'des', 'un', 'une', 'et', 'en', 'pour', 'par', 'sur', 'au', 'aux', 'est', 'sont', 'que', 'qui', 'dans', 'ce', 'cette', 'avec', 'ou', 'il', 'elle', 'se', 'ne', 'pas', 'plus', 'son', 'sa', 'ses', 'leur', 'leurs', '√†', 'a', '√©t√©', '√™tre', 'avoir', 'fait', 'faire', 'comme', 'si', 'mais', 'donc', 'car', 'ni', 'y', 'quel', 'quelle', 'quels', 'quelles', 'qu', 'l', 'd'];
            
            flashcards.forEach(card => {
                const text = (card.question + ' ' + card.answer).toLowerCase();
                const tokens = text.match(/[a-z√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ß]+/gi) || [];
                tokens.forEach(word => {
                    if (word.length > 3 && !stopWords.includes(word)) {
                        words[word] = (words[word] || 0) + 1;
                    }
                });
            });
            
            const sorted = Object.entries(words)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 30);
            
            const maxCount = sorted[0]?.[1] || 1;
            
            container.innerHTML = sorted.map(([word, count]) => {
                const size = 0.7 + (count / maxCount) * 1;
                return `<span class="word-item" style="font-size: ${size}rem;" onclick="searchWord('${word}')">${word}</span>`;
            }).join('');
        }

        function searchWord(word) {
            document.getElementById('search-input').value = word;
            filteredCards = flashcards.filter(card => 
                card.question.toLowerCase().includes(word) ||
                card.answer.toLowerCase().includes(word)
            );
            switchTab('cards');
            renderCards();
        }

        function renderNumbers() {
            const container = document.getElementById('numbers-list');
            const numbers = [];
            
            flashcards.forEach(card => {
                const matches = (card.question + ' ' + card.answer).match(/\$?[\d\s,\.]+(?:\s*(?:milliards?|millions?|euros?|%|ans?|heures?))?\$?/gi) || [];
                matches.forEach(match => {
                    const clean = match.replace(/\$/g, '').trim();
                    if (clean && clean.match(/\d/)) {
                        numbers.push({
                            value: clean,
                            context: card.question.substring(0, 60) + '...',
                            cardId: card.id
                        });
                    }
                });
            });
            
            container.innerHTML = numbers.slice(0, 25).map(n => `
                <div style="padding: 8px; border-bottom: 1px solid var(--border-glow); cursor: pointer;" onclick="openCardDetail(${n.cardId})">
                    <span style="color: var(--accent-cyan); font-weight: bold;">${n.value}</span>
                    <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 3px;">${n.context}</div>
                </div>
            `).join('');
        }

        function renderTimeline() {
            const container = document.getElementById('timeline');
            const years = {};
            
            flashcards.forEach(card => {
                const matches = (card.question + ' ' + card.answer).match(/\b(19|20)\d{2}\b/g) || [];
                matches.forEach(year => {
                    if (!years[year]) years[year] = [];
                    years[year].push(card);
                });
            });
            
            const sorted = Object.entries(years).sort((a, b) => a[0] - b[0]);
            
            container.innerHTML = sorted.map(([year, cards]) => `
                <div class="timeline-item">
                    <span class="timeline-year">${year}</span>
                    <span style="font-size: 0.8rem;"> ‚Äî ${cards.length} r√©f√©rence(s)</span>
                    <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 5px;">
                        ${cards.slice(0, 2).map(c => c.question.substring(0, 50) + '...').join('<br>')}
                    </div>
                </div>
            `).join('');
        }

        function renderEntities() {
            const container = document.getElementById('entities-list');
            const entities = {
                'Organisations': ['NYXO', 'SDA', 'SPF', 'ARC', 'BIM', 'CSA', 'FMI', 'UE', 'PAC'],
                'Personnes': ['Bart De Wever', 'Tim Berners-Lee', 'Kate Raworth', 'Abb√© Froidure'],
                'Lieux': ['Belgique', 'Auderghem', 'Mons', 'Bruxelles'],
                'Partis': ['N-VA', 'MR', 'Les Engag√©s', 'Vooruit', 'CD&V', 'PS', 'Ecolo', 'PTB']
            };
            
            container.innerHTML = Object.entries(entities).map(([type, list]) => `
                <div style="margin-bottom: 15px;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 8px; font-size: 0.85rem;">${type}</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                        ${list.map(e => `<span class="tag" onclick="searchWord('${e}')">${e}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderCategoryChart() {
            const container = document.getElementById('category-chart');
            const counts = {};
            
            flashcards.forEach(card => {
                const cat = card.category || 'Autre';
                counts[cat] = (counts[cat] || 0) + 1;
            });
            
            const max = Math.max(...Object.values(counts));
            
            container.innerHTML = Object.entries(counts).map(([cat, count]) => `
                <div class="chart-bar" style="height: ${(count / max) * 180}px; background: ${categories[cat]?.color || 'var(--matrix-green)'};">
                    <div class="tooltip">${cat}: ${count}</div>
                </div>
            `).join('');
        }

        function renderQuestionTypes() {
            const container = document.getElementById('question-types');
            const types = {
                'Qu\'est-ce que': 0,
                'Quel/Quelle': 0,
                'Comment': 0,
                'Pourquoi': 0,
                'Qui': 0,
                'Combien': 0,
                'O√π': 0,
                'Autre': 0
            };
            
            flashcards.forEach(card => {
                const q = card.question.toLowerCase();
                if (q.startsWith('qu\'est-ce que') || q.startsWith('que signifie')) types['Qu\'est-ce que']++;
                else if (q.match(/^quell?e?s?\b/)) types['Quel/Quelle']++;
                else if (q.startsWith('comment')) types['Comment']++;
                else if (q.startsWith('pourquoi')) types['Pourquoi']++;
                else if (q.startsWith('qui')) types['Qui']++;
                else if (q.startsWith('combien')) types['Combien']++;
                else if (q.startsWith('o√π')) types['O√π']++;
                else types['Autre']++;
            });
            
            container.innerHTML = Object.entries(types)
                .filter(([_, count]) => count > 0)
                .map(([type, count]) => `
                    <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border-glow);">
                        <span>${type}</span>
                        <span style="color: var(--accent-cyan);">${count}</span>
                    </div>
                `).join('');
        }

        // ============== CONNECTIONS ==============
        function renderConnections() {
            const canvas = document.getElementById('connections-canvas');
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = 250;
            
            const ctx = canvas.getContext('2d');
            
            // Draw simple network visualization
            const nodes = Object.keys(categories).map((cat, i) => ({
                name: cat,
                x: 50 + (i % 3) * 150,
                y: 50 + Math.floor(i / 3) * 100,
                color: categories[cat].color
            }));
            
            // Draw connections
            ctx.strokeStyle = 'rgba(0, 255, 65, 0.2)';
            ctx.lineWidth = 1;
            nodes.forEach((node, i) => {
                nodes.forEach((other, j) => {
                    if (i < j && Math.random() > 0.5) {
                        ctx.beginPath();
                        ctx.moveTo(node.x, node.y);
                        ctx.lineTo(other.x, other.y);
                        ctx.stroke();
                    }
                });
            });
            
            // Draw nodes
            nodes.forEach(node => {
                ctx.fillStyle = node.color;
                ctx.beginPath();
                ctx.arc(node.x, node.y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000';
                ctx.font = '10px Share Tech Mono';
                ctx.textAlign = 'center';
                ctx.fillText(node.name.substring(0, 6), node.x, node.y + 4);
            });
            
            // Related concepts
            renderRelatedConcepts();
            renderTermFrequency();
        }

        function renderRelatedConcepts() {
            const container = document.getElementById('related-concepts');
            const concepts = [
                { name: 'ECP ‚Üî Arizona', strength: 'Fort' },
                { name: 'Fiscal ‚Üî Social', strength: 'Moyen' },
                { name: 'Tech ‚Üî ECP', strength: 'Fort' },
                { name: 'Dates ‚Üî Arizona', strength: 'Fort' },
                { name: 'Social ‚Üî ECP', strength: 'Fort' }
            ];
            
            container.innerHTML = concepts.map(c => `
                <div style="padding: 8px; border-bottom: 1px solid var(--border-glow);">
                    <span>${c.name}</span>
                    <span style="float: right; color: ${c.strength === 'Fort' ? 'var(--success)' : 'var(--accent-orange)'};">${c.strength}</span>
                </div>
            `).join('');
        }

        function renderTermFrequency() {
            const container = document.getElementById('term-frequency');
            const terms = [
                { term: 'ECP', count: 25 },
                { term: 'Arizona', count: 15 },
                { term: 'fiscal', count: 18 },
                { term: 'euros', count: 22 },
                { term: 'citoyen', count: 12 }
            ];
            
            const max = Math.max(...terms.map(t => t.count));
            
            container.innerHTML = terms.map(t => `
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                        <span>${t.term}</span>
                        <span style="color: var(--accent-cyan);">${t.count}</span>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); height: 6px; border-radius: 3px;">
                        <div style="background: var(--matrix-green); height: 100%; width: ${(t.count/max)*100}%; border-radius: 3px;"></div>
                    </div>
                </div>
            `).join('');
        }

        // ============== QUIZ MODE ==============
        function initQuiz() {
            quizCards = [...filteredCards].sort(() => Math.random() - 0.5);
            quizIndex = 0;
            quizCorrect = 0;
            quizIncorrect = 0;
            updateQuizDisplay();
        }

        function updateQuizDisplay() {
            if (quizCards.length === 0) {
                document.getElementById('quiz-question').textContent = 'Aucune carte √† afficher';
                return;
            }
            
            const card = quizCards[quizIndex];
            document.getElementById('quiz-current').textContent = quizIndex + 1;
            document.getElementById('quiz-total').textContent = quizCards.length;
            document.getElementById('quiz-question').innerHTML = formatText(card.question);
            document.getElementById('quiz-answer').innerHTML = formatText(card.answer);
            document.getElementById('quiz-answer').classList.remove('visible');
            document.getElementById('quiz-category').textContent = card.category || '-';
            document.getElementById('quiz-correct').textContent = quizCorrect;
            document.getElementById('quiz-incorrect').textContent = quizIncorrect;
        }

        function quizReveal() {
            document.getElementById('quiz-answer').classList.add('visible');
        }

        function quizNext() {
            if (quizIndex < quizCards.length - 1) {
                quizIndex++;
                updateQuizDisplay();
            }
        }

        function quizPrev() {
            if (quizIndex > 0) {
                quizIndex--;
                updateQuizDisplay();
            }
        }

        function quizMark(correct) {
            if (correct) {
                quizCorrect++;
                addXP(15);
            } else {
                quizIncorrect++;
            }
            quizNext();
        }

        function shuffleQuiz() {
            quizCards.sort(() => Math.random() - 0.5);
            quizIndex = 0;
            updateQuizDisplay();
            logActivity('Quiz m√©lang√©');
        }

        function resetQuiz() {
            quizCorrect = 0;
            quizIncorrect = 0;
            quizIndex = 0;
            updateQuizDisplay();
            logActivity('Quiz r√©initialis√©');
        }

        function quizFavoritesOnly() {
            quizCards = flashcards.filter(c => c.favorite).sort(() => Math.random() - 0.5);
            quizIndex = 0;
            quizCorrect = 0;
            quizIncorrect = 0;
            updateQuizDisplay();
            logActivity('Quiz: favoris seulement');
        }

        // ============== EDITOR ==============
        function saveCard() {
            const question = document.getElementById('editor-question').value.trim();
            const answer = document.getElementById('editor-answer').value.trim();
            const tagsInput = document.getElementById('editor-tags').value.trim();
            
            if (!question || !answer) {
                alert('Veuillez remplir la question et la r√©ponse');
                return;
            }
            
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];
            
            if (editingCardId) {
                // Update existing
                const card = flashcards.find(c => c.id === editingCardId);
                if (card) {
                    card.question = question;
                    card.answer = answer;
                    card.tags = tags;
                    categorizeCard(card);
                }
                logActivity(`Carte #${editingCardId} modifi√©e`);
            } else {
                // Create new
                const newCard = {
                    id: flashcards.length + 1,
                    question,
                    answer,
                    tags,
                    favorite: false,
                    mastered: false,
                    category: null
                };
                categorizeCard(newCard);
                flashcards.push(newCard);
                logActivity(`Nouvelle carte #${newCard.id} cr√©√©e`);
                addXP(20);
            }
            
            filteredCards = [...flashcards];
            renderCards();
            clearEditor();
            saveData();
        }

        function clearEditor() {
            document.getElementById('editor-question').value = '';
            document.getElementById('editor-answer').value = '';
            document.getElementById('editor-tags').value = '';
            editingCardId = null;
        }

        function bulkImport() {
            const text = document.getElementById('bulk-editor').value.trim();
            if (!text) return;
            
            const newCards = parseCSV(text);
            let count = 0;
            
            newCards.forEach(card => {
                card.id = flashcards.length + count + 1;
                categorizeCard(card);
                flashcards.push(card);
                count++;
            });
            
            filteredCards = [...flashcards];
            renderCards();
            updateStats();
            saveData();
            document.getElementById('bulk-editor').value = '';
            logActivity(`${count} cartes import√©es`);
            addXP(count * 5);
        }

        // ============== CARD DETAIL ==============
        function openCardDetail(id) {
            const card = flashcards.find(c => c.id === id);
            if (!card) return;
            
            document.getElementById('detail-card-id').textContent = id;
            document.getElementById('detail-question').innerHTML = formatText(card.question);
            document.getElementById('detail-answer').innerHTML = formatText(card.answer);
            document.getElementById('detail-tags').innerHTML = card.tags.map(t => `<span class="tag">${t}</span>`).join('');
            
            editingCardId = id;
            openModal('card-detail');
        }

        function editCardFromDetail() {
            const card = flashcards.find(c => c.id === editingCardId);
            if (!card) return;
            
            document.getElementById('editor-question').value = card.question;
            document.getElementById('editor-answer').value = card.answer;
            document.getElementById('editor-tags').value = card.tags.join(', ');
            
            closeModal('card-detail');
            switchTab('editor');
        }

        function deleteCardFromDetail() {
            if (confirm('Supprimer cette carte ?')) {
                flashcards = flashcards.filter(c => c.id !== editingCardId);
                filteredCards = [...flashcards];
                renderCards();
                closeModal('card-detail');
                saveData();
                logActivity(`Carte #${editingCardId} supprim√©e`);
            }
        }

        // ============== IMPORT / EXPORT ==============
        function handleFileImport(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                
                if (file.name.endsWith('.json')) {
                    try {
                        const data = JSON.parse(content);
                        data.forEach((item, i) => {
                            const card = {
                                id: flashcards.length + i + 1,
                                question: item.question || item.q,
                                answer: item.answer || item.a,
                                tags: item.tags || [],
                                favorite: false,
                                mastered: false
                            };
                            categorizeCard(card);
                            flashcards.push(card);
                        });
                    } catch (err) {
                        alert('Erreur de parsing JSON');
                        return;
                    }
                } else {
                    const newCards = parseCSV(content);
                    newCards.forEach((card, i) => {
                        card.id = flashcards.length + i + 1;
                        categorizeCard(card);
                        flashcards.push(card);
                    });
                }
                
                filteredCards = [...flashcards];
                renderCards();
                updateStats();
                saveData();
                closeModal('import');
                logActivity(`Fichier ${file.name} import√©`);
            };
            reader.readAsText(file);
        }

        function exportData(format = 'csv') {
            let content, filename, type;
            
            if (format === 'csv') {
                content = flashcards.map(c => `"${c.question.replace(/"/g, '""')}","${c.answer.replace(/"/g, '""')}"`).join('\n');
                filename = 'flashcards_export.csv';
                type = 'text/csv';
            } else if (format === 'json') {
                content = JSON.stringify(flashcards, null, 2);
                filename = 'flashcards_export.json';
                type = 'application/json';
            } else if (format === 'anki') {
                content = flashcards.map(c => `${c.question}\t${c.answer}`).join('\n');
                filename = 'flashcards_anki.txt';
                type = 'text/plain';
            } else {
                // PDF - simple text version
                content = flashcards.map(c => `Q: ${c.question}\nA: ${c.answer}\n---`).join('\n\n');
                filename = 'flashcards_export.txt';
                type = 'text/plain';
            }
            
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            logActivity(`Export ${format.toUpperCase()} effectu√©`);
        }

        // ============== SETTINGS ==============
        function toggleSetting(setting) {
            settings[setting] = !settings[setting];
            document.getElementById(`toggle-${setting}`).classList.toggle('active', settings[setting]);
            
            if (setting === 'scanlines') {
                document.body.classList.toggle('scanlines', settings.scanlines);
            }
            if (setting === 'answers') {
                renderCards();
            }
            
            saveData();
        }

        function setAccentColor(color) {
            settings.accentColor = color;
            document.documentElement.style.setProperty('--matrix-green', color);
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.toggle('active', opt.style.background === color);
            });
            saveData();
        }

        function updatePomodoroDuration() {
            const value = document.getElementById('pomodoro-duration').value;
            settings.pomodoroDuration = parseInt(value);
            document.getElementById('pomodoro-value').textContent = value + ' min';
            pomodoroTime = value * 60;
            updateTimerDisplay();
            saveData();
        }

        // ============== TIMER ==============
        function startTimer() {
            if (pomodoroRunning) return;
            pomodoroRunning = true;
            timerInterval = setInterval(() => {
                if (pomodoroTime > 0) {
                    pomodoroTime--;
                    updateTimerDisplay();
                } else {
                    pauseTimer();
                    alert('‚è∞ Temps √©coul√© !');
                    addXP(25);
                    logActivity('Pomodoro compl√©t√©!');
                }
            }, 1000);
            logActivity('Timer d√©marr√©');
        }

        function pauseTimer() {
            pomodoroRunning = false;
            clearInterval(timerInterval);
        }

        function resetTimer() {
            pauseTimer();
            pomodoroTime = settings.pomodoroDuration * 60;
            updateTimerDisplay();
        }

        function setTimer(minutes) {
            pauseTimer();
            pomodoroTime = minutes * 60;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(pomodoroTime / 60);
            const seconds = pomodoroTime % 60;
            document.getElementById('pomodoro-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ============== PROFILE & XP ==============
        function addXP(amount) {
            userProfile.xp += amount;
            const xpNeeded = userProfile.level * 100;
            
            if (userProfile.xp >= xpNeeded) {
                userProfile.level++;
                userProfile.xp -= xpNeeded;
                logActivity(`üéâ Niveau ${userProfile.level} atteint!`);
            }
            
            updateProfileDisplay();
            saveData();
        }

        function updateProfileDisplay() {
            document.getElementById('user-name').textContent = userProfile.name;
            document.getElementById('user-title').textContent = userProfile.title;
            document.getElementById('user-avatar').textContent = userProfile.avatar;
            document.getElementById('user-level').textContent = userProfile.level;
            document.getElementById('user-xp').textContent = userProfile.xp;
            document.getElementById('xp-needed').textContent = userProfile.level * 100;
            document.getElementById('xp-fill').style.width = `${(userProfile.xp / (userProfile.level * 100)) * 100}%`;
        }

        function setAvatar(emoji) {
            userProfile.avatar = emoji;
            document.getElementById('user-avatar').textContent = emoji;
        }

        function saveProfile() {
            userProfile.name = document.getElementById('profile-name-input').value || 'Agent_Inconnu';
            userProfile.title = document.getElementById('profile-title-select').value;
            updateProfileDisplay();
            closeModal('profile');
            saveData();
            logActivity('Profil mis √† jour');
        }

        function saveNotes() {
            userProfile.notes = document.getElementById('user-notes').value;
            saveData();
            logActivity('Notes sauvegard√©es');
        }

        // ============== STATS ==============
        function updateStats() {
            document.getElementById('total-cards').textContent = flashcards.length;
            document.getElementById('mastered-count').textContent = flashcards.filter(c => c.mastered).length;
            document.getElementById('favorites-count').textContent = flashcards.filter(c => c.favorite).length;
            
            // Category stats
            const ecpCount = flashcards.filter(c => c.category === 'ECP').length;
            const arizonaCount = flashcards.filter(c => c.category === 'Arizona').length;
            const fiscalCount = flashcards.filter(c => c.category === 'Fiscal').length;
            const techCount = flashcards.filter(c => c.category === 'Tech').length;
            
            document.getElementById('stat-ecp').textContent = ecpCount;
            document.getElementById('stat-arizona').textContent = arizonaCount;
            document.getElementById('stat-fiscal').textContent = fiscalCount;
            document.getElementById('stat-tech').textContent = techCount;
        }

        function updateSessionTime() {
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('session-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ============== ACTIVITY LOG ==============
        function logActivity(message) {
            const log = document.getElementById('activity-log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">${time}</span><br>${message}`;
            log.insertBefore(entry, log.firstChild);
            
            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        // ============== MODALS ==============
        function openModal(name) {
            document.getElementById(`modal-${name}`).classList.add('active');
            
            if (name === 'profile') {
                document.getElementById('profile-name-input').value = userProfile.name;
                document.getElementById('profile-title-select').value = userProfile.title;
            }
        }

        function closeModal(name) {
            document.getElementById(`modal-${name}`).classList.remove('active');
        }

        // Close modal on outside click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // ============== PANELS ==============
        function togglePanel(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('collapsed');
            const arrow = header.querySelector('span:last-child');
            arrow.textContent = content.classList.contains('collapsed') ? '‚ñ∂' : '‚ñº';
        }

        function toggleMobilePanel(side) {
            document.getElementById(`sidebar-${side}`).classList.toggle('mobile-open');
        }

        // ============== PERSISTENCE ==============
        function saveData() {
            const data = {
                flashcards: flashcards.map(c => ({
                    ...c,
                    favorite: c.favorite,
                    mastered: c.mastered,
                    tags: c.tags
                })),
                userProfile,
                settings
            };
            localStorage.setItem('nexus-ecp-data', JSON.stringify(data));
        }

        function loadSavedData() {
            const saved = localStorage.getItem('nexus-ecp-data');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    // Merge saved card states
                    if (data.flashcards) {
                        data.flashcards.forEach(saved => {
                            const card = flashcards.find(c => c.id === saved.id);
                            if (card) {
                                card.favorite = saved.favorite;
                                card.mastered = saved.mastered;
                                card.tags = saved.tags || [];
                            }
                        });
                    }
                    
                    // Load profile
                    if (data.userProfile) {
                        userProfile = { ...userProfile, ...data.userProfile };
                    }
                    
                    // Load settings
                    if (data.settings) {
                        settings = { ...settings, ...data.settings };
                    }
                    
                    updateProfileDisplay();
                    
                    // Apply settings
                    if (!settings.scanlines) document.body.classList.remove('scanlines');
                    if (settings.accentColor !== '#00ff41') {
                        setAccentColor(settings.accentColor);
                    }
                    
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
            
            // Load notes
            document.getElementById('user-notes').value = userProfile.notes || '';
        }

        // ============== INIT ==============
        init();
    </script>
</body>
</html>
