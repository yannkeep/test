<!DOCTYPE html>
<html lang="fr" prefix="og: https://ogp.me/ns#" itemscope itemtype="https://schema.org/WebApplication">
<head>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         #B!Mi ‚Äî PLAIDOYER CITOYEN ULTIMATE v4.0
         Poste de Travail pour la Participation Citoyenne et l'√âducation Populaire
         Fusion des meilleures fonctionnalit√©s ‚Ä¢ Mode Sombre R√©tro Geek
         Licence: Creative Commons BY-NC-SA 4.0
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>#B!Mi ‚Äî Plaidoyer Citoyen | Poste de Travail pour le Changement Social</title>
    <meta name="description" content="Poste de travail num√©rique gratuit pour construire votre strat√©gie de plaidoyer citoyen. 15 outils m√©thodologiques Voir-Juger-Agir. Import/Export multiformats. Fonctionne hors-ligne.">
    <meta name="keywords" content="plaidoyer citoyen, participation citoyenne, d√©mocratie participative, √©ducation populaire, voir juger agir, advocacy, changement social, Belgique, s√©curit√© sociale">
    <meta name="author" content="#B!Mi Collective">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="canonical" href="https://bimi.tools/plaidoyer">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bimi.tools/plaidoyer">
    <meta property="og:title" content="#B!Mi ‚Äî Plaidoyer Citoyen">
    <meta property="og:description" content="15 outils gratuits pour construire votre strat√©gie de changement social.">
    <meta property="og:locale" content="fr_BE">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "#B!Mi Plaidoyer Citoyen",
        "description": "Poste de travail num√©rique pour construire des strat√©gies de plaidoyer citoyen",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "EUR"},
        "featureList": ["15 outils m√©thodologiques", "Import/Export multiformats", "Fonctionne hors-ligne", "IndexedDB persistant"]
    }
    </script>

    <style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           DESIGN SYSTEM: R√âTRO GEEK ‚Äî VERT TENDRE & LILAS
           Mode sombre par d√©faut, accessible, non infantilisant
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        
        :root {
            /* Fond sombre avec nuance violette */
            --bg-deep: #0d0d14;
            --bg-base: #12121a;
            --bg-elevated: #1a1a26;
            --bg-surface: #222233;
            --bg-hover: #2a2a3d;
            
            /* Bordures et s√©parateurs */
            --border-subtle: #2d2d44;
            --border-default: #3d3d55;
            --border-strong: #4d4d66;
            
            /* Texte */
            --text-primary: #e8e8f0;
            --text-secondary: #a0a0b8;
            --text-muted: #6b6b88;
            --text-inverse: #12121a;
            
            /* Vert tendre - Couleur principale */
            --mint-50: #f0fff4;
            --mint-100: #c6f6d5;
            --mint-200: #9ae6b4;
            --mint-300: #68d391;
            --mint-400: #48bb78;
            --mint-500: #38a169;
            --mint-glow: rgba(72, 187, 120, 0.3);
            
            /* Lilas - Couleur secondaire */
            --lilac-50: #faf5ff;
            --lilac-100: #e9d8fd;
            --lilac-200: #d6bcfa;
            --lilac-300: #b794f4;
            --lilac-400: #9f7aea;
            --lilac-500: #805ad5;
            --lilac-glow: rgba(159, 122, 234, 0.3);
            
            /* Phases Voir/Juger/Agir */
            --voir: #63b3ed;
            --voir-bg: rgba(99, 179, 237, 0.12);
            --juger: #f6ad55;
            --juger-bg: rgba(246, 173, 85, 0.12);
            --agir: #68d391;
            --agir-bg: rgba(104, 211, 145, 0.12);
            
            /* S√©mantique */
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #fc8181;
            --info: #63b3ed;
            
            /* Position acteurs */
            --ally: #48bb78;
            --neutral: #a0aec0;
            --opponent: #fc8181;
            --target: #f6ad55;
            
            /* Typographie */
            --font-display: 'Space Grotesk', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'Consolas', monospace;
            
            /* Espacements */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            
            /* Rayons */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* Ombres */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
            --shadow-glow-mint: 0 0 20px var(--mint-glow);
            --shadow-glow-lilac: 0 0 20px var(--lilac-glow);
            
            /* Transitions */
            --transition-fast: 120ms ease;
            --transition-base: 200ms ease;
            --transition-slow: 350ms ease;
            
            /* Layout */
            --header-h: 56px;
            --sidebar-w: 280px;
            --preview-w: 340px;
        }

        /* Reset */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { 
            font-size: 16px; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-display);
            background: var(--bg-base);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        ::selection {
            background: var(--lilac-400);
            color: var(--text-inverse);
        }

        /* Scrollbar r√©tro */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, var(--mint-400), var(--lilac-400)); 
            border-radius: 4px; 
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--mint-300); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           LAYOUT PRINCIPAL
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        
        #app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            min-height: 100dvh;
        }

        /* Header */
        #header {
            height: var(--header-h);
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border-default);
            display: flex;
            align-items: center;
            padding: 0 var(--space-4);
            gap: var(--space-3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .logo-mark {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--mint-400), var(--lilac-400));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 0.7rem;
            color: var(--text-inverse);
            box-shadow: var(--shadow-glow-mint);
            letter-spacing: -0.05em;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .logo-sub {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        #project-title {
            flex: 1;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 var(--space-4);
        }

        .header-actions {
            display: flex;
            gap: var(--space-2);
        }

        /* Boutons */
        .btn {
            font-family: var(--font-display);
            font-weight: 500;
            font-size: 0.85rem;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            border: 1px solid transparent;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--mint-400), var(--mint-500));
            color: var(--text-inverse);
            border-color: var(--mint-500);
            box-shadow: var(--shadow-glow-mint);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--mint-300), var(--mint-400));
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-surface);
            color: var(--text-primary);
            border-color: var(--border-default);
        }
        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--lilac-400);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }
        .btn-ghost:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            font-size: 1.1rem;
        }

        .btn-sm {
            padding: var(--space-1) var(--space-3);
            font-size: 0.8rem;
        }

        /* Layout principal */
        #main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        #sidebar {
            width: var(--sidebar-w);
            background: var(--bg-elevated);
            border-right: 1px solid var(--border-default);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
        }

        @media (max-width: 1024px) {
            #sidebar {
                position: fixed;
                left: 0;
                top: var(--header-h);
                bottom: 0;
                z-index: 200;
                transform: translateX(-100%);
                transition: transform var(--transition-base);
            }
            #sidebar.open {
                transform: translateX(0);
                box-shadow: var(--shadow-lg);
            }
            #sidebar-overlay {
                position: fixed;
                inset: 0;
                top: var(--header-h);
                background: rgba(0,0,0,0.6);
                z-index: 199;
                opacity: 0;
                visibility: hidden;
                transition: all var(--transition-base);
            }
            #sidebar-overlay.open {
                opacity: 1;
                visibility: visible;
            }
        }

        /* Projets */
        #projects-section {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
        }

        .section-label {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        #projects-list {
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: var(--space-3);
        }

        .project-row {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
            margin-bottom: 2px;
        }
        .project-row:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .project-row.selected {
            background: linear-gradient(90deg, var(--mint-glow), transparent);
            color: var(--mint-300);
            border-left: 2px solid var(--mint-400);
        }
        .project-row .name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .project-row .actions {
            display: flex;
            gap: 2px;
            opacity: 0;
        }
        .project-row:hover .actions {
            opacity: 1;
        }
        .project-row .actions button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.75rem;
            padding: 2px 4px;
            border-radius: var(--radius-sm);
        }
        .project-row .actions button:hover {
            background: var(--bg-surface);
            color: var(--text-primary);
        }

        .project-btns {
            display: flex;
            gap: var(--space-2);
        }
        .project-btns button {
            flex: 1;
            padding: var(--space-2);
            background: var(--bg-surface);
            border: 1px dashed var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .project-btns button:hover {
            border-color: var(--mint-400);
            color: var(--mint-300);
        }

        /* Navigation */
        #nav-section {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-3);
        }

        .nav-group {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            padding: var(--space-4) var(--space-2) var(--space-2);
        }
        .nav-group.c-voir { color: var(--voir); }
        .nav-group.c-juger { color: var(--juger); }
        .nav-group.c-agir { color: var(--agir); }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            width: 100%;
            text-align: left;
            padding: var(--space-2) var(--space-3);
            border: none;
            background: none;
            color: var(--text-secondary);
            font-family: var(--font-display);
            font-size: 0.85rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            margin-bottom: 1px;
            transition: all var(--transition-fast);
            position: relative;
        }
        .nav-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .nav-btn.active {
            background: var(--bg-surface);
            color: var(--mint-300);
        }
        .nav-btn .icon { width: 20px; text-align: center; }
        .nav-btn .label { flex: 1; }
        .nav-btn .hint-trigger {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--bg-surface);
            color: var(--text-muted);
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-fast);
            font-weight: 700;
        }
        .nav-btn:hover .hint-trigger { opacity: 0.7; }
        .nav-btn .hint-trigger:hover { opacity: 1; background: var(--lilac-400); color: var(--text-inverse); }

        /* Footer sidebar */
        #sidebar-footer {
            padding: var(--space-3) var(--space-4);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #status-badge {
            font-size: 0.7rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        /* Main content */
        #main-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-6);
            background: var(--bg-base);
        }

        .content-wrapper {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Pages */
        .page {
            display: none;
            animation: fadeIn 0.25s ease;
        }
        .page.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Intro de page */
        .page-intro {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }
        .page-intro .help-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--lilac-glow);
            color: var(--lilac-300);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .page-intro .help-icon:hover {
            background: var(--lilac-400);
            color: var(--text-inverse);
        }
        .page-intro p { flex: 1; }

        /* Cards */
        .card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-5);
            transition: border-color var(--transition-fast);
        }
        .card:focus-within {
            border-color: var(--mint-400);
        }

        .card-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .card-badge {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 100px;
            letter-spacing: 0.03em;
        }
        .badge-voir { background: var(--voir-bg); color: var(--voir); }
        .badge-juger { background: var(--juger-bg); color: var(--juger); }
        .badge-agir { background: var(--agir-bg); color: var(--agir); }

        .card-body {
            padding: var(--space-5);
        }

        /* Formulaires */
        .field {
            margin-bottom: var(--space-5);
        }
        .field:last-child { margin-bottom: 0; }

        .field label {
            display: block;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
        }

        .field input,
        .field textarea,
        .field select {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: var(--font-display);
            font-size: 0.95rem;
            transition: all var(--transition-fast);
        }
        .field input:focus,
        .field textarea:focus,
        .field select:focus {
            outline: none;
            border-color: var(--mint-400);
            box-shadow: 0 0 0 3px var(--mint-glow);
        }
        .field textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }
        .field small {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        /* Grilles */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-4); }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-4); }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-3); }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
        }

        /* Stats Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .stat-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
        }
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-2);
            font-size: 1.2rem;
        }
        .stat-value {
            font-family: var(--font-mono);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--mint-300);
            line-height: 1;
        }
        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-top: var(--space-1);
        }

        /* Score circulaire */
        .score-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto var(--space-4);
        }
        .score-ring {
            transform: rotate(-90deg);
        }
        .score-ring circle {
            fill: none;
            stroke-width: 8;
        }
        .score-ring .bg { stroke: var(--bg-surface); }
        .score-ring .fg { 
            stroke: url(#scoreGradient);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.6s ease;
        }
        .score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .score-label {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Progress bars */
        .progress-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }

        .progress-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
        }
        .progress-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .progress-bar {
            height: 6px;
            background: var(--bg-surface);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
        }
        .progress-fill.voir { background: var(--voir); }
        .progress-fill.juger { background: var(--juger); }
        .progress-fill.agir { background: var(--agir); }
        .progress-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        /* Phases cards */
        .phases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .phase-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }
        .phase-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        .phase-card.voir::before { background: var(--voir); }
        .phase-card.juger::before { background: var(--juger); }
        .phase-card.agir::before { background: var(--agir); }
        .phase-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        .phase-card.voir:hover { border-color: var(--voir); box-shadow: 0 8px 24px rgba(99, 179, 237, 0.2); }
        .phase-card.juger:hover { border-color: var(--juger); box-shadow: 0 8px 24px rgba(246, 173, 85, 0.2); }
        .phase-card.agir:hover { border-color: var(--agir); box-shadow: 0 8px 24px rgba(104, 211, 145, 0.2); }

        .phase-icon { font-size: 2rem; margin-bottom: var(--space-3); }
        .phase-name { font-weight: 700; font-size: 1.1rem; margin-bottom: var(--space-2); }
        .phase-card.voir .phase-name { color: var(--voir); }
        .phase-card.juger .phase-name { color: var(--juger); }
        .phase-card.agir .phase-name { color: var(--agir); }
        .phase-desc { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: var(--space-3); }
        .phase-tools { font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono); }

        /* Matrice pouvoir */
        .matrix-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: var(--space-4) auto;
        }
        .matrix-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 2px;
            background: var(--border-subtle);
            border-radius: var(--radius-lg);
            overflow: hidden;
            aspect-ratio: 1;
        }
        .matrix-quad {
            background: var(--bg-elevated);
            padding: var(--space-3);
            min-height: 140px;
            position: relative;
        }
        .matrix-quad-label {
            position: absolute;
            top: var(--space-2);
            left: var(--space-2);
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        .matrix-quad.q1 { background: rgba(72, 187, 120, 0.08); }
        .matrix-quad.q2 { background: rgba(246, 173, 85, 0.08); }
        .matrix-quad.q3 { background: rgba(99, 179, 237, 0.08); }
        .matrix-quad.q4 { background: rgba(160, 174, 192, 0.08); }

        .actor-chip {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: 3px 8px;
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            margin: 2px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .actor-chip.ally { border-color: var(--ally); color: var(--ally); }
        .actor-chip.neutral { border-color: var(--neutral); color: var(--neutral); }
        .actor-chip.opponent { border-color: var(--opponent); color: var(--opponent); }
        .actor-chip.target { border-color: var(--target); color: var(--target); }
        .actor-chip:hover { background: var(--bg-hover); }

        /* SWOT Grid */
        .swot-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3);
        }
        .swot-card {
            background: var(--bg-elevated);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            border-left: 3px solid;
        }
        .swot-card.forces { border-left-color: var(--success); }
        .swot-card.faiblesses { border-left-color: var(--danger); }
        .swot-card.opportunites { border-left-color: var(--info); }
        .swot-card.menaces { border-left-color: var(--warning); }
        .swot-title { font-weight: 600; font-size: 0.9rem; margin-bottom: var(--space-3); display: flex; align-items: center; gap: var(--space-2); }

        /* Liste SMART */
        .smart-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        .smart-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }
        .smart-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--mint-400);
            margin-top: 2px;
        }
        .smart-content { flex: 1; }
        .smart-text { font-size: 0.9rem; margin-bottom: var(--space-2); }
        .smart-meta { font-size: 0.75rem; color: var(--text-muted); display: flex; gap: var(--space-4); }
        .smart-item.done .smart-text { text-decoration: line-through; color: var(--text-muted); }

        /* Journal */
        .journal-timeline {
            position: relative;
            padding-left: var(--space-6);
        }
        .journal-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--mint-400), var(--lilac-400));
        }
        .journal-entry {
            position: relative;
            margin-bottom: var(--space-5);
        }
        .journal-entry::before {
            content: '';
            position: absolute;
            left: calc(-1 * var(--space-6) + 6px);
            top: 6px;
            width: 10px;
            height: 10px;
            background: var(--mint-400);
            border-radius: 50%;
            box-shadow: var(--shadow-glow-mint);
        }
        .journal-date {
            font-size: 0.7rem;
            font-family: var(--font-mono);
            color: var(--text-muted);
            margin-bottom: var(--space-1);
        }
        .journal-text {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            font-size: 0.9rem;
        }

        /* Export section */
        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-3);
        }
        .export-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .export-card:hover {
            border-color: var(--mint-400);
            transform: translateY(-2px);
        }
        .export-icon { font-size: 2rem; margin-bottom: var(--space-2); }
        .export-name { font-weight: 600; font-size: 0.9rem; }
        .export-ext { font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono); }

        /* Drop zone */
        .drop-zone {
            border: 2px dashed var(--border-default);
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .drop-zone:hover,
        .drop-zone.dragover {
            border-color: var(--mint-400);
            background: var(--mint-glow);
        }
        .drop-zone-icon { font-size: 2.5rem; margin-bottom: var(--space-3); }
        .drop-zone-text { color: var(--text-secondary); }
        .drop-zone-hint { font-size: 0.75rem; color: var(--text-muted); margin-top: var(--space-2); }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(13, 13, 20, 0.85);
            backdrop-filter: blur(4px);
            z-index: 500;
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }
        .modal-overlay.open { display: flex; }

        .modal {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.25s ease;
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            padding: var(--space-5);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .modal-title { font-weight: 600; font-size: 1.1rem; }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            border: none;
            background: var(--bg-surface);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all var(--transition-fast);
        }
        .modal-close:hover { background: var(--bg-hover); color: var(--text-primary); }
        .modal-body { padding: var(--space-5); }
        .modal-footer {
            padding: var(--space-4) var(--space-5);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            gap: var(--space-3);
            justify-content: flex-end;
        }

        /* Help tooltip non-invasif */
        .help-tooltip {
            position: fixed;
            background: var(--bg-surface);
            border: 1px solid var(--lilac-400);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            max-width: 320px;
            box-shadow: var(--shadow-lg), var(--shadow-glow-lilac);
            z-index: 600;
            display: none;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        .help-tooltip.show { display: block; animation: fadeIn 0.2s ease; }
        .help-tooltip h4 {
            color: var(--lilac-300);
            font-size: 0.9rem;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .help-tooltip p { color: var(--text-secondary); margin-bottom: var(--space-2); }
        .help-tooltip ul { margin-left: var(--space-4); color: var(--text-muted); }
        .help-tooltip li { margin-bottom: var(--space-1); }
        .help-tooltip .dismiss {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--space-3);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .help-tooltip .dismiss kbd {
            background: var(--bg-hover);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 0.7rem;
        }

        /* Toast */
        #toasts {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: 700;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        .toast {
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--space-3) var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 0.85rem;
            box-shadow: var(--shadow-md);
            animation: toastIn 0.25s ease;
            min-width: 250px;
        }
        @keyframes toastIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--danger); }
        .toast.info { border-left: 3px solid var(--info); }
        .toast.warning { border-left: 3px solid var(--warning); }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: var(--space-8);
        }
        .empty-state .icon { font-size: 4rem; margin-bottom: var(--space-4); }
        .empty-state h3 { font-size: 1.25rem; margin-bottom: var(--space-2); }
        .empty-state p { color: var(--text-muted); margin-bottom: var(--space-5); }
        .empty-state .btns { display: flex; gap: var(--space-3); justify-content: center; flex-wrap: wrap; }

        /* Templates */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-3);
            margin-top: var(--space-5);
        }
        .template-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .template-card:hover {
            border-color: var(--mint-400);
            transform: translateY(-2px);
        }
        .template-card .icon { font-size: 2rem; margin-bottom: var(--space-2); }
        .template-card .title { font-weight: 600; font-size: 0.9rem; }
        .template-card .desc { font-size: 0.75rem; color: var(--text-muted); }

        /* Menu mobile */
        @media (max-width: 1024px) {
            #main-content { padding: var(--space-4); }
            .phases-grid { grid-template-columns: 1fr; }
            .swot-grid { grid-template-columns: 1fr; }
            #toasts { left: var(--space-4); right: var(--space-4); }
        }

        /* Desktop preview panel */
        @media (min-width: 1024px) {
            #header { display: none; }
            #sidebar-overlay { display: none !important; }
            #sidebar {
                position: static;
                transform: none;
            }
            .progress-list { flex-direction: row; }
            .progress-item { flex: 1; }
        }

        /* Print */
        @media print {
            #sidebar, #header, .modal-overlay, #toasts, .btn { display: none !important; }
            #main-content { padding: 0; }
            .card { break-inside: avoid; border: 1px solid #ccc; background: #fff; color: #000; }
        }
    </style>
</head>
<body>

<div id="app">
    <!-- HEADER (Mobile) -->
    <header id="header">
        <button class="btn btn-ghost btn-icon" id="btn-menu" aria-label="Menu">‚ò∞</button>
        <div class="logo">
            <div class="logo-mark">#B!Mi</div>
        </div>
        <span id="project-title">Nouveau projet</span>
        <div class="header-actions">
            <button class="btn btn-ghost btn-icon" id="btn-search" aria-label="Rechercher">üîç</button>
            <button class="btn btn-primary btn-icon" id="btn-preview" aria-label="Aper√ßu">üëÅÔ∏è</button>
        </div>
    </header>

    <!-- SIDEBAR OVERLAY (Mobile) -->
    <div id="sidebar-overlay"></div>

    <div id="main-layout">
        <!-- SIDEBAR -->
        <nav id="sidebar" aria-label="Navigation principale">
            <div id="projects-section">
                <div class="section-label">üìÅ Mes projets</div>
                <div id="projects-list"></div>
                <div class="project-btns">
                    <button id="btn-new-project">+ Nouveau</button>
                    <button id="btn-templates">üìã Mod√®les</button>
                </div>
            </div>

            <div id="nav-section">
                <div class="nav-group">üìä G√©n√©ral</div>
                <button class="nav-btn active" data-page="dashboard">
                    <span class="icon">üìä</span>
                    <span class="label">Tableau de bord</span>
                    <span class="hint-trigger" data-help="dashboard">?</span>
                </button>

                <div class="nav-group c-voir">üëÅÔ∏è VOIR ‚Äî Analyse</div>
                <button class="nav-btn" data-page="domino">
                    <span class="icon">üéØ</span>
                    <span class="label">Vision (Domino)</span>
                    <span class="hint-trigger" data-help="domino">?</span>
                </button>
                <button class="nav-btn" data-page="profil">
                    <span class="icon">üë§</span>
                    <span class="label">Profil citoyen</span>
                    <span class="hint-trigger" data-help="profil">?</span>
                </button>
                <button class="nav-btn" data-page="fleur">
                    <span class="icon">üå∏</span>
                    <span class="label">Fleur du pouvoir</span>
                    <span class="hint-trigger" data-help="fleur">?</span>
                </button>

                <div class="nav-group c-juger">‚öñÔ∏è JUGER ‚Äî Strat√©gie</div>
                <button class="nav-btn" data-page="acteurs">
                    <span class="icon">üë•</span>
                    <span class="label">Cartographie acteurs</span>
                    <span class="hint-trigger" data-help="acteurs">?</span>
                </button>
                <button class="nav-btn" data-page="arbre">
                    <span class="icon">üå≥</span>
                    <span class="label">Arbre √† probl√®mes</span>
                    <span class="hint-trigger" data-help="arbre">?</span>
                </button>
                <button class="nav-btn" data-page="pourquoi">
                    <span class="icon">‚ùì</span>
                    <span class="label">5 Pourquoi</span>
                    <span class="hint-trigger" data-help="pourquoi">?</span>
                </button>
                <button class="nav-btn" data-page="swot">
                    <span class="icon">üìê</span>
                    <span class="label">SWOT</span>
                    <span class="hint-trigger" data-help="swot">?</span>
                </button>
                <button class="nav-btn" data-page="pestel">
                    <span class="icon">üåç</span>
                    <span class="label">PESTEL</span>
                    <span class="hint-trigger" data-help="pestel">?</span>
                </button>
                <button class="nav-btn" data-page="tdc">
                    <span class="icon">üîÑ</span>
                    <span class="label">Th√©orie du changement</span>
                    <span class="hint-trigger" data-help="tdc">?</span>
                </button>

                <div class="nav-group c-agir">‚úä AGIR ‚Äî Action</div>
                <button class="nav-btn" data-page="pouvoir">
                    <span class="icon">‚ö°</span>
                    <span class="label">Avec/Sans/Contre</span>
                    <span class="hint-trigger" data-help="pouvoir">?</span>
                </button>
                <button class="nav-btn" data-page="cibles">
                    <span class="icon">üéØ</span>
                    <span class="label">Cibles & Alli√©s</span>
                    <span class="hint-trigger" data-help="cibles">?</span>
                </button>
                <button class="nav-btn" data-page="smart">
                    <span class="icon">üìã</span>
                    <span class="label">Objectifs SMART</span>
                    <span class="hint-trigger" data-help="smart">?</span>
                </button>
                <button class="nav-btn" data-page="message">
                    <span class="icon">üí¨</span>
                    <span class="label">Message cl√©</span>
                    <span class="hint-trigger" data-help="message">?</span>
                </button>
                <button class="nav-btn" data-page="evaluation">
                    <span class="icon">üìà</span>
                    <span class="label">Suivi-√©valuation</span>
                    <span class="hint-trigger" data-help="evaluation">?</span>
                </button>
                <button class="nav-btn" data-page="journal">
                    <span class="icon">üìì</span>
                    <span class="label">Journal de bord</span>
                    <span class="hint-trigger" data-help="journal">?</span>
                </button>

                <div class="nav-group">üîß Outils</div>
                <button class="nav-btn" data-page="export">
                    <span class="icon">üíæ</span>
                    <span class="label">Import / Export</span>
                </button>
                <button class="nav-btn" data-page="ressources">
                    <span class="icon">üìö</span>
                    <span class="label">Ressources</span>
                </button>
            </div>

            <div id="sidebar-footer">
                <span id="status-badge">‚óè Pr√™t</span>
                <button class="btn btn-sm btn-ghost" id="btn-shortcuts">‚å®Ô∏è</button>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <main id="main-content">
            <div class="content-wrapper">

                <!-- PAGE: Empty -->
                <section class="page" id="p-empty">
                    <div class="empty-state">
                        <div class="icon">‚öñÔ∏è</div>
                        <h3>Bienvenue sur #B!Mi</h3>
                        <p>Cr√©ez votre premier projet de plaidoyer citoyen</p>
                        <div class="btns">
                            <button class="btn btn-primary" id="btn-empty-new">+ Nouveau projet</button>
                            <label class="btn btn-secondary" style="cursor:pointer">
                                üì• Importer
                                <input type="file" accept=".json" id="import-home" style="display:none">
                            </label>
                        </div>
                        <div class="template-grid">
                            <div class="template-card" data-tpl="blank">
                                <div class="icon">üìÑ</div>
                                <div class="title">Projet vierge</div>
                                <div class="desc">Partir de z√©ro</div>
                            </div>
                            <div class="template-card" data-tpl="arizona">
                                <div class="icon">üáßüá™</div>
                                <div class="title">Stop Arizona</div>
                                <div class="desc">Mod√®le complet</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Dashboard -->
                <section class="page active" id="p-dashboard">
                    <!-- Score global -->
                    <div class="score-container">
                        <svg class="score-ring" viewBox="0 0 100 100">
                            <defs>
                                <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#48bb78"/>
                                    <stop offset="100%" stop-color="#9f7aea"/>
                                </linearGradient>
                            </defs>
                            <circle class="bg" cx="50" cy="50" r="42"/>
                            <circle class="fg" id="score-circle" cx="50" cy="50" r="42" stroke-dasharray="264" stroke-dashoffset="264"/>
                        </svg>
                        <div class="score-value" id="score-value">0%</div>
                    </div>
                    <div class="score-label">Progression globale</div>

                    <!-- Stats rapides -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-value" id="stat-actors">0</div>
                            <div class="stat-label">Acteurs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-value" id="stat-smart">0</div>
                            <div class="stat-label">Objectifs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìì</div>
                            <div class="stat-value" id="stat-journal">0</div>
                            <div class="stat-label">Entr√©es</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-value" id="stat-fields">0</div>
                            <div class="stat-label">Champs</div>
                        </div>
                    </div>

                    <!-- Progress par phase -->
                    <div class="progress-list">
                        <div class="progress-item">
                            <div class="progress-title"><span style="color:var(--voir)">üëÅÔ∏è</span> VOIR</div>
                            <div class="progress-bar"><div class="progress-fill voir" id="progress-voir" style="width:0%"></div></div>
                            <div class="progress-meta"><span>Analyse</span><span id="progress-voir-val">0%</span></div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-title"><span style="color:var(--juger)">‚öñÔ∏è</span> JUGER</div>
                            <div class="progress-bar"><div class="progress-fill juger" id="progress-juger" style="width:0%"></div></div>
                            <div class="progress-meta"><span>Strat√©gie</span><span id="progress-juger-val">0%</span></div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-title"><span style="color:var(--agir)">‚úä</span> AGIR</div>
                            <div class="progress-bar"><div class="progress-fill agir" id="progress-agir" style="width:0%"></div></div>
                            <div class="progress-meta"><span>Action</span><span id="progress-agir-val">0%</span></div>
                        </div>
                    </div>

                    <!-- Navigation rapide -->
                    <div class="phases-grid">
                        <div class="phase-card voir" data-goto="domino">
                            <div class="phase-icon">üëÅÔ∏è</div>
                            <div class="phase-name">VOIR</div>
                            <div class="phase-desc">Analyser le contexte et identifier les acteurs</div>
                            <div class="phase-tools">3 outils</div>
                        </div>
                        <div class="phase-card juger" data-goto="acteurs">
                            <div class="phase-icon">‚öñÔ∏è</div>
                            <div class="phase-name">JUGER</div>
                            <div class="phase-desc">R√©flexion critique et √©laboration strat√©gique</div>
                            <div class="phase-tools">6 outils</div>
                        </div>
                        <div class="phase-card agir" data-goto="smart">
                            <div class="phase-icon">‚úä</div>
                            <div class="phase-name">AGIR</div>
                            <div class="phase-desc">Actions concr√®tes et suivi de l'impact</div>
                            <div class="phase-tools">6 outils</div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Domino (Vision) -->
                <section class="page" id="p-domino">
                    <div class="page-intro">
                        <span class="help-icon" data-help="domino">?</span>
                        <p>Le <strong>Domino du changement</strong> clarifie votre vision, identifie les obstacles et recense vos ressources.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üéØ Vision du changement <span class="card-badge badge-voir">VOIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Quel changement voulez-vous voir ?</label>
                                <textarea data-field="domino.vision" placeholder="D√©crivez pr√©cis√©ment le changement souhait√©..."></textarea>
                                <small>Soyez concret : qui, quoi, quand, comment ?</small>
                            </div>
                            <div class="field">
                                <label>Quels sont les obstacles ?</label>
                                <textarea data-field="domino.obstacles" placeholder="Freins politiques, administratifs, culturels..."></textarea>
                            </div>
                            <div class="field">
                                <label>Quelles sont vos ressources ?</label>
                                <textarea data-field="domino.ressources" placeholder="Forces, alli√©s, comp√©tences, leviers..."></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Profil -->
                <section class="page" id="p-profil">
                    <div class="page-intro">
                        <span class="help-icon" data-help="profil">?</span>
                        <p>Votre <strong>profil d'engagement</strong> : motivations, comp√©tences, disponibilit√© et limites.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üë§ Profil citoyen <span class="card-badge badge-voir">VOIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Motivations</label>
                                <textarea data-field="profil.motivations" placeholder="Pourquoi vous engagez-vous ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Comp√©tences</label>
                                <textarea data-field="profil.competences" placeholder="Analyse, communication, juridique..."></textarea>
                            </div>
                            <div class="field">
                                <label>Disponibilit√©</label>
                                <textarea data-field="profil.temps" placeholder="Temps, pics d'activit√©, horizon..."></textarea>
                            </div>
                            <div class="field">
                                <label>Limites et contraintes</label>
                                <textarea data-field="profil.limites" placeholder="Contraintes financi√®res, risques..."></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Fleur -->
                <section class="page" id="p-fleur">
                    <div class="page-intro">
                        <span class="help-icon" data-help="fleur">?</span>
                        <p>La <strong>Fleur du pouvoir</strong> analyse les identit√©s, privil√®ges et oppressions en jeu.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üå∏ Fleur du pouvoir <span class="card-badge badge-voir">VOIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Identit√©s des personnes concern√©es</label>
                                <textarea data-field="fleur.identites" placeholder="Qui sont les personnes touch√©es ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Privil√®ges relatifs</label>
                                <textarea data-field="fleur.privileges" placeholder="Acc√®s √† l'information, capital social..."></textarea>
                            </div>
                            <div class="field">
                                <label>Discriminations et violences</label>
                                <textarea data-field="fleur.oppressions" placeholder="Violences symboliques, administratives..."></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Acteurs -->
                <section class="page" id="p-acteurs">
                    <div class="page-intro">
                        <span class="help-icon" data-help="acteurs">?</span>
                        <p>La <strong>cartographie des acteurs</strong> identifie les parties prenantes selon leur pouvoir et leur position.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ûï Ajouter un acteur <span class="card-badge badge-juger">JUGER</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="grid-2">
                                <div class="field">
                                    <label>Nom</label>
                                    <input type="text" id="actor-name" placeholder="Ex: Ministre X">
                                </div>
                                <div class="field">
                                    <label>R√¥le / Fonction</label>
                                    <input type="text" id="actor-role" placeholder="Ex: D√©cideur cl√©">
                                </div>
                            </div>
                            <div class="grid-3">
                                <div class="field">
                                    <label>Position</label>
                                    <select id="actor-position">
                                        <option value="ally">üü¢ Alli√©</option>
                                        <option value="target">üü° Cible</option>
                                        <option value="opponent">üî¥ Opposant</option>
                                        <option value="neutral">‚ö™ Neutre</option>
                                    </select>
                                </div>
                                <div class="field">
                                    <label>Pouvoir (1-5)</label>
                                    <select id="actor-power">
                                        <option value="1">1 - Faible</option>
                                        <option value="2">2</option>
                                        <option value="3" selected>3 - Moyen</option>
                                        <option value="4">4</option>
                                        <option value="5">5 - √âlev√©</option>
                                    </select>
                                </div>
                                <div class="field" style="display:flex;align-items:flex-end;">
                                    <button class="btn btn-primary" id="btn-add-actor" style="width:100%">‚ûï Ajouter</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìä Matrice Pouvoir / Int√©r√™t</h3>
                        </div>
                        <div class="card-body">
                            <div class="matrix-container">
                                <div class="matrix-grid">
                                    <div class="matrix-quad q1" id="quad-manage">
                                        <span class="matrix-quad-label">G√©rer de pr√®s</span>
                                        <div id="actors-q1"></div>
                                    </div>
                                    <div class="matrix-quad q2" id="quad-satisfy">
                                        <span class="matrix-quad-label">Garder satisfait</span>
                                        <div id="actors-q2"></div>
                                    </div>
                                    <div class="matrix-quad q3" id="quad-inform">
                                        <span class="matrix-quad-label">Garder inform√©</span>
                                        <div id="actors-q3"></div>
                                    </div>
                                    <div class="matrix-quad q4" id="quad-monitor">
                                        <span class="matrix-quad-label">Surveiller</span>
                                        <div id="actors-q4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìã Liste des acteurs (<span id="actors-count">0</span>)</h3>
                        </div>
                        <div class="card-body">
                            <div id="actors-list"></div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Arbre -->
                <section class="page" id="p-arbre">
                    <div class="page-intro">
                        <span class="help-icon" data-help="arbre">?</span>
                        <p>L'<strong>arbre √† probl√®mes</strong> identifie le probl√®me central, ses causes (racines) et cons√©quences (branches).</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üå≥ Arbre √† probl√®mes <span class="card-badge badge-juger">JUGER</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Probl√®me central</label>
                                <textarea data-field="arbre.probleme" placeholder="Le probl√®me principal..."></textarea>
                            </div>
                            <div class="field">
                                <label>Causes (racines)</label>
                                <textarea data-field="arbre.causes" placeholder="Pourquoi ce probl√®me existe ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Cons√©quences (branches)</label>
                                <textarea data-field="arbre.consequences" placeholder="Quels effets produit-il ?"></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: 5 Pourquoi -->
                <section class="page" id="p-pourquoi">
                    <div class="page-intro">
                        <span class="help-icon" data-help="pourquoi">?</span>
                        <p>Les <strong>5 Pourquoi</strong> permettent de remonter aux causes profondes d'un probl√®me.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ùì Les 5 Pourquoi <span class="card-badge badge-juger">JUGER</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field"><label>Pourquoi 1 ?</label><textarea data-field="pourquoi.p1" placeholder="Premier niveau..."></textarea></div>
                            <div class="field"><label>Pourquoi 2 ?</label><textarea data-field="pourquoi.p2" placeholder="Creusons..."></textarea></div>
                            <div class="field"><label>Pourquoi 3 ?</label><textarea data-field="pourquoi.p3" placeholder="Plus profond..."></textarea></div>
                            <div class="field"><label>Pourquoi 4 ?</label><textarea data-field="pourquoi.p4" placeholder="Encore..."></textarea></div>
                            <div class="field"><label>Pourquoi 5 ? (cause racine)</label><textarea data-field="pourquoi.p5" placeholder="La cause fondamentale..."></textarea></div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: SWOT -->
                <section class="page" id="p-swot">
                    <div class="page-intro">
                        <span class="help-icon" data-help="swot">?</span>
                        <p>L'analyse <strong>SWOT</strong> √©value les forces, faiblesses, opportunit√©s et menaces.</p>
                    </div>

                    <div class="swot-grid">
                        <div class="swot-card forces">
                            <div class="swot-title">üí™ Forces</div>
                            <div class="field"><textarea data-field="swot.forces" placeholder="Vos atouts internes..."></textarea></div>
                        </div>
                        <div class="swot-card faiblesses">
                            <div class="swot-title">‚ö†Ô∏è Faiblesses</div>
                            <div class="field"><textarea data-field="swot.faiblesses" placeholder="Vos limites internes..."></textarea></div>
                        </div>
                        <div class="swot-card opportunites">
                            <div class="swot-title">üåü Opportunit√©s</div>
                            <div class="field"><textarea data-field="swot.opportunites" placeholder="Contexte externe favorable..."></textarea></div>
                        </div>
                        <div class="swot-card menaces">
                            <div class="swot-title">üå©Ô∏è Menaces</div>
                            <div class="field"><textarea data-field="swot.menaces" placeholder="Risques externes..."></textarea></div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: PESTEL -->
                <section class="page" id="p-pestel">
                    <div class="page-intro">
                        <span class="help-icon" data-help="pestel">?</span>
                        <p>L'analyse <strong>PESTEL</strong> examine l'environnement macro : Politique, √âconomique, Social, Technologique, Environnemental, L√©gal.</p>
                    </div>

                    <div class="grid-2">
                        <div class="card"><div class="card-body"><div class="field"><label>üèõÔ∏è Politique</label><textarea data-field="pestel.p" placeholder="..."></textarea></div></div></div>
                        <div class="card"><div class="card-body"><div class="field"><label>üí∞ √âconomique</label><textarea data-field="pestel.e" placeholder="..."></textarea></div></div></div>
                        <div class="card"><div class="card-body"><div class="field"><label>üë• Social</label><textarea data-field="pestel.s" placeholder="..."></textarea></div></div></div>
                        <div class="card"><div class="card-body"><div class="field"><label>üíª Technologique</label><textarea data-field="pestel.t" placeholder="..."></textarea></div></div></div>
                        <div class="card"><div class="card-body"><div class="field"><label>üåø Environnemental</label><textarea data-field="pestel.en" placeholder="..."></textarea></div></div></div>
                        <div class="card"><div class="card-body"><div class="field"><label>‚öñÔ∏è L√©gal</label><textarea data-field="pestel.l" placeholder="..."></textarea></div></div></div>
                    </div>
                </section>

                <!-- PAGE: Th√©orie du changement -->
                <section class="page" id="p-tdc">
                    <div class="page-intro">
                        <span class="help-icon" data-help="tdc">?</span>
                        <p>La <strong>th√©orie du changement</strong> d√©crit comment et pourquoi le changement va advenir.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üîÑ Th√©orie du changement <span class="card-badge badge-juger">JUGER</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Situation actuelle</label>
                                <textarea data-field="tdc.actuelle" placeholder="O√π en sommes-nous ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Situation souhait√©e</label>
                                <textarea data-field="tdc.souhaitee" placeholder="O√π voulons-nous aller ?"></textarea>
                            </div>
                            <div class="field">
                                <label>M√©canismes de changement</label>
                                <textarea data-field="tdc.mecanismes" placeholder="Comment le changement va-t-il se produire ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Hypoth√®ses cl√©s</label>
                                <textarea data-field="tdc.hypotheses" placeholder="Quelles sont nos hypoth√®ses ?"></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Pouvoir (Avec/Sans/Contre) -->
                <section class="page" id="p-pouvoir">
                    <div class="page-intro">
                        <span class="help-icon" data-help="pouvoir">?</span>
                        <p>Les <strong>modes d'action</strong> : travailler avec, sans ou contre le pouvoir en place.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ö° Modes d'action <span class="card-badge badge-agir">AGIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>ü§ù Avec le pouvoir</label>
                                <textarea data-field="pouvoir.avec" placeholder="Lobbying, n√©gociation, partenariats..."></textarea>
                            </div>
                            <div class="field">
                                <label>üîÑ Sans le pouvoir</label>
                                <textarea data-field="pouvoir.sans" placeholder="Alternatives, projets pilotes..."></textarea>
                            </div>
                            <div class="field">
                                <label>‚úä Contre le pouvoir</label>
                                <textarea data-field="pouvoir.contre" placeholder="Mobilisation, recours juridiques..."></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Cibles & Alli√©s -->
                <section class="page" id="p-cibles">
                    <div class="page-intro">
                        <span class="help-icon" data-help="cibles">?</span>
                        <p>Identifiez vos <strong>cibles</strong> (qui doit changer) et vos <strong>alli√©s</strong> strat√©giques.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üéØ Cibles & Alli√©s <span class="card-badge badge-agir">AGIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Cibles principales</label>
                                <textarea data-field="cibles.principales" placeholder="Qui a le pouvoir de d√©cider ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Cibles secondaires</label>
                                <textarea data-field="cibles.secondaires" placeholder="Qui peut influencer les cibles principales ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Alli√©s strat√©giques</label>
                                <textarea data-field="cibles.allies" placeholder="Avec qui s'allier ?"></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: SMART -->
                <section class="page" id="p-smart">
                    <div class="page-intro">
                        <span class="help-icon" data-help="smart">?</span>
                        <p>Les objectifs <strong>SMART</strong> : Sp√©cifiques, Mesurables, Atteignables, R√©alistes, Temporels.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ûï Nouvel objectif <span class="card-badge badge-agir">AGIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Objectif</label>
                                <input type="text" id="smart-text" placeholder="Ex: Obtenir un moratoire...">
                            </div>
                            <div class="grid-2">
                                <div class="field">
                                    <label>Indicateur de mesure</label>
                                    <input type="text" id="smart-indicator" placeholder="Comment mesurer le succ√®s ?">
                                </div>
                                <div class="field">
                                    <label>√âch√©ance</label>
                                    <input type="date" id="smart-deadline">
                                </div>
                            </div>
                            <button class="btn btn-primary" id="btn-add-smart">‚ûï Ajouter l'objectif</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìã Objectifs (<span id="smart-count">0</span>)</h3>
                        </div>
                        <div class="card-body">
                            <div class="smart-list" id="smart-list"></div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Message -->
                <section class="page" id="p-message">
                    <div class="page-intro">
                        <span class="help-icon" data-help="message">?</span>
                        <p>Construisez votre <strong>message cl√©</strong> : accroche, probl√®me, solution, appel √† l'action.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üí¨ Message cl√© <span class="card-badge badge-agir">AGIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Accroche</label>
                                <input type="text" data-field="message.accroche" placeholder="Une phrase choc...">
                            </div>
                            <div class="field">
                                <label>Probl√®me</label>
                                <textarea data-field="message.probleme" placeholder="Quel est le probl√®me ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Pourquoi c'est important</label>
                                <textarea data-field="message.importance" placeholder="Pourquoi agir maintenant ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Cible du message</label>
                                <input type="text" data-field="message.cible" placeholder="√Ä qui s'adresse-t-on ?">
                            </div>
                            <div class="field">
                                <label>Action demand√©e</label>
                                <textarea data-field="message.action" placeholder="Que demandez-vous concr√®tement ?"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìù Aper√ßu du message</h3>
                        </div>
                        <div class="card-body">
                            <div id="message-preview" style="background:var(--bg-surface);padding:var(--space-4);border-radius:var(--radius-md);font-size:0.9rem;line-height:1.7;white-space:pre-wrap;"></div>
                            <button class="btn btn-secondary" id="btn-copy-message" style="margin-top:var(--space-3);">üìã Copier le message</button>
                        </div>
                    </div>
                </section>

                <!-- PAGE: √âvaluation -->
                <section class="page" id="p-evaluation">
                    <div class="page-intro">
                        <span class="help-icon" data-help="evaluation">?</span>
                        <p>Le <strong>suivi-√©valuation</strong> mesure l'impact de vos actions.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìà Suivi-√©valuation <span class="card-badge badge-agir">AGIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Indicateurs de succ√®s</label>
                                <textarea data-field="evaluation.indicateurs" placeholder="Comment mesurer l'impact ?"></textarea>
                            </div>
                            <div class="field">
                                <label>M√©thodes de collecte</label>
                                <textarea data-field="evaluation.methodes" placeholder="Comment collecter les donn√©es ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Calendrier d'√©valuation</label>
                                <textarea data-field="evaluation.calendrier" placeholder="Quand √©valuer ?"></textarea>
                            </div>
                            <div class="field">
                                <label>Le√ßons √† documenter</label>
                                <textarea data-field="evaluation.lecons" placeholder="Quoi apprendre pour la suite ?"></textarea>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Journal -->
                <section class="page" id="p-journal">
                    <div class="page-intro">
                        <span class="help-icon" data-help="journal">?</span>
                        <p>Le <strong>journal de bord</strong> documente votre parcours militant.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ûï Nouvelle entr√©e <span class="card-badge badge-agir">AGIR</span></h3>
                        </div>
                        <div class="card-body">
                            <div class="field">
                                <label>Date</label>
                                <input type="date" id="journal-date">
                            </div>
                            <div class="field">
                                <label>Contenu</label>
                                <textarea id="journal-content" placeholder="√âv√©nement, r√©flexion, le√ßon..."></textarea>
                            </div>
                            <button class="btn btn-primary" id="btn-add-journal">‚ûï Ajouter</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìì Entr√©es (<span id="journal-count">0</span>)</h3>
                        </div>
                        <div class="card-body">
                            <div class="journal-timeline" id="journal-list"></div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Export -->
                <section class="page" id="p-export">
                    <div class="page-intro">
                        <p>Importez ou exportez votre projet dans diff√©rents formats.</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üì§ Exporter</h3>
                        </div>
                        <div class="card-body">
                            <div class="export-grid">
                                <div class="export-card" data-export="json">
                                    <div class="export-icon">üìã</div>
                                    <div class="export-name">JSON</div>
                                    <div class="export-ext">.json</div>
                                </div>
                                <div class="export-card" data-export="md">
                                    <div class="export-icon">üìù</div>
                                    <div class="export-name">Markdown</div>
                                    <div class="export-ext">.md</div>
                                </div>
                                <div class="export-card" data-export="html">
                                    <div class="export-icon">üåê</div>
                                    <div class="export-name">HTML</div>
                                    <div class="export-ext">.html</div>
                                </div>
                                <div class="export-card" data-export="csv">
                                    <div class="export-icon">üìä</div>
                                    <div class="export-name">CSV</div>
                                    <div class="export-ext">.csv</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üì• Importer</h3>
                        </div>
                        <div class="card-body">
                            <div class="drop-zone" id="drop-zone">
                                <div class="drop-zone-icon">üìÅ</div>
                                <div class="drop-zone-text">Glissez un fichier ou cliquez</div>
                                <div class="drop-zone-hint">Formats accept√©s : JSON</div>
                                <input type="file" id="import-file" accept=".json" style="display:none">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PAGE: Ressources -->
                <section class="page" id="p-ressources">
                    <div class="page-intro">
                        <p>Guides m√©thodologiques et ressources pour approfondir.</p>
                    </div>

                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">üìñ Guides</h3></div>
                            <div class="card-body">
                                <ul style="list-style:none;">
                                    <li style="margin-bottom:var(--space-3);"><a href="https://www.justicepaix.be" target="_blank" style="color:var(--mint-300);">üîó Justice et Paix ‚Äî Guide du Plaidoyer</a></li>
                                    <li style="margin-bottom:var(--space-3);"><a href="https://www.voxpublic.org" target="_blank" style="color:var(--mint-300);">üîó VoxPublic</a></li>
                                    <li><a href="https://bond.org.uk/resources/advocacy-toolkit/" target="_blank" style="color:var(--mint-300);">üîó BOND UK ‚Äî Advocacy Toolkit</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">üèõÔ∏è Institutions BE</h3></div>
                            <div class="card-body">
                                <ul style="list-style:none;">
                                    <li style="margin-bottom:var(--space-3);"><a href="https://www.lachambre.be" target="_blank" style="color:var(--lilac-300);">üîó Chambre des Repr√©sentants</a></li>
                                    <li style="margin-bottom:var(--space-3);"><a href="https://www.senate.be" target="_blank" style="color:var(--lilac-300);">üîó S√©nat</a></li>
                                    <li><a href="https://www.belgium.be" target="_blank" style="color:var(--lilac-300);">üîó Belgium.be</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>
</div>

<!-- MODALS -->

<!-- Modal: Nouveau projet -->
<div class="modal-overlay" id="modal-create">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">‚ú® Nouveau projet</h3>
            <button class="modal-close" data-close="modal-create">√ó</button>
        </div>
        <div class="modal-body">
            <div class="field">
                <label>Nom du projet</label>
                <input type="text" id="create-name" placeholder="Ex: Campagne logement 2026">
            </div>
            <div class="field">
                <label>Description (optionnel)</label>
                <textarea id="create-desc" placeholder="En quelques mots..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-ghost" data-close="modal-create">Annuler</button>
            <button class="btn btn-primary" id="btn-create-confirm">Cr√©er</button>
        </div>
    </div>
</div>

<!-- Modal: Recherche -->
<div class="modal-overlay" id="modal-search">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">üîç Rechercher</h3>
            <button class="modal-close" data-close="modal-search">√ó</button>
        </div>
        <div class="modal-body">
            <div class="field">
                <input type="text" id="search-input" placeholder="Tapez votre recherche...">
            </div>
            <div id="search-results"></div>
        </div>
    </div>
</div>

<!-- Modal: Raccourcis -->
<div class="modal-overlay" id="modal-shortcuts">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">‚å®Ô∏è Raccourcis clavier</h3>
            <button class="modal-close" data-close="modal-shortcuts">√ó</button>
        </div>
        <div class="modal-body">
            <table style="width:100%;font-size:0.85rem;">
                <tr><td style="padding:var(--space-2);"><kbd style="background:var(--bg-surface);padding:2px 8px;border-radius:4px;">Ctrl</kbd> + <kbd style="background:var(--bg-surface);padding:2px 8px;border-radius:4px;">K</kbd></td><td>Rechercher</td></tr>
                <tr><td style="padding:var(--space-2);"><kbd style="background:var(--bg-surface);padding:2px 8px;border-radius:4px;">Ctrl</kbd> + <kbd style="background:var(--bg-surface);padding:2px 8px;border-radius:4px;">S</kbd></td><td>Sauvegarder</td></tr>
                <tr><td style="padding:var(--space-2);"><kbd style="background:var(--bg-surface);padding:2px 8px;border-radius:4px;">Esc</kbd></td><td>Fermer</td></tr>
            </table>
        </div>
    </div>
</div>

<!-- Help Tooltip -->
<div class="help-tooltip" id="help-tooltip">
    <h4><span id="help-title"></span></h4>
    <div id="help-content"></div>
    <div class="dismiss">Cliquez ailleurs ou <kbd>Esc</kbd> pour fermer</div>
</div>

<!-- Toasts -->
<div id="toasts"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// #B!Mi PLAIDOYER CITOYEN ‚Äî ULTIMATE v4.0
// IndexedDB + LocalStorage fallback ‚Ä¢ Multi-projets ‚Ä¢ 15 outils
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const $ = id => document.getElementById(id);
const $$ = sel => document.querySelectorAll(sel);
const esc = s => s ? s.replace(/</g, '&lt;').replace(/>/g, '&gt;') : '';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELP CONTENT ‚Äî Non-invasif, adulte
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const HELP = {
    dashboard: { title: 'üìä Tableau de bord', content: '<p>Vue d\'ensemble de votre projet : progression par phase, statistiques cl√©s.</p><p>Les pourcentages refl√®tent le remplissage des champs de chaque section.</p>' },
    domino: { title: 'üéØ Le Domino du changement', content: '<p>Outil de clarification strat√©gique.</p><ul><li><strong>Vision</strong> : le changement concret souhait√©</li><li><strong>Obstacles</strong> : freins identifi√©s</li><li><strong>Ressources</strong> : forces mobilisables</li></ul>' },
    profil: { title: 'üë§ Profil d\'engagement', content: '<p>Faites le point sur vos motivations, comp√©tences et limites. Essentiel pour calibrer votre engagement sur la dur√©e.</p>' },
    fleur: { title: 'üå∏ Fleur du pouvoir', content: '<p>Analyse des rapports de pouvoir : qui sont les personnes concern√©es ? Quels privil√®ges et quelles oppressions sont en jeu ?</p>' },
    acteurs: { title: 'üë• Cartographie des acteurs', content: '<p>Identifiez toutes les parties prenantes. La matrice Pouvoir/Int√©r√™t aide √† prioriser vos interactions.</p><ul><li><strong>Q1</strong> : Pouvoir √©lev√© + Int√©r√™t ‚Üí G√©rer de pr√®s</li><li><strong>Q2</strong> : Pouvoir √©lev√© + Peu d\'int√©r√™t ‚Üí Garder satisfait</li><li><strong>Q3</strong> : Pouvoir faible + Int√©r√™t ‚Üí Garder inform√©</li><li><strong>Q4</strong> : Pouvoir faible + Peu d\'int√©r√™t ‚Üí Surveiller</li></ul>' },
    arbre: { title: 'üå≥ Arbre √† probl√®mes', content: '<p>M√©thode visuelle : le tronc = probl√®me central, les racines = causes, les branches = cons√©quences.</p>' },
    pourquoi: { title: '‚ùì Les 5 Pourquoi', content: '<p>Technique simple pour remonter aux causes profondes. √Ä chaque r√©ponse, demandez "pourquoi ?" jusqu\'√† atteindre la cause racine.</p>' },
    swot: { title: 'üìê Analyse SWOT', content: '<p>Matrice classique : <strong>S</strong>trengths (forces), <strong>W</strong>eaknesses (faiblesses), <strong>O</strong>pportunities (opportunit√©s), <strong>T</strong>hreats (menaces).</p>' },
    pestel: { title: 'üåç Analyse PESTEL', content: '<p>Balayage de l\'environnement macro : <strong>P</strong>olitique, <strong>E</strong>conomique, <strong>S</strong>ocial, <strong>T</strong>echnologique, <strong>E</strong>nvironnemental, <strong>L</strong>√©gal.</p>' },
    tdc: { title: 'üîÑ Th√©orie du changement', content: '<p>Explicitez le "comment" : de la situation actuelle √† la situation souhait√©e, quels m√©canismes et hypoth√®ses ?</p>' },
    pouvoir: { title: '‚ö° Avec/Sans/Contre', content: '<p>Trois postures strat√©giques :</p><ul><li><strong>Avec</strong> : collaboration, lobbying</li><li><strong>Sans</strong> : alternatives parall√®les</li><li><strong>Contre</strong> : opposition, mobilisation</li></ul>' },
    cibles: { title: 'üéØ Cibles & Alli√©s', content: '<p>Qui a le pouvoir de d√©cision (cible principale) ? Qui peut l\'influencer (cible secondaire) ? Avec qui s\'allier ?</p>' },
    smart: { title: 'üìã Objectifs SMART', content: '<p><strong>S</strong>p√©cifique, <strong>M</strong>esurable, <strong>A</strong>tteignable, <strong>R</strong>√©aliste, <strong>T</strong>emporel. Chaque objectif doit r√©pondre √† ces 5 crit√®res.</p>' },
    message: { title: 'üí¨ Message cl√©', content: '<p>Structure classique : accroche ‚Üí probl√®me ‚Üí importance ‚Üí cible ‚Üí action demand√©e. Court, m√©morable, actionnable.</p>' },
    evaluation: { title: 'üìà Suivi-√©valuation', content: '<p>D√©finissez vos indicateurs de succ√®s, comment les collecter, et √† quel rythme √©valuer. Documentez les le√ßons apprises.</p>' },
    journal: { title: 'üìì Journal de bord', content: '<p>Chronique de votre parcours militant : √©v√©nements, r√©flexions, victoires et √©checs. Pr√©cieux pour la m√©moire collective.</p>' }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATABASE ‚Äî IndexedDB avec fallback localStorage
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let db = null;
const DB_NAME = 'BimiPlaidoyerDB';
const DB_VERSION = 1;
const STORE_NAME = 'projects';

function openDB() {
    return new Promise((resolve, reject) => {
        if (!window.indexedDB) {
            console.warn('IndexedDB non disponible, fallback localStorage');
            resolve(null);
            return;
        }
        const req = indexedDB.open(DB_NAME, DB_VERSION);
        req.onerror = () => { console.warn('IndexedDB error, fallback localStorage'); resolve(null); };
        req.onsuccess = () => { db = req.result; resolve(db); };
        req.onupgradeneeded = (e) => {
            const d = e.target.result;
            if (!d.objectStoreNames.contains(STORE_NAME)) {
                d.createObjectStore(STORE_NAME, { keyPath: 'id' });
            }
        };
    });
}

async function dbGetAll() {
    if (db) {
        return new Promise((resolve) => {
            const tx = db.transaction(STORE_NAME, 'readonly');
            const store = tx.objectStore(STORE_NAME);
            const req = store.getAll();
            req.onsuccess = () => resolve(req.result || []);
            req.onerror = () => resolve([]);
        });
    }
    // Fallback localStorage
    try {
        const data = localStorage.getItem('bimi_projects');
        return data ? JSON.parse(data) : [];
    } catch { return []; }
}

async function dbGet(id) {
    if (db) {
        return new Promise((resolve) => {
            const tx = db.transaction(STORE_NAME, 'readonly');
            const req = tx.objectStore(STORE_NAME).get(id);
            req.onsuccess = () => resolve(req.result);
            req.onerror = () => resolve(null);
        });
    }
    const all = await dbGetAll();
    return all.find(p => p.id === id);
}

async function dbPut(project) {
    if (db) {
        return new Promise((resolve) => {
            const tx = db.transaction(STORE_NAME, 'readwrite');
            tx.objectStore(STORE_NAME).put(project);
            tx.oncomplete = () => resolve(true);
            tx.onerror = () => resolve(false);
        });
    }
    // Fallback localStorage
    try {
        const all = await dbGetAll();
        const idx = all.findIndex(p => p.id === project.id);
        if (idx >= 0) all[idx] = project; else all.push(project);
        localStorage.setItem('bimi_projects', JSON.stringify(all));
        return true;
    } catch { return false; }
}

async function dbDelete(id) {
    if (db) {
        return new Promise((resolve) => {
            const tx = db.transaction(STORE_NAME, 'readwrite');
            tx.objectStore(STORE_NAME).delete(id);
            tx.oncomplete = () => resolve(true);
        });
    }
    try {
        const all = await dbGetAll();
        const filtered = all.filter(p => p.id !== id);
        localStorage.setItem('bimi_projects', JSON.stringify(filtered));
        return true;
    } catch { return false; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROJECT MODEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let P = null; // Current project
let saveTimeout = null;

function newProject(name, desc = '') {
    return {
        id: Date.now().toString(),
        meta: { name, description: desc, created: new Date().toISOString(), updated: new Date().toISOString() },
        domino: {}, profil: {}, fleur: {},
        acteurs: [], arbre: {}, pourquoi: {},
        swot: {}, pestel: {}, tdc: {},
        pouvoir: {}, cibles: {}, message: {},
        evaluation: {}, smart: [], journal: []
    };
}

function scheduleSave() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(async () => {
        if (P) {
            P.meta.updated = new Date().toISOString();
            await dbPut(P);
            $('status-badge').textContent = '‚óè Sauvegard√©';
            setTimeout(() => $('status-badge').textContent = '‚óè Pr√™t', 1500);
        }
    }, 800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI ‚Äî Navigation & Pages
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showPage(pageId) {
    $$('.page').forEach(p => p.classList.remove('active'));
    const page = $(`p-${pageId}`);
    if (page) page.classList.add('active');
    
    $$('.nav-btn').forEach(b => b.classList.remove('active'));
    const btn = document.querySelector(`.nav-btn[data-page="${pageId}"]`);
    if (btn) btn.classList.add('active');
    
    // Fermer sidebar mobile
    $('sidebar').classList.remove('open');
    $('sidebar-overlay').classList.remove('open');
}

function openModal(id) {
    $(id)?.classList.add('open');
}

function closeModal(id) {
    $(id)?.classList.remove('open');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI ‚Äî Projects List
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function renderProjects() {
    const projects = await dbGetAll();
    const list = $('projects-list');
    
    if (!projects.length) {
        list.innerHTML = '<div style="color:var(--text-muted);font-size:0.8rem;padding:var(--space-2);">Aucun projet</div>';
        return;
    }
    
    list.innerHTML = projects.map(p => `
        <div class="project-row ${P && P.id === p.id ? 'selected' : ''}" data-id="${p.id}">
            <span class="name">${esc(p.meta?.name || 'Sans nom')}</span>
            <div class="actions">
                <button class="dup" title="Dupliquer">üìã</button>
                <button class="del" title="Supprimer">üóëÔ∏è</button>
            </div>
        </div>
    `).join('');
    
    // Events
    list.querySelectorAll('.project-row').forEach(row => {
        row.addEventListener('click', (e) => {
            if (e.target.classList.contains('del')) {
                if (confirm('Supprimer ce projet ?')) {
                    dbDelete(row.dataset.id).then(() => {
                        if (P && P.id === row.dataset.id) { P = null; showPage('empty'); }
                        renderProjects();
                        toast('Projet supprim√©', 'info');
                    });
                }
            } else if (e.target.classList.contains('dup')) {
                dbGet(row.dataset.id).then(async (orig) => {
                    if (orig) {
                        const copy = JSON.parse(JSON.stringify(orig));
                        copy.id = Date.now().toString();
                        copy.meta.name += ' (copie)';
                        copy.meta.created = new Date().toISOString();
                        await dbPut(copy);
                        await selectProject(copy.id);
                        toast('Projet dupliqu√©', 'success');
                    }
                });
            } else {
                selectProject(row.dataset.id);
            }
        });
    });
}

async function selectProject(id) {
    P = await dbGet(id);
    if (!P) return;
    
    await renderProjects();
    $('project-title').textContent = P.meta?.name || 'Projet';
    
    // Restore ALL fields from project data
    $$('[data-field]').forEach(el => {
        const parts = el.dataset.field.split('.');
        if (parts.length === 2) {
            const [section, key] = parts;
            const value = P[section]?.[key] || '';
            el.value = value;
        }
    });
    
    // Debug: log loaded data
    console.log('Project loaded:', {
        name: P.meta?.name,
        domino: P.domino,
        acteurs: P.acteurs?.length,
        swot: P.swot,
        message: P.message
    });
    
    renderActors();
    renderSmart();
    renderJournal();
    updateStats();
    updateMessagePreview();
    
    showPage('dashboard');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTORS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function addActor() {
    if (!P) return toast('Cr√©ez d\'abord un projet', 'warning');
    
    const name = $('actor-name').value.trim();
    if (!name) return toast('Entrez un nom', 'error');
    
    P.acteurs = P.acteurs || [];
    P.acteurs.push({
        id: Date.now(),
        name,
        role: $('actor-role').value.trim(),
        position: $('actor-position').value,
        power: parseInt($('actor-power').value)
    });
    
    $('actor-name').value = '';
    $('actor-role').value = '';
    
    renderActors();
    scheduleSave();
    toast('Acteur ajout√©', 'success');
}

function renderActors() {
    if (!P) return;
    P.acteurs = P.acteurs || [];
    
    // Clear quadrants
    ['q1', 'q2', 'q3', 'q4'].forEach(q => $(`actors-${q}`).innerHTML = '');
    
    P.acteurs.forEach(a => {
        const chip = document.createElement('span');
        chip.className = `actor-chip ${a.position}`;
        chip.textContent = a.name;
        chip.title = a.role || '';
        chip.onclick = () => {
            if (confirm(`Supprimer ${a.name} ?`)) {
                P.acteurs = P.acteurs.filter(x => x.id !== a.id);
                renderActors();
                scheduleSave();
            }
        };
        
        // Quadrant logic
        const highPower = a.power >= 4;
        const interested = a.position === 'ally' || a.position === 'target';
        let quadrant = 'q4';
        if (highPower && interested) quadrant = 'q1';
        else if (highPower && !interested) quadrant = 'q2';
        else if (!highPower && interested) quadrant = 'q3';
        
        $(`actors-${quadrant}`).appendChild(chip);
    });
    
    // List
    const list = $('actors-list');
    if (!P.acteurs.length) {
        list.innerHTML = '<div style="color:var(--text-muted);text-align:center;padding:var(--space-4);">Aucun acteur</div>';
    } else {
        list.innerHTML = P.acteurs.map(a => {
            const colors = { ally: 'var(--ally)', opponent: 'var(--opponent)', target: 'var(--target)', neutral: 'var(--neutral)' };
            return `<div style="display:flex;justify-content:space-between;align-items:center;padding:var(--space-2) 0;border-bottom:1px solid var(--border-subtle);font-size:0.85rem;">
                <div><strong>${esc(a.name)}</strong> <span style="color:var(--text-muted);">‚Äî ${esc(a.role || '')}</span></div>
                <span style="color:${colors[a.position] || colors.neutral}">‚óè</span>
            </div>`;
        }).join('');
    }
    
    $('actors-count').textContent = P.acteurs.length;
    updateStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SMART Objectives
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function addSmart() {
    if (!P) return toast('Cr√©ez d\'abord un projet', 'warning');
    
    const text = $('smart-text').value.trim();
    if (!text) return toast('Entrez un objectif', 'error');
    
    P.smart = P.smart || [];
    P.smart.push({
        id: Date.now(),
        text,
        indicator: $('smart-indicator').value.trim(),
        deadline: $('smart-deadline').value,
        done: false
    });
    
    $('smart-text').value = '';
    $('smart-indicator').value = '';
    $('smart-deadline').value = '';
    
    renderSmart();
    scheduleSave();
    toast('Objectif ajout√©', 'success');
}

function toggleSmart(id) {
    if (!P) return;
    const obj = P.smart?.find(s => s.id === id);
    if (obj) {
        obj.done = !obj.done;
        renderSmart();
        scheduleSave();
    }
}

function renderSmart() {
    if (!P) return;
    P.smart = P.smart || [];
    
    const list = $('smart-list');
    if (!P.smart.length) {
        list.innerHTML = '<div style="color:var(--text-muted);text-align:center;padding:var(--space-4);">Aucun objectif</div>';
    } else {
        list.innerHTML = P.smart.map(s => `
            <div class="smart-item ${s.done ? 'done' : ''}" data-id="${s.id}">
                <input type="checkbox" ${s.done ? 'checked' : ''} onchange="toggleSmart(${s.id})">
                <div class="smart-content">
                    <div class="smart-text">${esc(s.text)}</div>
                    <div class="smart-meta">
                        ${s.indicator ? `<span>üìä ${esc(s.indicator)}</span>` : ''}
                        ${s.deadline ? `<span>üìÖ ${s.deadline}</span>` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    $('smart-count').textContent = P.smart.length;
    updateStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// JOURNAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function addJournal() {
    if (!P) return toast('Cr√©ez d\'abord un projet', 'warning');
    
    const content = $('journal-content').value.trim();
    if (!content) return toast('Entrez du contenu', 'error');
    
    P.journal = P.journal || [];
    P.journal.unshift({
        id: Date.now(),
        date: $('journal-date').value || new Date().toISOString().split('T')[0],
        content
    });
    
    $('journal-content').value = '';
    
    renderJournal();
    scheduleSave();
    toast('Entr√©e ajout√©e', 'success');
}

function renderJournal() {
    if (!P) return;
    P.journal = P.journal || [];
    
    const list = $('journal-list');
    if (!P.journal.length) {
        list.innerHTML = '<div style="color:var(--text-muted);text-align:center;padding:var(--space-4);">Aucune entr√©e</div>';
    } else {
        list.innerHTML = P.journal.map(j => `
            <div class="journal-entry">
                <div class="journal-date">${j.date}</div>
                <div class="journal-text">${esc(j.content)}</div>
            </div>
        `).join('');
    }
    
    $('journal-count').textContent = P.journal.length;
    updateStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MESSAGE PREVIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function updateMessagePreview() {
    if (!P) return;
    const m = P.message || {};
    const preview = `${m.accroche || '[Accroche]'}

${m.probleme || '[Probl√®me]'}

Pourquoi c'est important : ${m.importance || '[Importance]'}

Nous demandons √† ${m.cible || '[Cible]'} de ${m.action || '[Action demand√©e]'}.`;
    
    $('message-preview').textContent = preview;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATS & PROGRESS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function updateStats() {
    if (!P) return;
    
    // Helper: compte les champs non vides d'un objet
    const countFilled = (obj) => {
        if (!obj || typeof obj !== 'object') return 0;
        let count = 0;
        for (const v of Object.values(obj)) {
            if (v && typeof v === 'string' && v.trim().length > 0) {
                count++;
            }
        }
        return count;
    };
    
    // VOIR: domino (3) + profil (4) + fleur (3) = 10 champs max
    const voirFilled = countFilled(P.domino) + countFilled(P.profil) + countFilled(P.fleur);
    const voirPct = Math.min(100, Math.round((voirFilled / 10) * 100));
    
    // JUGER: arbre (3) + pourquoi (5) + swot (4) + pestel (6) + tdc (4) = 22 champs + bonus acteurs
    const jugerFilled = countFilled(P.arbre) + countFilled(P.pourquoi) + countFilled(P.swot) + countFilled(P.pestel) + countFilled(P.tdc);
    const jugerBonus = Math.min(4, P.acteurs?.length || 0); // 1 point par acteur, max 4
    const jugerPct = Math.min(100, Math.round(((jugerFilled + jugerBonus) / 26) * 100));
    
    // AGIR: pouvoir (3) + cibles (3) + message (5) + evaluation (4) = 15 champs + bonus smart/journal
    const agirFilled = countFilled(P.pouvoir) + countFilled(P.cibles) + countFilled(P.message) + countFilled(P.evaluation);
    const agirBonus = Math.min(3, P.smart?.length || 0) + Math.min(2, P.journal?.length || 0);
    const agirPct = Math.min(100, Math.round(((agirFilled + agirBonus) / 20) * 100));
    
    const globalPct = Math.round((voirPct + jugerPct + agirPct) / 3);
    
    // Debug
    console.log('üìä Stats update:', {
        voir: `${voirFilled}/10 = ${voirPct}%`,
        juger: `${jugerFilled}+${jugerBonus}/26 = ${jugerPct}%`,
        agir: `${agirFilled}+${agirBonus}/20 = ${agirPct}%`,
        global: `${globalPct}%`,
        details: {
            domino: countFilled(P.domino),
            profil: countFilled(P.profil),
            fleur: countFilled(P.fleur),
            arbre: countFilled(P.arbre),
            pourquoi: countFilled(P.pourquoi),
            swot: countFilled(P.swot),
            pestel: countFilled(P.pestel),
            tdc: countFilled(P.tdc),
            pouvoir: countFilled(P.pouvoir),
            cibles: countFilled(P.cibles),
            message: countFilled(P.message),
            evaluation: countFilled(P.evaluation),
            acteurs: P.acteurs?.length || 0,
            smart: P.smart?.length || 0
        }
    });
    
    // Update UI
    $('progress-voir').style.width = voirPct + '%';
    $('progress-voir-val').textContent = voirPct + '%';
    $('progress-juger').style.width = jugerPct + '%';
    $('progress-juger-val').textContent = jugerPct + '%';
    $('progress-agir').style.width = agirPct + '%';
    $('progress-agir-val').textContent = agirPct + '%';
    
    // Score circle
    const circumference = 264;
    const offset = circumference - (globalPct / 100) * circumference;
    $('score-circle').style.strokeDashoffset = offset;
    $('score-value').textContent = globalPct + '%';
    
    // Stats cards
    $('stat-actors').textContent = P.acteurs?.length || 0;
    $('stat-smart').textContent = P.smart?.length || 0;
    $('stat-journal').textContent = P.journal?.length || 0;
    $('stat-fields').textContent = voirFilled + jugerFilled + agirFilled;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT / IMPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function doExport(format) {
    if (!P) return toast('Aucun projet s√©lectionn√©', 'warning');
    
    const filename = `plaidoyer_${P.meta?.name?.replace(/[^a-z0-9]/gi, '_') || 'projet'}_${new Date().toISOString().split('T')[0]}`;
    let content, type;
    
    switch (format) {
        case 'json':
            content = JSON.stringify(P, null, 2);
            type = 'application/json';
            break;
        case 'md':
            content = generateMarkdown();
            type = 'text/markdown';
            break;
        case 'html':
            content = generateHTML();
            type = 'text/html';
            break;
        case 'csv':
            content = generateCSV();
            type = 'text/csv';
            break;
        default: return;
    }
    
    downloadFile(content, `${filename}.${format}`, type);
    toast(`Export ${format.toUpperCase()} r√©ussi`, 'success');
}

function generateMarkdown() {
    let md = `# ${P.meta?.name || 'Projet'}\n\n`;
    md += `*Export√© le ${new Date().toLocaleDateString('fr-BE')}*\n\n---\n\n`;
    
    const sections = [
        { key: 'domino', title: 'Vision (Domino)' },
        { key: 'profil', title: 'Profil citoyen' },
        { key: 'fleur', title: 'Fleur du pouvoir' },
        { key: 'arbre', title: 'Arbre √† probl√®mes' },
        { key: 'swot', title: 'Analyse SWOT' },
        { key: 'tdc', title: 'Th√©orie du changement' },
        { key: 'pouvoir', title: 'Modes d\'action' },
        { key: 'message', title: 'Message cl√©' },
        { key: 'evaluation', title: 'Suivi-√©valuation' }
    ];
    
    sections.forEach(s => {
        if (P[s.key] && Object.keys(P[s.key]).length) {
            md += `## ${s.title}\n\n`;
            Object.entries(P[s.key]).forEach(([k, v]) => {
                if (v && String(v).trim()) md += `**${k}** : ${v}\n\n`;
            });
        }
    });
    
    if (P.acteurs?.length) {
        md += `## Acteurs\n\n`;
        P.acteurs.forEach(a => md += `- **${a.name}** (${a.position}) ‚Äî ${a.role || ''}\n`);
        md += '\n';
    }
    
    if (P.smart?.length) {
        md += `## Objectifs SMART\n\n`;
        P.smart.forEach(s => md += `- ${s.done ? '‚úÖ' : '‚¨ú'} ${s.text}${s.deadline ? ` (${s.deadline})` : ''}\n`);
    }
    
    return md;
}

function generateHTML() {
    return `<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8"><title>${P.meta?.name || 'Plaidoyer'}</title>
<style>body{font-family:system-ui;max-width:800px;margin:0 auto;padding:2rem;line-height:1.6}
h1{color:#48bb78;border-bottom:3px solid #9f7aea}h2{color:#9f7aea;margin-top:2rem}
.section{background:#f8f8f8;padding:1rem;border-radius:8px;margin-bottom:1rem}</style>
</head>
<body>
<h1>${P.meta?.name || 'Projet de Plaidoyer'}</h1>
<p><em>Export√© le ${new Date().toLocaleDateString('fr-BE')}</em></p>
${Object.entries(P).filter(([k]) => !['id', 'meta', 'acteurs', 'smart', 'journal'].includes(k)).map(([k, v]) => {
    if (!v || !Object.keys(v).length) return '';
    return `<div class="section"><h2>${k}</h2>${Object.entries(v).filter(([_, val]) => val).map(([field, val]) => `<p><strong>${field}:</strong> ${val}</p>`).join('')}</div>`;
}).join('')}
</body></html>`;
}

function generateCSV() {
    let csv = 'Section,Champ,Valeur\n';
    Object.entries(P).forEach(([section, data]) => {
        if (typeof data === 'object' && !Array.isArray(data) && data) {
            Object.entries(data).forEach(([k, v]) => {
                if (v) csv += `"${section}","${k}","${String(v).replace(/"/g, '""')}"\n`;
            });
        }
    });
    return csv;
}

function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
}

async function importJSON(file) {
    const reader = new FileReader();
    reader.onload = async (e) => {
        try {
            const data = JSON.parse(e.target.result);
            console.log('=== IMPORT START ===');
            console.log('Raw data keys:', Object.keys(data));
            
            let project;
            
            if (data.meta && data.meta.name) {
                // Format natif #B!Mi
                console.log('Format: Native #B!Mi');
                project = JSON.parse(JSON.stringify(data)); // Deep clone
                if (!project.id) project.id = Date.now().toString();
            } else if (data.project || data.domino) {
                // Format dataset-plaidoyer-arizona.json
                console.log('Format: Dataset Arizona');
                project = {
                    id: Date.now().toString(),
                    meta: {
                        name: data.project?.name || 'Projet import√©',
                        description: '',
                        created: data.project?.created || new Date().toISOString(),
                        updated: new Date().toISOString()
                    },
                    
                    // DOMINO
                    domino: {
                        vision: data.domino?.vision || '',
                        obstacles: data.domino?.obstacles || '',
                        ressources: data.domino?.ressources || ''
                    },
                    
                    // PROFIL
                    profil: {
                        motivations: data.profil?.motivations || '',
                        competences: data.profil?.competences || '',
                        temps: data.profil?.temps || '',
                        limites: data.profil?.limites || ''
                    },
                    
                    // FLEUR
                    fleur: {
                        identites: data.fleur?.identites || '',
                        privileges: data.fleur?.privileges || '',
                        oppressions: data.fleur?.oppressions || ''
                    },
                    
                    // ACTEURS
                    acteurs: (data.acteurs || []).map((a, i) => ({
                        id: Date.now() + i,
                        name: a.name || '',
                        role: a.role || '',
                        position: a.position || 'neutral',
                        power: parseInt(a.power) || 3
                    })),
                    
                    // ARBRE
                    arbre: {
                        probleme: data.arbre?.probleme_central || data.arbre?.probleme || '',
                        causes: Array.isArray(data.arbre?.causes) 
                            ? '‚Ä¢ ' + data.arbre.causes.join('\n‚Ä¢ ') 
                            : (data.arbre?.causes || ''),
                        consequences: Array.isArray(data.arbre?.effets) 
                            ? '‚Ä¢ ' + data.arbre.effets.join('\n‚Ä¢ ') 
                            : (data.arbre?.consequences || data.arbre?.effets || '')
                    },
                    
                    // POURQUOI
                    pourquoi: {
                        p1: data.pourquoi?.why1 || data.pourquoi?.p1 || '',
                        p2: data.pourquoi?.why2 || data.pourquoi?.p2 || '',
                        p3: data.pourquoi?.why3 || data.pourquoi?.p3 || '',
                        p4: data.pourquoi?.why4 || data.pourquoi?.p4 || '',
                        p5: data.pourquoi?.why5 || data.pourquoi?.p5 || ''
                    },
                    
                    // SWOT
                    swot: {
                        forces: data.swot?.strengths || data.swot?.forces || '',
                        faiblesses: data.swot?.weaknesses || data.swot?.faiblesses || '',
                        opportunites: data.swot?.opportunities || data.swot?.opportunites || '',
                        menaces: data.swot?.threats || data.swot?.menaces || ''
                    },
                    
                    // PESTEL
                    pestel: {
                        p: data.pestel?.politique || data.pestel?.p || '',
                        e: data.pestel?.economique || data.pestel?.e || '',
                        s: data.pestel?.social || data.pestel?.s || '',
                        t: data.pestel?.technologique || data.pestel?.t || '',
                        en: data.pestel?.environnemental || data.pestel?.en || '',
                        l: data.pestel?.legal || data.pestel?.l || ''
                    },
                    
                    // TDC
                    tdc: {
                        actuelle: data.tdc?.changement_interne_individuel || data.tdc?.actuelle || '',
                        souhaitee: data.tdc?.changement_externe_collectif || data.tdc?.souhaitee || '',
                        mecanismes: data.tdc?.changement_externe_individuel || data.tdc?.mecanismes || '',
                        hypotheses: data.tdc?.hypotheses || ''
                    },
                    
                    // POUVOIR
                    pouvoir: {
                        avec: data.pouvoir?.avec || '',
                        sans: data.pouvoir?.sans || '',
                        contre: data.pouvoir?.contre || ''
                    },
                    
                    // CIBLES
                    cibles: {
                        principales: data.cibles?.principale || data.cibles?.principales || '',
                        secondaires: data.cibles?.secondaires || '',
                        allies: data.cibles?.allies || ''
                    },
                    
                    // MESSAGE
                    message: {
                        accroche: data.message?.accroche || '',
                        probleme: data.message?.probleme || '',
                        importance: data.message?.importance || '',
                        cible: data.message?.cible || '',
                        action: data.message?.action || ''
                    },
                    
                    // EVALUATION
                    evaluation: {
                        indicateurs: data.evaluation?.indicateurs || '',
                        methodes: data.evaluation?.methodes || '',
                        calendrier: data.evaluation?.calendrier || '',
                        lecons: data.evaluation?.lecons || ''
                    },
                    
                    // SMART
                    smart: [],
                    
                    // JOURNAL
                    journal: []
                };
                
                // SMART - conversion format {s,m,a,r,t} ou {text,...}
                if (data.smart && Array.isArray(data.smart)) {
                    project.smart = data.smart.map((s, i) => ({
                        id: Date.now() + i + 500,
                        text: s.s || s.text || '',
                        indicator: s.m || s.indicator || '',
                        deadline: s.t || s.deadline || '',
                        done: !!s.done
                    }));
                }
                
                // CHECKLIST ‚Üí SMART si pas de smart
                if (data.checklist && Array.isArray(data.checklist) && project.smart.length === 0) {
                    project.smart = data.checklist.map((c, i) => ({
                        id: Date.now() + i + 1000,
                        text: c.task || '',
                        indicator: 'Phase: ' + (c.phase || 'N/A'),
                        deadline: '',
                        done: !!c.done
                    }));
                }
                
                console.log('Mapped project:', {
                    domino: project.domino,
                    acteurs: project.acteurs.length,
                    swot: project.swot,
                    smart: project.smart.length
                });
                
            } else {
                throw new Error('Format de fichier non reconnu. Utilisez un export JSON de #B!Mi ou un dataset compatible.');
            }
            
            // Save to DB
            const saved = await dbPut(project);
            console.log('Saved to DB:', saved);
            
            // Select and load
            await selectProject(project.id);
            
            toast(`Import r√©ussi ! ${project.acteurs?.length || 0} acteurs, ${project.smart?.length || 0} objectifs`, 'success');
            console.log('=== IMPORT END ===');
            
        } catch (err) {
            console.error('Import error:', err);
            toast('Erreur d\'import : ' + err.message, 'error');
        }
    };
    reader.readAsText(file);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TEMPLATES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function loadTemplate(tpl) {
    let project = newProject(tpl === 'arizona' ? 'STOP Arizona ‚Äî D√©fense du Mod√®le Social Belge' : 'Nouveau projet');
    
    if (tpl === 'arizona') {
        project.domino = {
            vision: "D'ici fin 2027, obtenir l'ANNULATION de la limitation des allocations de ch√¥mage √† 24 mois et une COMPENSATION INT√âGRALE des CPAS.",
            obstacles: "Majorit√© parlementaire Arizona solide ‚Ä¢ Contrainte budg√©taire UE de 23 milliards ‚Ç¨ ‚Ä¢ 90.000 personnes concern√©es par les exclusions",
            ressources: "Front commun syndical FGTB + CSC + CGSLB (1,5M membres) ‚Ä¢ Recours constitutionnel (article 23) ‚Ä¢ R√©seau associatif dense"
        };
        project.acteurs = [
            { id: 1, name: "Bart De Wever", role: "Premier Ministre (N-VA)", position: "opponent", power: 5 },
            { id: 2, name: "Frank Vandenbroucke", role: "Ministre Affaires sociales", position: "neutral", power: 5 },
            { id: 3, name: "Thierry Bodson", role: "Pr√©sident FGTB", position: "ally", power: 4 },
            { id: 4, name: "Cour Constitutionnelle", role: "Recours article 23", position: "target", power: 5 }
        ];
        project.smart = [
            { id: 1, text: "Obtenir un moratoire sur les exclusions", indicator: "Suspension officielle", deadline: "2026-03-01", done: false },
            { id: 2, text: "Documenter 1000 t√©moignages", indicator: "Nombre de t√©moignages", deadline: "2026-12-31", done: false }
        ];
    }
    
    await dbPut(project);
    await selectProject(project.id);
    toast('Projet cr√©√© √† partir du mod√®le', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELP SYSTEM ‚Äî Non-invasif
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showHelp(key, anchorEl) {
    const h = HELP[key];
    if (!h) return;
    
    $('help-title').textContent = h.title;
    $('help-content').innerHTML = h.content;
    
    const tooltip = $('help-tooltip');
    tooltip.classList.add('show');
    
    // Position near anchor
    if (anchorEl) {
        const rect = anchorEl.getBoundingClientRect();
        tooltip.style.top = Math.min(rect.bottom + 8, window.innerHeight - 300) + 'px';
        tooltip.style.left = Math.min(rect.left, window.innerWidth - 340) + 'px';
    } else {
        tooltip.style.top = '50%';
        tooltip.style.left = '50%';
        tooltip.style.transform = 'translate(-50%, -50%)';
    }
}

function hideHelp() {
    $('help-tooltip').classList.remove('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function toast(message, type = 'info') {
    const container = $('toasts');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.textContent = message;
    container.appendChild(t);
    setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 3000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function init() {
    await openDB();
    await renderProjects();
    
    // Set default date for journal
    $('journal-date').value = new Date().toISOString().split('T')[0];
    
    // Check if any project exists
    const projects = await dbGetAll();
    if (projects.length) {
        await selectProject(projects[0].id);
    } else {
        showPage('empty');
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EVENT LISTENERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    // Menu mobile
    $('btn-menu').addEventListener('click', () => {
        $('sidebar').classList.toggle('open');
        $('sidebar-overlay').classList.toggle('open');
    });
    $('sidebar-overlay').addEventListener('click', () => {
        $('sidebar').classList.remove('open');
        $('sidebar-overlay').classList.remove('open');
    });
    
    // Navigation
    $$('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            if (e.target.classList.contains('hint-trigger')) return;
            const page = btn.dataset.page;
            if (!P && !['empty', 'export', 'ressources'].includes(page)) {
                toast('Cr√©ez d\'abord un projet', 'warning');
                return;
            }
            showPage(page);
        });
    });
    
    // Phase cards navigation
    $$('[data-goto]').forEach(card => {
        card.addEventListener('click', () => {
            if (!P) return toast('Cr√©ez d\'abord un projet', 'warning');
            showPage(card.dataset.goto);
        });
    });
    
    // Field auto-save
    $$('[data-field]').forEach(el => {
        el.addEventListener('input', () => {
            if (!P) return;
            const [section, key] = el.dataset.field.split('.');
            if (!P[section]) P[section] = {};
            P[section][key] = el.value;
            if (section === 'message') updateMessagePreview();
            scheduleSave();
            updateStats();
        });
    });
    
    // Buttons
    $('btn-add-actor').addEventListener('click', addActor);
    $('btn-add-smart').addEventListener('click', addSmart);
    $('btn-add-journal').addEventListener('click', addJournal);
    
    $('btn-copy-message').addEventListener('click', () => {
        navigator.clipboard.writeText($('message-preview').textContent);
        toast('Message copi√© !', 'success');
    });
    
    // New project
    $('btn-new-project').addEventListener('click', () => openModal('modal-create'));
    $('btn-empty-new').addEventListener('click', () => openModal('modal-create'));
    $('btn-create-confirm').addEventListener('click', async () => {
        const name = $('create-name').value.trim();
        if (!name) return toast('Entrez un nom', 'error');
        const project = newProject(name, $('create-desc').value.trim());
        await dbPut(project);
        await selectProject(project.id);
        closeModal('modal-create');
        $('create-name').value = '';
        $('create-desc').value = '';
        toast('Projet cr√©√© !', 'success');
    });
    
    // Templates
    $('btn-templates').addEventListener('click', () => showPage('empty'));
    $$('[data-tpl]').forEach(card => card.addEventListener('click', () => loadTemplate(card.dataset.tpl)));
    
    // Export
    $$('[data-export]').forEach(card => card.addEventListener('click', () => doExport(card.dataset.export)));
    
    // Import
    const handleImport = (e) => {
        const file = e.target.files?.[0];
        if (file) importJSON(file);
    };
    $('import-file').addEventListener('change', handleImport);
    $('import-home').addEventListener('change', handleImport);
    
    // Drop zone
    const dropZone = $('drop-zone');
    dropZone.addEventListener('click', () => $('import-file').click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file) importJSON(file);
    });
    
    // Modals close
    $$('[data-close]').forEach(btn => {
        btn.addEventListener('click', () => closeModal(btn.dataset.close));
    });
    $$('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) overlay.classList.remove('open');
        });
    });
    
    // Search
    $('btn-search').addEventListener('click', () => openModal('modal-search'));
    $('search-input').addEventListener('input', () => {
        // Simple search implementation
        const q = $('search-input').value.toLowerCase().trim();
        if (!q || !P) { $('search-results').innerHTML = ''; return; }
        
        const results = [];
        const search = (obj, path) => {
            if (!obj) return;
            Object.entries(obj).forEach(([k, v]) => {
                if (typeof v === 'string' && v.toLowerCase().includes(q)) {
                    results.push({ path: path + '.' + k, text: v.substring(0, 80) });
                }
            });
        };
        ['domino', 'profil', 'fleur', 'arbre', 'swot', 'tdc', 'pouvoir', 'cibles', 'message', 'evaluation'].forEach(k => search(P[k], k));
        
        if (!results.length) {
            $('search-results').innerHTML = '<p style="color:var(--text-muted);text-align:center;padding:var(--space-4);">Aucun r√©sultat</p>';
        } else {
            $('search-results').innerHTML = results.slice(0, 8).map(r => `
                <div style="padding:var(--space-3);border-bottom:1px solid var(--border-subtle);cursor:pointer;" data-goto="${r.path.split('.')[0]}">
                    <strong style="color:var(--mint-300);">${r.path}</strong><br>
                    <span style="color:var(--text-muted);font-size:0.85rem;">${esc(r.text)}...</span>
                </div>
            `).join('');
            $('search-results').querySelectorAll('[data-goto]').forEach(el => {
                el.addEventListener('click', () => {
                    showPage(el.dataset.goto);
                    closeModal('modal-search');
                });
            });
        }
    });
    
    // Help system
    $$('.hint-trigger, .help-icon').forEach(el => {
        el.addEventListener('click', (e) => {
            e.stopPropagation();
            showHelp(el.dataset.help, el);
        });
    });
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.help-tooltip') && !e.target.closest('.hint-trigger') && !e.target.closest('.help-icon')) {
            hideHelp();
        }
    });
    
    // Shortcuts
    $('btn-shortcuts').addEventListener('click', () => openModal('modal-shortcuts'));
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            openModal('modal-search');
            $('search-input').focus();
        }
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            if (P) { scheduleSave(); toast('Sauvegard√©', 'success'); }
        }
        if (e.key === 'Escape') {
            $$('.modal-overlay.open').forEach(m => m.classList.remove('open'));
            hideHelp();
        }
    });
    
    console.log('#B!Mi Plaidoyer Citoyen v4.0 ‚Äî Ready');
}

// Start
document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
